"use strict";(()=>{(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[6720],{38479:function(Oe,O,r){r.r(O),r.d(O,{HomePageCalendar:function(){return Be}});var t=r(2784),T=r(82066),Z=r(76635),g=r(96299),D=r(23192),u=r(36964),c=r(95544),P=r(61837),f=r(90436),G=r(45203),H=r(15762),v=r(17986);const W=({enabled:e})=>{const n=(0,u.useApi)(v.M),o=(0,u.useApi)(u.errorApiRef);return(0,T.useQuery)(["calendars"],async()=>{const s=[];let a="";do{const{nextPageToken:l="",items:i=[]}=await n.getCalendars({maxResults:100,minAccessRole:"reader",pageToken:a});a=l,s.push(...i)}while(a);return s},{enabled:e,keepPreviousData:!0,refetchInterval:36e5,onError:()=>{o.post({name:"API error",message:"Failed to fetch calendars."})}})},j=({selectedCalendars:e=[],calendars:n=[],enabled:o,timeMin:s,timeMax:a,timeZone:l})=>{const i=(0,u.useApi)(v.M),d=(0,T.useQueries)(e.filter(m=>n.find(p=>p.id===m)).map(m=>{const p=n.find(L=>L.id===m);return{queryKey:["calendarEvents",m,s,a],enabled:o,initialData:[],refetchInterval:6e4,refetchIntervalInBackground:!0,queryFn:async()=>((await i.getEvents(m,{calendarId:m,timeMin:s,timeMax:a,showDeleted:!1,singleEvents:!0,maxResults:100,orderBy:"startTime",timeZone:l})).items||[]).map(C=>{var S,y;const k=(y=(S=C.attendees)==null?void 0:S.find(B=>!!B.self))==null?void 0:y.responseStatus;return{...C,summary:(0,Z.unescape)(C.summary||""),calendarId:m,backgroundColor:p==null?void 0:p.backgroundColor,primary:!!(p!=null&&p.primary),responseStatus:k}})}})),E=(0,t.useMemo)(()=>(0,Z.compact)(d.map(({data:m})=>m).flat()),[d]),h=!!d.find(m=>m.isFetching)&&E.length===0;return{events:E,isLoading:h}},w=()=>{const[e,n]=(0,t.useState)(!1),[o,s]=(0,t.useState)(!1),a=(0,u.useApi)(u.googleAuthApiRef),l=(0,t.useCallback)(async(i=!1)=>{const d=await a.getAccessToken("https://www.googleapis.com/auth/calendar.readonly",{optional:i,instantPopup:!i});n(!!d),s(!0)},[a,n]);return{isSignedIn:e,isInitialized:o,signIn:l}};var K=r(72164),J=r(59592),x;(function(e){const n="google_calendars_selected";e.selectedCalendars=n})(x||(x={}));function V(e){const n=J.M.getId(),o=x.selectedCalendars,s=(0,u.useApi)(u.storageApiRef).forBucket(n),a=d=>{s.set(o,d)},l=(0,K.Z)(s.observe$(o),s.snapshot(o));let i;return l.presence==="absent"?i=e:i=l.value,[i,a]}var U=r.p+"static/calendarIcon.b666a6e5..svg",X=r(72779),M=r.n(X),A=r(90409),I=r(79692),Y=r(27556),N=r(80030),z=r(86689),q=r(79784),_=r.p+"static/zoomIcon.748bc7a7..svg",ee=r(35368),te=r.n(ee),R=r(85256),ne=r(27597),ae=r(26739),oe=r(7089),re=r(49166),se=r(81556);const le=(0,I.Z)(e=>{const n=o=>o?{[v.Mx.accepted]:e.palette.status.ok,[v.Mx.declined]:e.palette.status.error}[o]:e.palette.primary.light;return{responseStatus:{color:({responseStatus:o})=>n(o)},badge:{right:10,top:5,"& svg":{height:16,width:16,background:"#fff"}}}}),ie=({responseStatus:e})=>e===v.Mx.accepted?t.createElement(se.Z,{"data-testid":"accepted-icon"}):e===v.Mx.declined?t.createElement(re.Z,{"data-testid":"declined-icon"}):null,ce=({user:e})=>{const n=le({responseStatus:e.responseStatus});return t.createElement(ae.Z,{classes:{root:n.responseStatus,badge:n.badge},badgeContent:t.createElement(ie,{responseStatus:e.responseStatus})},t.createElement(oe.Z,{size:"small",variant:"outlined",label:e.email,color:"primary"}))};function F(e){var o,s,a;const n=(s=(o=e.conferenceData)==null?void 0:o.entryPoints)==null?void 0:s.find(l=>l.entryPointType==="video");return(a=n==null?void 0:n.uri)!=null?a:""}function b(e){var a,l;if(Q(e))return de(e);const n={hour:"2-digit",minute:"2-digit"},o=g.ou.fromISO(((a=e.start)==null?void 0:a.dateTime)||""),s=g.ou.fromISO(((l=e.end)==null?void 0:l.dateTime)||"");return`${o.toLocaleString(n)} - ${s.toLocaleString(n)}`}function de(e){var a,l,i,d;const n={month:"long",day:"numeric"},o=g.ou.fromISO(((a=e.start)==null?void 0:a.dateTime)||((l=e.start)==null?void 0:l.date)||""),s=g.ou.fromISO(((i=e.end)==null?void 0:i.dateTime)||((d=e.end)==null?void 0:d.date)||"").minus({day:1});return o.toISO()===s.toISO()?o.toLocaleString(n):`${o.toLocaleString(n)} - ${s.toLocaleString(n)}`}function me(e){var o,s,a,l;if(!((o=e.end)!=null&&o.dateTime)&&!((s=e.end)!=null&&s.date))return!1;const n=g.ou.fromISO(((a=e.end)==null?void 0:a.dateTime)||((l=e.end)==null?void 0:l.date));return g.ou.now()>=n}function Q(e){var s,a,l,i;if(((s=e.start)==null?void 0:s.date)||((a=e.end)==null?void 0:a.date))return!0;const n=g.ou.fromISO(((l=e.start)==null?void 0:l.dateTime)||"");return g.ou.fromISO(((i=e.end)==null?void 0:i.dateTime)||"").diff(n,"day").days>=1}function ue(e){var n,o;return g.ou.fromISO(((n=e.start)==null?void 0:n.dateTime)||((o=e.start)==null?void 0:o.date)||"")}const pe=(0,I.Z)(e=>({description:{wordBreak:"break-word","& a":{color:e.palette.primary.main,fontWeight:500}},divider:{marginTop:e.spacing(2),marginBottom:e.spacing(2)}}),{name:"GCalendarEventPopoverContent"}),ge=({event:e})=>{const n=pe({event:e}),o=(0,u.useAnalytics)(),s=F(e);return t.createElement(c.Z,{display:"flex",flexDirection:"column",width:400,p:2},t.createElement(c.Z,{display:"flex",alignItems:"center"},t.createElement(c.Z,{flex:1},t.createElement(f.Z,{variant:"h6"},e.summary),t.createElement(f.Z,{variant:"subtitle2"},b(e))),e.htmlLink&&t.createElement(N.ZP,{title:"Open in Calendar"},t.createElement(z.Z,{"data-testid":"open-calendar-link",href:e.htmlLink,target:"_blank",onClick:a=>o.captureEvent("click","open in calendar")},t.createElement(P.Z,null,t.createElement(ne.Z,null))))),s&&t.createElement(z.Z,{href:s,target:"_blank",onClick:a=>o.captureEvent("click","zoom link")},"Join Zoom Meeting"),e.description&&t.createElement(t.Fragment,null,t.createElement(R.Z,{className:n.divider,variant:"fullWidth"}),t.createElement(c.Z,{className:n.description,dangerouslySetInnerHTML:{__html:te().sanitize(e.description,{USE_PROFILES:{html:!0}})}})),e.attendees&&t.createElement(t.Fragment,null,t.createElement(R.Z,{className:n.divider,variant:"fullWidth"}),t.createElement(c.Z,null,t.createElement(f.Z,{variant:"subtitle2"},"Attendees"),t.createElement(c.Z,{mb:1}),(0,Z.sortBy)(e.attendees||[],"email").map(a=>t.createElement(ce,{key:a.email,user:a})))))},ye=(0,I.Z)(e=>({event:{display:"flex",alignItems:"center",marginBottom:e.spacing(1),cursor:"pointer",paddingRight:12},declined:{textDecoration:"line-through"},passed:{opacity:.6,transition:"opacity 0.15s ease-in-out","&:hover":{opacity:1}},link:{width:48,height:48,display:"inline-block",padding:8,borderRadius:"50%","&:hover":{backgroundColor:e.palette.grey[100]}},calendarColor:({event:n})=>({width:8,borderTopLeftRadius:4,borderBottomLeftRadius:4,backgroundColor:n.primary?e.palette.primary.light:n.backgroundColor})}),{name:"GCalendarEvent"}),$=({event:e})=>{const n=ye({event:e}),o=(0,A.o_)({variant:"popover",popupId:e.id,disableAutoFocus:!0}),[s,a]=(0,t.useState)(!1),l=(0,u.useAnalytics)(),i=F(e),{onClick:d,...E}=(0,A.vW)(o);return t.createElement(t.Fragment,null,t.createElement(Y.Z,{onClick:h=>{d(h),l.captureEvent("click","event info")},...E,onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),elevation:s?4:1,className:M()(n.event,{[n.passed]:me(e)}),"data-testid":"calendar-event"},t.createElement(c.Z,{className:n.calendarColor,mr:1,alignSelf:"stretch"}),t.createElement(c.Z,{flex:1,pt:1,pb:1},t.createElement(f.Z,{variant:"subtitle2",className:M()({[n.declined]:e.responseStatus===v.Mx.declined})},e.summary),!Q(e)&&t.createElement(f.Z,{variant:"body2","data-testid":"calendar-event-time"},b(e))),i&&t.createElement(N.ZP,{title:"Join Zoom Meeting"},t.createElement(z.Z,{"data-testid":"calendar-event-zoom-link",className:n.link,href:i,target:"_blank",onClick:h=>{h.stopPropagation(),l.captureEvent("click","zoom link")}},t.createElement("img",{src:_,alt:"Zoom link"})))),t.createElement(q.ZP,{...(0,A.ZW)(o),anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"center"},"data-testid":"calendar-event-popover"},t.createElement(ge,{event:e})))};var fe=r(42494),Ee=r(73698),he=r(29611),ve=r(12231),Ce=r(21324),Ze=r(49378);const Se=(0,I.Z)({formControl:{width:120},selectedCalendars:{textOverflow:"ellipsis",overflow:"hidden"}},{name:"GCalendarSelect"}),Te=({disabled:e,selectedCalendars:n=[],setSelectedCalendars:o,calendars:s})=>{const a=Se();return t.createElement(fe.Z,{className:a.formControl},t.createElement(Ee.Z,{labelId:"calendars-label",disabled:e||s.length===0,multiple:!0,value:n,onChange:async l=>o(l.target.value),input:t.createElement(he.Z,null),renderValue:l=>t.createElement(f.Z,{className:a.selectedCalendars,variant:"body2"},s.filter(i=>i.id&&l.includes(i.id)).map(i=>i.summary).join(", ")),MenuProps:{PaperProps:{style:{width:350}}}},(0,Z.sortBy)(s,"summary").map(l=>t.createElement(ve.Z,{key:l.id,value:l.id},t.createElement(Ce.Z,{checked:n.includes(l.id)}),t.createElement(Ze.Z,{primary:l.summary})))))};var Ie=r(76600),Le=r(77277);const ke=[{id:"1",htmlLink:"https://www.google.com/calendar/",summary:"Backstage Community Sessions",start:{dateTime:"2021-12-07T09:00:00+01:00",timeZone:"Europe/London"},end:{dateTime:"2021-12-07T10:00:00+01:00",timeZone:"Europe/London"}},{id:"2",htmlLink:"https://www.google.com/calendar/",summary:"Backstage Community Sessions",start:{dateTime:"2021-12-07T10:30:00+01:00",timeZone:"Europe/London"},end:{dateTime:"2021-12-07T10:45:00+01:00",timeZone:"Europe/London"},conferenceData:{entryPoints:[{entryPointType:"video",uri:"https://zoom.us"}]}},{id:"3",htmlLink:"https://www.google.com/calendar",summary:"Backstage Community Sessions",start:{dateTime:"2021-12-07T12:00:00+01:00",timeZone:"Europe/London"},end:{dateTime:"2021-12-07T13:00:00+01:00",timeZone:"Europe/London"},conferenceData:{entryPoints:[{entryPointType:"video",uri:"https://zoom.us",label:"zoom.us"}]}},{id:"4",htmlLink:"https://www.google.com/calendar",summary:"Backstage Community Sessions",start:{dateTime:"2021-12-07T15:00:00+01:00",timeZone:"Europe/London"},end:{dateTime:"2021-12-07T16:30:00+01:00",timeZone:"Europe/London"},conferenceData:{entryPoints:[{entryPointType:"video",uri:"https://zoom.us"}]}},{id:"5",htmlLink:"https://www.google.com/calendar",summary:"Backstage Community Sessions",start:{dateTime:"2021-12-07T17:00:00+01:00",timeZone:"Europe/London"},end:{dateTime:"2021-12-07T17:30:00+01:00",timeZone:"Europe/London"},conferenceData:{entryPoints:[{entryPointType:"video",uri:"https://zoom.us"}]}}],Pe=(0,Ie.Z)(c.Z)({opacity:.3,filter:"blur(1.5px)"}),xe=({handleAuthClick:e,events:n=ke})=>t.createElement(c.Z,{position:"relative",height:"100%",width:"100%"},t.createElement(Pe,{p:1},n.map(o=>t.createElement($,{key:o.id,event:o}))),t.createElement(c.Z,{height:"100%",width:"100%",display:"flex",justifyContent:"center",alignItems:"center",position:"absolute",left:0,top:0},t.createElement(Le.Z,{variant:"contained",color:"primary",onClick:e,size:"large"},"Sign in"))),Ae=()=>{var S;const[e,n]=(0,t.useState)(g.ou.now()),o=(0,u.useAnalytics)(),s=(y=1)=>{n(B=>B.plus({day:y})),o.captureEvent("click","change date")},{isSignedIn:a,isInitialized:l,signIn:i}=w();(0,t.useEffect)(()=>{i(!0)},[i]);const{isLoading:d,data:E=[]}=W({enabled:a}),h=(S=E.find(y=>y.primary===!0))==null?void 0:S.id,m=h?[h]:[],[p,L]=V(m),{events:C,isLoading:k}=j({calendars:E,selectedCalendars:p,enabled:a&&E.length>0,timeMin:e.startOf("day").toISO(),timeMax:e.endOf("day").toISO(),timeZone:e.zoneName});return t.createElement(D.InfoCard,{noPadding:!0,title:t.createElement(c.Z,{display:"flex",alignItems:"center"},t.createElement(c.Z,{height:24,width:24,mr:1},t.createElement("img",{src:U,alt:"Google Calendar"})),a?t.createElement(t.Fragment,null,t.createElement(P.Z,{onClick:()=>s(-1),size:"small"},t.createElement(G.Z,null)),t.createElement(P.Z,{onClick:()=>s(1),size:"small"},t.createElement(H.Z,null)),t.createElement(c.Z,{mr:.5}),t.createElement(f.Z,{variant:"h6"},e.toLocaleString({weekday:"short",month:"short",day:"numeric"})),t.createElement(c.Z,{flex:1}),t.createElement(Te,{calendars:E,selectedCalendars:p,setSelectedCalendars:L,disabled:d||!a})):t.createElement(f.Z,{variant:"h6"},"Agenda")),deepLink:{link:"https://calendar.google.com/",title:"Go to Calendar"}},t.createElement(c.Z,null,(d||k||!l)&&t.createElement(c.Z,{pt:2,pb:2},t.createElement(D.Progress,{variant:"query"})),!a&&l&&t.createElement(xe,{handleAuthClick:()=>i(!1)}),!k&&!d&&a&&t.createElement(c.Z,{p:1,pb:0,maxHeight:602,overflow:"auto"},C.length===0&&t.createElement(c.Z,{pt:2,pb:2},t.createElement(f.Z,{align:"center",variant:"h6"},"No events")),(0,Z.sortBy)(C,[ue]).map(y=>t.createElement($,{key:`${y.calendarId}-${y.id}`,event:y})))))},ze=new T.QueryClient,Be=()=>t.createElement(T.QueryClientProvider,{client:ze},t.createElement(Ae,null))}}]);})();

//# sourceMappingURL=6720.fab2ba85.chunk.js.map