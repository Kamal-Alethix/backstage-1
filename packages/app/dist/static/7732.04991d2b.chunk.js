"use strict";(()=>{var ga=Object.defineProperty;var ya=(S,v,s)=>v in S?ga(S,v,{enumerable:!0,configurable:!0,writable:!0,value:s}):S[v]=s;var Fe=(S,v,s)=>(ya(S,typeof v!="symbol"?v+"":v,s),s),_e=(S,v,s)=>{if(!v.has(S))throw TypeError("Cannot "+s)};var g=(S,v,s)=>(_e(S,v,"read from private field"),s?s.call(S):v.get(S)),B=(S,v,s)=>{if(v.has(S))throw TypeError("Cannot add the same private member more than once");v instanceof WeakSet?v.add(S):v.set(S,s)},L=(S,v,s,J)=>(_e(S,v,"write to private field"),J?J.call(S,s):v.set(S,s),s);(self.webpackChunkexample_app=self.webpackChunkexample_app||[]).push([[7732],{77732:function(S,v,s){var G,z,w,K,ie,_,H,Y,ee;s.r(v),s.d(v,{Router:function(){return ha}});var J={};s.r(J),s.d(J,{DescriptionField:function(){return It}});var e=s(2784),b=s(10289),h=s(23192),y=s(36964),T=s(53479),F=s(48326),te=s(48023),x=s(90436),Ne=s(36356),A=s(79692),$=s(80030),et=s(86689),tt=s(60364),ne=s(94339),nt=s(16111),Ee=s(24579),U=s(95544),at=s(7089),rt=s(14503),M=s(61837),lt=s(39781);const st=(0,A.Z)(t=>({cardHeader:{position:"relative"},title:{backgroundImage:({backgroundImage:n})=>n},box:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box","-webkit-line-clamp":10,"-webkit-box-orient":"vertical",paddingBottom:"0.8em"},label:{color:t.palette.text.secondary,textTransform:"uppercase",fontSize:"0.65rem",fontWeight:"bold",letterSpacing:.5,lineHeight:1,paddingBottom:"0.2rem"},leftButton:{marginRight:"auto"},starButton:{position:"absolute",top:t.spacing(.5),right:t.spacing(.5),padding:"0.25rem",color:"#fff"}})),ot=(0,A.Z)(t=>({deprecationIcon:{position:"absolute",top:t.spacing(.5),right:t.spacing(3.5),padding:"0.25rem"},link:{color:t.palette.warning.light}})),it=t=>{var n,a,l,r,o;return{key:t.metadata.uid,name:t.metadata.name,title:`${(n=t.metadata.title||t.metadata.name)!=null?n:""}`,type:(a=t.spec.type)!=null?a:"",description:(l=t.metadata.description)!=null?l:"-",tags:(o=(r=t.metadata)==null?void 0:r.tags)!=null?o:[]}},ct=()=>{const t=ot(),n=e.createElement(x.Z,{style:{padding:10,maxWidth:300}},"This template uses a syntax that has been deprecated, and should be migrated to a newer syntax. Click for more info.");return e.createElement("div",{className:t.deprecationIcon},e.createElement($.ZP,{title:n},e.createElement(et.Z,{href:"https://backstage.io/docs/features/software-templates/migrating-from-v1beta2-to-v1beta3",className:t.link},e.createElement(lt.Z,null))))},mt=({template:t,deprecated:n})=>{var p;const a=(0,tt.Z)(),l=(0,y.useRouteRef)(F.QQ),r=it(t),o=(0,T.getEntityRelations)(t,te.S4),i=a.getPageTheme({themeId:r.type})?r.type:"other",d=a.getPageTheme({themeId:i}),c=st({backgroundImage:d.backgroundImage}),m=l({templateName:r.name}),u=(0,y.useApi)(Ne.q3),f=(0,T.getEntitySourceLocation)(t,u);return e.createElement(ne.Z,null,e.createElement(nt.Z,{className:c.cardHeader},e.createElement(T.FavoriteEntity,{className:c.starButton,entity:t}),n&&e.createElement(ct,null),e.createElement(h.ItemCardHeader,{title:r.title,subtitle:r.type,classes:{root:c.title}})),e.createElement(Ee.Z,{style:{display:"grid"}},e.createElement(U.Z,{className:c.box},e.createElement(x.Z,{variant:"body2",className:c.label},"Description"),e.createElement(h.MarkdownContent,{content:r.description})),e.createElement(U.Z,{className:c.box},e.createElement(x.Z,{variant:"body2",className:c.label},"Owner"),e.createElement(T.EntityRefLinks,{entityRefs:o,defaultKind:"Group"})),e.createElement(U.Z,null,e.createElement(x.Z,{variant:"body2",className:c.label},"Tags"),(p=r.tags)==null?void 0:p.map(E=>e.createElement(at.Z,{size:"small",label:E,key:E})))),e.createElement(rt.Z,null,f&&e.createElement(M.Z,{className:c.leftButton,href:f.locationTargetUrl},e.createElement(Ne.nW,{type:f.integrationType})),e.createElement(h.Button,{color:"primary",to:m,"aria-label":`Choose ${r.title}`},"Choose")))},De=({TemplateCardComponent:t,group:n})=>{const{loading:a,error:l,entities:r}=(0,T.useEntityList)(),o=t||mt,i=n?r.filter(c=>n.filter(c)):r,d=(()=>n&&n.title?typeof n.title=="string"?e.createElement(h.ContentHeader,{title:n.title}):n.title:e.createElement(h.ContentHeader,{title:"Other Templates"}))();return n&&i.length===0?null:e.createElement(e.Fragment,null,a&&e.createElement(h.Progress,null),l&&e.createElement(h.WarningPanel,{title:"Oops! Something went wrong loading the templates"},l.message),!l&&!a&&!r.length&&e.createElement(x.Z,{variant:"body2"},"No templates found that match your filter. Learn more about"," ",e.createElement(h.Link,{to:"https://backstage.io/docs/features/software-templates/adding-templates"},"adding templates"),"."),e.createElement(h.Content,null,d,e.createElement(h.ItemCardGrid,null,i&&(i==null?void 0:i.length)>0&&i.map(c=>e.createElement(o,{key:(0,te.eE)(c),template:c,deprecated:c.apiVersion==="backstage.io/v1beta2"})))))};var dt=s(49230),ut=s(72415),ft=s(68099),ae=s(86136),re=s(49378),le=s(12231),pt=s(50758),Et=s(79784),ht=s(30254),gt=s(27604),yt=s(5075),vt=s(43054);const Ct=(0,A.Z)({button:{color:"white"}});function Zt(t){const n=Ct(),[a,l]=(0,e.useState)(),r=(0,y.useRouteRef)(F.Wp),o=(0,y.useRouteRef)(F._H),i=(0,y.useRouteRef)(F.p3),d=(0,b.s0)(),c=t.editor!==!1,m=t.actions!==!1,u=t.tasks!==!1;if(!c&&!m)return null;const f=E=>{l(E.currentTarget)},p=()=>{l(void 0)};return e.createElement(e.Fragment,null,e.createElement(M.Z,{"aria-label":"more","aria-controls":"long-menu","aria-haspopup":"true",onClick:f,"data-testid":"menu-button",color:"inherit",className:n.button},e.createElement(vt.Z,null)),e.createElement(Et.ZP,{open:Boolean(a),onClose:p,anchorEl:a,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"}},e.createElement(pt.Z,null,c&&e.createElement(le.Z,{onClick:()=>d(r())},e.createElement(ae.Z,null,e.createElement(gt.Z,{fontSize:"small"})),e.createElement(re.Z,{primary:"Template Editor"})),m&&e.createElement(le.Z,{onClick:()=>d(o())},e.createElement(ae.Z,null,e.createElement(ht.Z,{fontSize:"small"})),e.createElement(re.Z,{primary:"Installed Actions"})),u&&e.createElement(le.Z,{onClick:()=>d(i())},e.createElement(ae.Z,null,e.createElement(yt.Z,{fontSize:"small"})),e.createElement(re.Z,{primary:"Task List"})))))}const Tt=({TemplateCardComponent:t,groups:n,contextMenu:a})=>{const l=(0,y.useRouteRef)(F.Jd),r={title:n?"Other Templates":"Templates",filter:i=>!(n!=null?n:[]).map(c=>c.filter(i)).some(c=>c===!0)},{allowed:o}=(0,ft.gI)({permission:ut.catalogEntityCreatePermission});return e.createElement(h.Page,{themeId:"home"},e.createElement(h.Header,{pageTitleOverride:"Create a New Component",title:"Create a New Component",subtitle:"Create new software components using standard templates"},e.createElement(Zt,{...a})),e.createElement(h.Content,null,e.createElement(h.ContentHeader,{title:"Available Templates"},o&&e.createElement(h.CreateButton,{title:"Register Existing Component",to:l&&l()}),e.createElement(h.SupportButton,null,"Create new software components using standard templates. Different templates create different kinds of components (services, websites, documentation, ...).")),e.createElement(T.CatalogFilterLayout,null,e.createElement(T.CatalogFilterLayout.Filters,null,e.createElement(T.EntitySearchBar,null),e.createElement(T.EntityKindPicker,{initialFilter:"template",hidden:!0}),e.createElement(T.UserListPicker,{initialFilter:"all",availableFilters:["all","starred"]}),e.createElement(dt.p,null),e.createElement(T.EntityTagPicker,null)),e.createElement(T.CatalogFilterLayout.Content,null,n&&n.map((i,d)=>e.createElement(De,{key:d,TemplateCardComponent:t,group:i})),e.createElement(De,{key:"other",TemplateCardComponent:t,group:r})))))},St=({TemplateCardComponent:t,groups:n})=>e.createElement(T.EntityListProvider,null,e.createElement(Tt,{TemplateCardComponent:t,groups:n}));var Oe=s(67358),xt=s(19126),Ie=s.n(xt),Q=s(64279),X=s(33651),he=s(37618),Rt=s(31625),At=s(31377),Pt=s(34546),bt=s(63115),se=s(77277),ge=s(27556),wt=s(85754),Ft=s(75436);function W(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function V(t,n){if(!W(t))return;const{properties:a,items:l,anyOf:r,oneOf:o,allOf:i,dependencies:d}=t;for(const c in t)!t.hasOwnProperty(c)||c.startsWith("ui:")&&(n[c]=t[c],delete t[c]);if(W(a))for(const c in a){if(!a.hasOwnProperty(c))continue;const m=a[c];if(!W(m))continue;const u={};n[c]=u,V(m,u)}if(W(l)){const c={};n.items=c,V(l,c)}if(Array.isArray(r))for(const c of r)!W(c)||V(c,n);if(Array.isArray(o))for(const c of o)!W(c)||V(c,n);if(Array.isArray(i))for(const c of i)!W(c)||V(c,n);if(W(d))for(const c of Object.keys(d)){const m=d[c];!W(m)||V(m,n)}}function Nt(t){t.type=t.type||"object";const n=JSON.parse(JSON.stringify(t));delete n.title;const a={};return V(n,a),{schema:n,uiSchema:a}}var Dt=s(9850),Ot=s.n(Dt);const It=({description:t})=>t&&e.createElement(h.MarkdownContent,{content:t,linkTarget:"_blank"}),Lt=(0,wt.Zz)(Ft.Q2);function kt(t){const n=[];return t.forEach(a=>{const l=a.schema.properties;for(const r in l)if(l.hasOwnProperty(r)){const o=l[r];o.name=r,n.push(o)}}),n}function Bt(t,n){const a=kt(n),l={};for(const r in t)if(t.hasOwnProperty(r)){const o=a.find(d=>d.name===r);if(!o){l[r]=t[r];continue}if(o["ui:widget"]==="password"){l[r]="******";continue}if(!o["ui:backstage"]||!o["ui:backstage"].review){l[r]=t[r];continue}const i=o["ui:backstage"].review;if(i.mask){l[r]=i.mask;continue}if(!i.show)continue;l[r]=t[r]}return l}const Le=t=>{const{formData:n,onChange:a,onReset:l,onFinish:r,fields:o,widgets:i,finishButtonLabel:d}=t,[c,m]=(0,e.useState)(0),[u,f]=(0,e.useState)(!1),p=(0,y.useApi)(y.errorApiRef),E=(0,y.useApi)(y.featureFlagsApiRef),C="backstage:featureFlag",N=I=>{var pe;const P=Ot()(I),fe=[];return P.schema.properties&&(P.schema.properties=Object.fromEntries(Object.entries(P.schema.properties).filter(([ce,qe])=>qe[C]?E.isActive(qe[C])?!0:(fe.push(ce),!1):!0)),P.schema.required=Array.isArray(P.schema.required)?(pe=P.schema.required)==null?void 0:pe.filter(ce=>!fe.includes(ce)):P.schema.required),P},k=t.steps.filter(I=>{const P=I.schema[C];return typeof P!="string"||E.isActive(P)}).map(N),D=()=>{m(0),l()},R=()=>{m(Math.min(c+1,k.length))},Z=()=>m(Math.max(c-1,0)),O=async()=>{if(!!r){f(!0);try{await r()}catch(I){p.post(I)}finally{f(!1)}}};return e.createElement(e.Fragment,null,e.createElement(Rt.Z,{activeStep:c,orientation:"vertical"},k.map(({title:I,schema:P,...fe},pe)=>e.createElement(At.Z,{key:I},e.createElement(Pt.Z,{"aria-label":`Step ${pe+1} ${I}`,"aria-disabled":"false",tabIndex:0},e.createElement(x.Z,{variant:"h6",component:"h3"},I)),e.createElement(bt.Z,{key:I},e.createElement(Lt,{showErrorList:!1,fields:{...J,...o},widgets:i,noHtml5Validate:!0,formData:n,formContext:{formData:n},onChange:a,onSubmit:ce=>{ce.errors.length===0&&R()},...fe,...Nt(P)},e.createElement(se.Z,{disabled:c===0,onClick:Z},"Back"),e.createElement(se.Z,{variant:"contained",color:"primary",type:"submit"},"Next step")))))),c===k.length&&e.createElement(h.Content,null,e.createElement(ge.Z,{square:!0,elevation:0},e.createElement(x.Z,{variant:"h6"},"Review and create"),e.createElement(h.StructuredMetadataTable,{dense:!0,metadata:Bt(n,k)}),e.createElement(U.Z,{mb:4}),e.createElement(se.Z,{onClick:Z,disabled:u},"Back"),e.createElement(se.Z,{onClick:D,disabled:u},"Reset"),e.createElement(se.Z,{variant:"contained",color:"primary",onClick:O,disabled:!r||u},d!=null?d:"Create"))))};function me(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}const ke=(t,n,a)=>{function l(r,o,i){const d=r.properties,c=r.type==="object"&&d===void 0;if(!(!me(d)&&!c)){if(d)for(const[m,u]of Object.entries(o)){const f=i[m];if(me(u)){const p=d[m];me(p)&&l(p,u,f)}else{const p=d[m],E=me(p)&&p["ui:field"];E&&typeof n[E]=="function"&&n[E](u,f,a)}}else if(c){const m=r["ui:field"];m&&typeof n[m]=="function"&&n[m](o,i,a)}}}return(r,o)=>(l(t,r,o),o)},Mt=t=>{const n=(0,y.useApi)(X.l),{value:a,loading:l,error:r}=(0,Q.default)(()=>n.getTemplateParameterSchema(t),[n,t]);return{schema:a,loading:l,error:r}},Wt=({customFieldExtensions:t=[]})=>{const n=(0,y.useApiHolder)(),a=(0,e.useContext)(he.E0),l=(0,y.useApi)(y.errorApiRef),r=(0,y.useApi)(X.l),{templateName:o}=(0,b.UO)(),i=(0,b.s0)(),d=(0,y.useRouteRef)(F.gV),c=(0,y.useRouteRef)(F._Z),{schema:m,loading:u,error:f}=Mt(o),[p,E]=(0,e.useState)(()=>{var O;const Z=Ie().parse(window.location.search,{ignoreQueryPrefix:!0});try{return JSON.parse(Z.formData)}catch{return(O=Z.formData)!=null?O:{}}}),C=()=>E({}),N=(0,e.useCallback)(Z=>E(Z.formData),[E]),k=async()=>{var P;const{taskId:Z}=await r.scaffold({templateRef:(0,te.eE)({name:o,kind:"template",namespace:"default"}),values:p,secrets:a==null?void 0:a.secrets}),O=Ie().stringify({formData:p},{addQueryPrefix:!0}),I=`${window.location.pathname}${O}`;(P=window.history)==null||P.replaceState(null,document.title,I),i(d({taskId:Z}))};if(f)return l.post(new Error(`Failed to load template, ${f}`)),e.createElement(b.Fg,{to:c()});if(!u&&!m)return l.post(new Error("Template was not found.")),e.createElement(b.Fg,{to:c()});const D=Object.fromEntries(t.map(({name:Z,component:O})=>[Z,O])),R=Object.fromEntries(t.map(({name:Z,validation:O})=>[Z,O]));return e.createElement(h.Page,{themeId:"home"},e.createElement(h.Header,{pageTitleOverride:"Create a New Component",title:"Create a New Component",subtitle:"Create new software components using standard templates"}),e.createElement(h.Content,null,u&&e.createElement(Oe.Z,{"data-testid":"loading-progress"}),m&&e.createElement(h.InfoCard,{title:m.title,noPadding:!0,titleTypographyProps:{component:"h2"}},e.createElement(Le,{formData:p,fields:D,onChange:N,onReset:C,onFinish:k,steps:m.steps.map(Z=>({...Z,validate:ke(Z.schema,R,{apiHolder:n})}))}))))};var Ht=s(60426),Be=s(89571),j=s(15584),Ut=s(91256),jt=s(37390),zt=s(58987),$t=s(97485),Vt=s(72779),Me=s.n(Vt);const Gt=(0,A.Z)(t=>({code:{fontFamily:"Menlo, monospace",padding:t.spacing(1),backgroundColor:t.palette.type==="dark"?t.palette.grey[700]:t.palette.grey[300],display:"inline-block",borderRadius:5,border:`1px solid ${t.palette.grey[500]}`,position:"relative"},codeRequired:{"&::after":{position:"absolute",content:'"*"',top:0,right:t.spacing(.5),fontWeight:"bolder",color:t.palette.error.light}}})),Kt=()=>{const t=(0,y.useApi)(X.l),n=Gt(),{loading:a,value:l,error:r}=(0,Q.default)(async()=>t.listActions());if(a)return e.createElement(h.Progress,null);if(r)return e.createElement(h.ErrorPage,{statusMessage:"Failed to load installed actions",status:"500"});const o=m=>{const u=m.properties;if(!!u)return Object.entries(u).map(f=>{var N;const[p]=f,E=f[1],C=Me()(n.code,{[n.codeRequired]:(N=m.required)==null?void 0:N.includes(p)});return e.createElement(Be.Z,{key:p},e.createElement(j.Z,null,e.createElement("div",{className:C},p)),e.createElement(j.Z,null,E.title),e.createElement(j.Z,null,E.description),e.createElement(j.Z,null,e.createElement("span",{className:n.code},E.type)))})},i=m=>{if(!!m.properties)return e.createElement(Ut.Z,{component:ge.Z},e.createElement(jt.Z,{size:"small"},e.createElement(zt.Z,null,e.createElement(Be.Z,null,e.createElement(j.Z,null,"Name"),e.createElement(j.Z,null,"Title"),e.createElement(j.Z,null,"Description"),e.createElement(j.Z,null,"Type"))),e.createElement($t.Z,null,o(m))))},d=(m,u)=>{if(!!u)return e.createElement(e.Fragment,null,e.createElement(x.Z,{variant:"h6"},m),u.map((f,p)=>e.createElement("div",{key:p},i(f))))},c=l==null?void 0:l.map(m=>{var f,p,E,C;if(m.id.startsWith("legacy:"))return;const u=d("oneOf",(p=(f=m.schema)==null?void 0:f.input)==null?void 0:p.oneOf);return e.createElement(U.Z,{pb:4,key:m.id},e.createElement(x.Z,{variant:"h4",className:n.code},m.id),e.createElement(x.Z,null,m.description),((E=m.schema)==null?void 0:E.input)&&e.createElement(U.Z,{pb:2},e.createElement(x.Z,{variant:"h5"},"Input"),i(m.schema.input),u),((C=m.schema)==null?void 0:C.output)&&e.createElement(U.Z,{pb:2},e.createElement(x.Z,{variant:"h5"},"Output"),i(m.schema.output)))});return e.createElement(h.Page,{themeId:"home"},e.createElement(h.Header,{pageTitleOverride:"Create a New Component",title:"Installed actions",subtitle:"This is the collection of all installed actions"}),e.createElement(h.Content,null,c))},ye=window.showDirectoryPicker;class Yt{constructor(n,a){this.path=n,this.handle=a}file(){return this.handle.getFile()}async save(n){const a=await this.handle.createWritable();await a.write(n),await a.close()}}class Jt{constructor(n){this.handle=n}async listFiles(){const n=[];for await(const a of this.listDirectoryContents(this.handle))n.push(a);return n}async*listDirectoryContents(n,a=[]){for await(const l of n.values())l.kind==="file"?yield new Yt([...a,l.name].join("/"),l):l.kind==="directory"&&(yield*this.listDirectoryContents(l,[...a,l.name]))}}class We{static isSupported(){return Boolean(ye)}static async requestDirectoryAccess(){if(!ye)throw new Error("File system access is not supported");const n=await ye();return new Jt(n)}constructor(){}}var He=s(25417),Qt=s(82726);const Xt=(0,A.Z)(t=>({introText:{textAlign:"center",marginTop:t.spacing(2)},card:{position:"relative",maxWidth:340,marginTop:t.spacing(4),margin:t.spacing(0,2)},infoIcon:{position:"absolute",top:t.spacing(1),right:t.spacing(1)}}));function qt(t){const n=Xt(),a=We.isSupported(),l=e.createElement(ne.Z,{className:n.card,elevation:4},e.createElement(He.Z,{disabled:!a,onClick:()=>{var o;return(o=t.onSelect)==null?void 0:o.call(t,"local")}},e.createElement(Ee.Z,null,e.createElement(x.Z,{variant:"h5",gutterBottom:!0,color:a?void 0:"textSecondary",style:{display:"flex",flexFlow:"row nowrap"}},"Load Template Directory"),e.createElement(x.Z,{variant:"body1",color:a?void 0:"textSecondary"},"Load a local template directory, allowing you to both edit and try executing your own template."))),!a&&e.createElement("div",{className:n.infoIcon},e.createElement($.ZP,{placement:"top",title:"Only supported in some Chromium-based browsers"},e.createElement(Qt.Z,null)))),r=e.createElement(ne.Z,{className:n.card,elevation:4},e.createElement(He.Z,{onClick:()=>{var o;return(o=t.onSelect)==null?void 0:o.call(t,"form")}},e.createElement(Ee.Z,null,e.createElement(x.Z,{variant:"h5",gutterBottom:!0},"Edit Template Form"),e.createElement(x.Z,{variant:"body1"},"Preview and edit a template form, either using a sample template or by loading a template from the catalog."))));return e.createElement("div",{style:t.style},e.createElement(x.Z,{variant:"h6",className:n.introText},"Get started by choosing one of the options below"),e.createElement("div",{style:{display:"flex",flexFlow:"row wrap",alignItems:"flex-start",justifyContent:"center",alignContent:"flex-start"}},a&&l,r,!a&&l))}var _t=s(8002),en=s(93804);const tn=1024*1024,nn="This file is too large to be displayed";class an{constructor(n,a){B(this,G,void 0);B(this,z,void 0);B(this,w,void 0);B(this,K,void 0);L(this,G,n),L(this,z,a)}get path(){return g(this,G).path}get content(){var n;return(n=g(this,w))!=null?n:nn}updateContent(n){g(this,w)!==void 0&&(L(this,w,n),g(this,z).call(this))}get dirty(){return g(this,w)!==g(this,K)}async save(){g(this,w)!==void 0&&(await g(this,G).save(g(this,w)),L(this,K,g(this,w)),g(this,z).call(this))}async reload(){const n=await g(this,G).file();if(n.size>tn){g(this,w)!==void 0&&(L(this,w,void 0),L(this,K,void 0),g(this,z).call(this));return}const a=await n.text();g(this,w)!==a&&(L(this,w,a),L(this,K,a),g(this,z).call(this))}}G=new WeakMap,z=new WeakMap,w=new WeakMap,K=new WeakMap;class rn{constructor(n){B(this,ie,void 0);B(this,_,new Set);B(this,H,[]);B(this,Y,void 0);Fe(this,"setSelectedFile",n=>{const a=g(this,Y),l=g(this,H).find(r=>r.path===n);a!==l&&(L(this,Y,l),g(this,ee).call(this))});B(this,ee,()=>{g(this,_).forEach(n=>n())});L(this,ie,n)}get files(){return g(this,H)}get selectedFile(){return g(this,Y)}get dirty(){return g(this,H).some(n=>n.dirty)}async save(){await Promise.all(g(this,H).map(n=>n.save()))}async reload(){var r;const n=(r=g(this,Y))==null?void 0:r.path,a=await g(this,ie).listFiles(),l=await Promise.all(a.map(async o=>{const i=new an(o,g(this,ee));return await i.reload(),i}));g(this,H).length=0,g(this,H).push(...l),this.setSelectedFile(n),g(this,ee).call(this)}subscribe(n){return g(this,_).add(n),()=>{g(this,_).delete(n)}}}ie=new WeakMap,_=new WeakMap,H=new WeakMap,Y=new WeakMap,ee=new WeakMap;const Ue=(0,e.createContext)(void 0);function ve(){const t=(0,e.useContext)(Ue),n=(0,_t.S)();if((0,e.useEffect)(()=>t==null?void 0:t.subscribe(n),[t,n]),!t)throw new Error("must be used within a DirectoryEditorProvider");return t}function ln(t){const{directory:n}=t,[{result:a,error:l},{execute:r}]=(0,en.r)(async o=>{const i=new rn(o);await i.reload();const d=i.files.find(c=>c.path.match(/\.ya?ml$/));return d&&i.setSelectedFile(d.path),i});return(0,e.useEffect)(()=>{r(n)},[r,n]),l?e.createElement(h.ErrorPanel,{error:l}):a?e.createElement(Ue.Provider,{value:a},t.children):e.createElement(h.Progress,null)}var sn=s(60155),Ce=s.n(sn);const on=256*1024,je=32768,ze=(0,e.createContext)(void 0);function cn(t){if(t.length>on)return btoa("<file too large>");try{return btoa(t)}catch{const a=new TextEncoder().encode(t),l=new Array;for(let r=0;r<a.length;r+=je)l.push(String.fromCharCode(...a.slice(r,r+je)));return btoa(l.join(""))}}function mn(t){const n=(0,y.useApi)(X.l),[a,l]=(0,e.useState)({results:[],selectedResult:void 0}),r=(0,e.useRef)(1),o=(0,e.useCallback)(m=>{l(u=>{const f=u.results.find(p=>p.id===m);return f===u.selectedResult?u:{results:u.results,selectedResult:f}})},[]),i=(0,e.useCallback)(m=>{l(u=>{var C;const f=u.results.findIndex(N=>N.id===m);if(f===-1)return u;const p=u.results.slice(),[E]=p.splice(f,1);return{results:p,selectedResult:((C=u.selectedResult)==null?void 0:C.id)===E.id?p[0]:u.selectedResult}})},[]),d=(0,e.useCallback)(async m=>{if(!n.dryRun)throw new Error("Scaffolder API does not support dry-run");const u=Ce().parse(m.templateContent),p={...await n.dryRun({template:u,values:m.values,secrets:{},directoryContents:m.files.map(E=>({path:E.path,base64Content:cn(E.content)}))}),id:r.current++};l(E=>{var C;return{results:[...E.results,p],selectedResult:(C=E.selectedResult)!=null?C:p}})},[n]),c=(0,e.useMemo)(()=>({...a,selectResult:o,deleteResult:i,execute:d}),[a,o,i,d]);return e.createElement(ze.Provider,{value:c},t.children)}function q(){const t=(0,e.useContext)(ze);if(!t)throw new Error("must be used within a DryRunProvider");return t}var dn=s(27616),un=s(70660),fn=s(8284),oe=s(85256),pn=s(84905),En=s(67693),$e=s(11776),hn=s(38402),gn=s(25859),yn=s(49166),vn=s(98281),Cn=s(22983);const Zn=(0,A.Z)(t=>({root:{overflowY:"auto",background:t.palette.background.default},iconSuccess:{minWidth:0,marginRight:t.spacing(1),color:t.palette.status.ok},iconFailure:{minWidth:0,marginRight:t.spacing(1),color:t.palette.status.error}}));function Tn(){const t=Zn(),n=q();return e.createElement($e.Z,{className:t.root,dense:!0},n.results.map(a=>{var r;const l=a.log.some(o=>o.body.status==="failed");return e.createElement(hn.Z,{button:!0,key:a.id,selected:((r=n.selectedResult)==null?void 0:r.id)===a.id,onClick:()=>n.selectResult(a.id)},e.createElement(ae.Z,{className:l?t.iconFailure:t.iconSuccess},l?e.createElement(yn.Z,null):e.createElement(vn.Z,null)),e.createElement(re.Z,{primary:`Result ${a.id}`}),e.createElement(gn.Z,null,e.createElement(M.Z,{edge:"end","aria-label":"delete",onClick:()=>n.deleteResult(a.id)},e.createElement(Cn.Z,null))))}))}var Ze=s(77120),Te=s(42123),Se=s(6487),Sn=s(99152),xe=s(94132),xn=s(28635),Rn=s(86193),An=s(14348),Pn=s(38016),bn=s(51209),Ve=s(26659);const wn=(0,A.Z)({root:{whiteSpace:"nowrap",overflowY:"auto"}});function Fn(t){const n={type:"directory",name:"",path:"",children:[]};for(const a of t.slice().sort()){const l=a.split("/");let r=n;for(let o=0;o<l.length;o++){const i=l[o];if(i==="")throw new Error("Invalid path part: ''");const d=l.slice(0,o+1).join("/"),c=r.children.find(m=>m.name===i);if((c==null?void 0:c.type)==="file")throw new Error(`Duplicate filename at '${d}'`);if(c)r=c;else if(o<l.length-1){const m={type:"directory",name:i,path:d,children:[]},u=r.children.findIndex(f=>f.type==="file");r.children.splice(u,0,m),r=m}else r.children.push({type:"file",name:i,path:d})}}return n.children}function Ge({entry:t}){return t.type==="file"?e.createElement(Ve.Z,{nodeId:t.path,label:t.name}):e.createElement(Ve.Z,{nodeId:t.path,label:t.name},t.children.map(n=>e.createElement(Ge,{key:n.path,entry:n})))}function Ke(t){const n=wn(),a=(0,e.useMemo)(()=>Fn(t.filePaths),[t.filePaths]);return e.createElement(An.Z,{selected:t.selected,className:n.root,defaultCollapseIcon:e.createElement(Pn.Z,null),defaultExpandIcon:e.createElement(bn.Z,null),onNodeSelect:(l,r)=>{t.onSelect&&t.filePaths.includes(r)&&t.onSelect(r)}},a.map(l=>e.createElement(Ge,{key:l.path,entry:l})))}const Nn=(0,A.Z)(t=>({root:{display:"grid",gridTemplateColumns:"280px auto 3fr",gridTemplateRows:"1fr"},child:{overflowY:"auto",height:"100%",minHeight:0},firstChild:{background:t.palette.background.paper}}));function Re(t){const n=Nn(),a=e.Children.toArray(t.children);if(a.length!==2)throw new Error("must have exactly 2 children");return e.createElement("div",{className:n.root},e.createElement("div",{className:Me()(n.child,n.firstChild)},a[0]),e.createElement(oe.Z,{orientation:"horizontal"}),e.createElement("div",{className:n.child},a[1]))}const Ae=(0,A.Z)({root:{display:"flex",flexFlow:"column nowrap"},contentWrapper:{flex:1,position:"relative"},content:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex","& > *":{flex:1}},codeMirror:{height:"100%",overflowY:"auto"}});function Dn(){const t=Ae(),{selectedResult:n}=q(),[a,l]=(0,e.useState)(""),r=n==null?void 0:n.directoryContents.find(o=>o.path===a);return(0,e.useEffect)(()=>{if(n){const[o]=n.directoryContents;l(o?o.path:"")}},[n]),n?e.createElement(Re,null,e.createElement(Ke,{selected:a,onSelect:l,filePaths:n.directoryContents.map(o=>o.path)}),e.createElement(xe.ZP,{className:t.codeMirror,theme:"dark",height:"100%",extensions:[Ze.il.define(Te.r)],readOnly:!0,value:r!=null&&r.base64Content?atob(r.base64Content):""})):null}function On(){var o,i;const{selectedResult:t}=q(),[n,a]=(0,e.useState)(),l=(0,e.useMemo)(()=>{var d;return t?(d=t.steps.map(c=>{var u,f;const m=t.log.filter(p=>p.body.stepId===c.id);return{id:c.id,name:c.name,logString:m.map(p=>p.body.message).join(`
`),status:(f=(u=m[m.length-1])==null?void 0:u.body.status)!=null?f:"completed"}}))!=null?d:[]:[]},[t]);if(!t)return null;const r=(o=l.find(d=>d.id===n))!=null?o:l[0];return e.createElement(Re,null,e.createElement(xn.U,{steps:l,currentStepId:r.id,onUserStepChange:a}),e.createElement(h.LogViewer,{text:(i=r==null?void 0:r.logString)!=null?i:""}))}function In(){var a,l;const t=Ae(),{selectedResult:n}=q();return n?e.createElement(Re,null,e.createElement(U.Z,{pt:2},((l=(a=n.output)==null?void 0:a.links)==null?void 0:l.length)&&e.createElement(Rn.G,{output:n.output})),e.createElement(xe.ZP,{className:t.codeMirror,theme:"dark",height:"100%",extensions:[Ze.il.define(Te.r)],readOnly:!0,value:JSON.stringify(n.output,null,2)})):null}function Ln(){const t=Ae(),[n,a]=(0,e.useState)("files");return e.createElement("div",{className:t.root},e.createElement(Sn.Z,{value:n,onChange:(l,r)=>a(r)},e.createElement(Se.Z,{value:"files",label:"Files"}),e.createElement(Se.Z,{value:"log",label:"Log"}),e.createElement(Se.Z,{value:"output",label:"Output"})),e.createElement(oe.Z,null),e.createElement("div",{className:t.contentWrapper},e.createElement("div",{className:t.content},n==="files"&&e.createElement(Dn,null),n==="log"&&e.createElement(On,null),n==="output"&&e.createElement(In,null))))}const kn=(0,A.Z)(t=>({header:{height:48,minHeight:0,"&.Mui-expanded":{height:48,minHeight:0}},content:{display:"grid",background:t.palette.background.default,gridTemplateColumns:"180px auto 1fr",gridTemplateRows:"1fr",padding:0,height:400}}));function Bn(){const t=kn(),n=q(),[a,l]=(0,e.useState)(!1),[r,o]=(0,e.useState)(!0),i=n.results.length,d=(0,En.D)(i);return(0,e.useEffect)(()=>{d===0&&i===1?(o(!1),l(!0)):d===1&&i===0&&l(!1)},[d,i]),e.createElement(e.Fragment,null,e.createElement(dn.Z,{variant:"outlined",expanded:a,hidden:i===0&&r,onChange:(c,m)=>l(m),onTransitionEnd:()=>i===0&&o(!0)},e.createElement(fn.Z,{className:t.header,expandIcon:e.createElement(pn.Z,null)},e.createElement(x.Z,null,"Dry-run results")),e.createElement(oe.Z,{orientation:"horizontal"}),e.createElement(un.Z,{className:t.content},e.createElement(Tn,null),e.createElement(oe.Z,{orientation:"horizontal"}),e.createElement(Ln,null))))}var Ye=s(87685),Je=s(49423),Qe=s(96401);const Mn=(0,A.Z)(t=>({button:{padding:t.spacing(1)},buttons:{display:"flex",flexFlow:"row nowrap",alignItems:"center",justifyContent:"flex-start"},buttonsGap:{flex:"1 1 auto"},buttonsDivider:{marginBottom:t.spacing(1)}}));function Wn(t){var o,i;const n=Mn(),a=ve(),l=a.files.filter(d=>d.dirty),r=()=>{!t.onClose||l.length>0&&!window.confirm("Are you sure? Unsaved changes will be lost")||t.onClose()};return e.createElement(e.Fragment,null,e.createElement("div",{className:n.buttons},e.createElement($.ZP,{title:"Save all files"},e.createElement(M.Z,{className:n.button,disabled:a.files.every(d=>!d.dirty),onClick:()=>a.save()},e.createElement(Qe.Z,null))),e.createElement($.ZP,{title:"Reload directory"},e.createElement(M.Z,{className:n.button,onClick:()=>a.reload()},e.createElement(Je.Z,null))),e.createElement("div",{className:n.buttonsGap}),e.createElement($.ZP,{title:"Close directory"},e.createElement(M.Z,{className:n.button,onClick:r},e.createElement(Ye.Z,null)))),e.createElement(oe.Z,{className:n.buttonsDivider}),e.createElement(Ke,{selected:(i=(o=a.selectedFile)==null?void 0:o.path)!=null?i:"",onSelect:a.setSelectedFile,filePaths:a.files.map(d=>d.path)}))}var Hn=s(48760);const Un=(0,A.Z)({containerWrapper:{position:"relative",width:"100%",height:"100%"},container:{position:"absolute",top:0,bottom:0,left:0,right:0,overflow:"auto"}});class jn extends e.Component{constructor(){super(...arguments);Fe(this,"state",{shouldRender:!0})}componentDidUpdate(a){a.invalidator!==this.props.invalidator&&this.setState({shouldRender:!0})}componentDidCatch(a){this.props.setErrorText(a.message),this.setState({shouldRender:!1})}render(){return this.state.shouldRender?this.props.children:null}}function Pe(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function de(t){const{content:n,contentIsSpec:a,data:l,onUpdate:r,onDryRun:o,setErrorText:i,fieldExtensions:d=[]}=t,c=Un(),m=(0,y.useApiHolder)(),[u,f]=(0,e.useState)(),p=(0,e.useMemo)(()=>Object.fromEntries(d.map(({name:E,component:C})=>[E,C])),[d]);return(0,Hn.Z)(()=>{try{if(!n){f(void 0);return}const E=Ce().parse(n);if(!Pe(E)){f(void 0);return}let C=E;if(!a){if(!(String(E.kind).toLocaleLowerCase("en-US")==="template")){f(void 0);return}C=Pe(E.spec)?E.spec:{}}const{parameters:N}=C;if(!Array.isArray(N)){i("Template parameters must be an array"),f(void 0);return}const k=Object.fromEntries(d.map(({name:D,validation:R})=>[D,R]));i(),f(N.flatMap(D=>Pe(D)?[{title:String(D.title),schema:D,validate:ke(D,k,{apiHolder:m})}]:[]))}catch(E){i(E.message)}},250,[a,n,m]),u?e.createElement("div",{className:c.containerWrapper},e.createElement("div",{className:c.container},e.createElement(jn,{invalidator:u,setErrorText:i},e.createElement(Le,{steps:u,fields:p,formData:l,onChange:E=>r(E.formData),onReset:()=>r({}),finishButtonLabel:o&&"Try It",onFinish:o&&(()=>o(l))})))):null}function zn(t){const{setErrorText:n,fieldExtensions:a=[]}=t,l=q(),r=ve(),{selectedFile:o}=r,[i,d]=(0,e.useState)({}),c=async()=>{!o||await l.execute({templateContent:o.content,values:i,files:r.files})},m=o&&o.path.match(/\.ya?ml$/)?o.content:void 0;return e.createElement(de,{onDryRun:c,fieldExtensions:a,setErrorText:n,content:m,data:i,onUpdate:d})}de.DirectoryEditorDryRun=zn;var Xe=s(11445),$n=s(96573);const Vn=(0,A.Z)(t=>({container:{position:"relative",width:"100%",height:"100%"},codeMirror:{position:"absolute",top:0,bottom:0,left:0,right:0},errorPanel:{color:t.palette.error.main,lineHeight:2,margin:t.spacing(0,1)},floatingButtons:{position:"absolute",top:t.spacing(1),right:t.spacing(3)},floatingButton:{padding:t.spacing(1)}}));function ue(t){const{errorText:n}=t,a=Vn(),l=(0,e.useMemo)(()=>{if(!n)return Xe.mH.of(null);const r=document.createElement("div");return r.classList.add(a.errorPanel),r.textContent=n,Xe.mH.of(()=>({dom:r,bottom:!0}))},[a,n]);return(0,$n.v)(r=>r.key==="s"&&(r.ctrlKey||r.metaKey),r=>{r.preventDefault(),t.onSave&&t.onSave()}),e.createElement("div",{className:a.container},e.createElement(xe.ZP,{className:a.codeMirror,theme:"dark",height:"100%",extensions:[Ze.il.define(Te.r),l],value:t.content,onChange:t.onUpdate}),(t.onSave||t.onReload)&&e.createElement("div",{className:a.floatingButtons},e.createElement(ge.Z,null,t.onSave&&e.createElement($.ZP,{title:"Save file"},e.createElement(M.Z,{className:a.floatingButton,onClick:()=>{var r;return(r=t.onSave)==null?void 0:r.call(t)}},e.createElement(Qe.Z,null))),t.onReload&&e.createElement($.ZP,{title:"Reload file"},e.createElement(M.Z,{className:a.floatingButton,onClick:()=>{var r;return(r=t.onReload)==null?void 0:r.call(t)}},e.createElement(Je.Z,null))))))}function Gn(t){var l,r;const n=ve(),a=(l=n.selectedFile)!=null&&l.dirty?{onSave:()=>n.save(),onReload:()=>n.reload()}:{onReload:()=>n.reload()};return e.createElement(ue,{errorText:t.errorText,content:(r=n.selectedFile)==null?void 0:r.content,onUpdate:o=>{var i;return(i=n.selectedFile)==null?void 0:i.updateContent(o)},...a})}ue.DirectoryEditor=Gn;const Kn=(0,A.Z)({root:{gridArea:"pageContent",display:"grid",gridTemplateAreas:`
      "browser editor preview"
      "results results results"
    `,gridTemplateColumns:"1fr 3fr 2fr",gridTemplateRows:"1fr auto"},browser:{gridArea:"browser",overflow:"auto"},editor:{gridArea:"editor",overflow:"auto"},preview:{gridArea:"preview",overflow:"auto"},results:{gridArea:"results"}}),Yn=t=>{const n=Kn(),[a,l]=(0,e.useState)();return e.createElement(ln,{directory:t.directory},e.createElement(mn,null,e.createElement("main",{className:n.root},e.createElement("section",{className:n.browser},e.createElement(Wn,{onClose:t.onClose})),e.createElement("section",{className:n.editor},e.createElement(ue.DirectoryEditor,{errorText:a})),e.createElement("section",{className:n.preview},e.createElement(de.DirectoryEditorDryRun,{setErrorText:l,fieldExtensions:t.fieldExtensions})),e.createElement("section",{className:n.results},e.createElement(Bn,null)))))};var Jn=s(42494),Qn=s(56939),Xn=s(73698);const qn=`# Edit the template parameters below to see how they will render in the scaffolder form UI
parameters:
  - title: Fill in some steps
    required:
      - name
    properties:
      name:
        title: Name
        type: string
        description: Unique name of the component
      owner:
        title: Owner
        type: string
        description: Owner of the component
        ui:field: OwnerPicker
        ui:options:
          allowedKinds:
            - Group
  - title: Choose a location
    required:
      - repoUrl
    properties:
      repoUrl:
        title: Repository Location
        type: string
        ui:field: RepoUrlPicker
        ui:options:
          allowedHosts:
            - github.com
steps:
  - id: fetch-base
    name: Fetch Base
    action: fetch:template
    input:
      url: ./template
      values:
        name: \${{parameters.name}}
`,_n=(0,A.Z)(t=>({root:{gridArea:"pageContent",display:"grid",gridTemplateAreas:`
      "controls controls"
      "textArea preview"
    `,gridTemplateRows:"auto 1fr",gridTemplateColumns:"1fr 1fr"},controls:{gridArea:"controls",display:"flex",flexFlow:"row nowrap",alignItems:"center",margin:t.spacing(1)},textArea:{gridArea:"textArea"},preview:{gridArea:"preview"}})),ea=({defaultPreviewTemplate:t=qn,customFieldExtensions:n=[],onClose:a})=>{const l=_n(),r=(0,y.useApi)(y.alertApiRef),o=(0,y.useApi)(T.catalogApiRef),[i,d]=(0,e.useState)(""),[c,m]=(0,e.useState)(),[u,f]=(0,e.useState)([]),[p,E]=(0,e.useState)(t),[C,N]=(0,e.useState)({}),{loading:k}=(0,Q.default)(()=>o.getEntities({filter:{kind:"template"},fields:["kind","metadata.namespace","metadata.name","metadata.title","spec.parameters","spec.steps","spec.output"]}).then(({items:R})=>f(R.map(Z=>{var O;return{label:(O=Z.metadata.title)!=null?O:(0,T.humanizeEntityRef)(Z,{defaultKind:"template"}),value:Z}}))).catch(R=>r.post({message:`Error loading exisiting templates: ${R.message}`,severity:"error"})),[o]),D=(0,e.useCallback)(R=>{d(R),E(Ce().stringify(R.spec))},[E]);return e.createElement(e.Fragment,null,k&&e.createElement(Oe.Z,null),e.createElement("main",{className:l.root},e.createElement("div",{className:l.controls},e.createElement(Jn.Z,{variant:"outlined",size:"small",fullWidth:!0},e.createElement(Qn.Z,{id:"select-template-label"},"Load Existing Template"),e.createElement(Xn.Z,{value:i,label:"Load Existing Template",labelId:"select-template-label",onChange:R=>D(R.target.value)},u.map((R,Z)=>e.createElement(le.Z,{key:Z,value:R.value},R.label)))),e.createElement(M.Z,{size:"medium",onClick:a},e.createElement(Ye.Z,null))),e.createElement("div",{className:l.textArea},e.createElement(ue,{content:p,onUpdate:E,errorText:c})),e.createElement("div",{className:l.preview},e.createElement(de,{content:p,contentIsSpec:!0,fieldExtensions:n,data:C,onUpdate:N,setErrorText:m}))))};function ta(t){const[n,a]=(0,e.useState)();let l=null;return(n==null?void 0:n.type)==="local"?l=e.createElement(Yn,{directory:n.directory,fieldExtensions:t.customFieldExtensions,onClose:()=>a(void 0)}):(n==null?void 0:n.type)==="form"?l=e.createElement(ea,{defaultPreviewTemplate:t.defaultPreviewTemplate,customFieldExtensions:t.customFieldExtensions,onClose:()=>a(void 0)}):l=e.createElement(h.Content,null,e.createElement(qt,{onSelect:r=>{r==="local"?We.requestDirectoryAccess().then(o=>a({type:"local",directory:o})).catch(()=>{}):r==="form"&&a({type:"form"})}})),e.createElement(h.Page,{themeId:"home"},e.createElement(h.Header,{title:"Template Editor",subtitle:"Edit, preview, and try out templates and template forms"}),l)}var be=s(27542),na=s(67222),aa=s(47603),ra=s(56881);const la=(0,A.Z)(t=>({root:{backgroundColor:"rgba(0, 0, 0, .11)",boxShadow:"none",margin:t.spacing(1,0,1,0)},title:{margin:t.spacing(1,0,0,1),textTransform:"uppercase",fontSize:12,fontWeight:"bold"},listIcon:{minWidth:30,color:t.palette.text.primary},menuItem:{minHeight:t.spacing(6)},groupWrapper:{margin:t.spacing(1,1,2,1)}}),{name:"ScaffolderReactOwnerListPicker"});function sa(){return[{name:"Task Owner",items:[{id:"owned",label:"Owned",icon:aa.Z},{id:"all",label:"All",icon:ra.Z}]}]}const oa=t=>{const{filter:n,onSelectOwner:a}=t,l=la(),r=sa();return e.createElement(ne.Z,{className:l.root},r.map(o=>e.createElement(e.Fragment,{key:o.name},e.createElement(x.Z,{variant:"subtitle2",className:l.title},o.name),e.createElement(ne.Z,{className:l.groupWrapper},e.createElement($e.Z,{disablePadding:!0,dense:!0},o.items.map(i=>e.createElement(le.Z,{key:i.id,button:!0,divider:!0,onClick:()=>a(i.id),selected:i.id===n,className:l.menuItem,"data-testid":`owner-picker-${i.id}`},i.icon&&e.createElement(ae.Z,{className:l.listIcon},e.createElement(i.icon,{fontSize:"small"})),e.createElement(re.Z,null,e.createElement(x.Z,{variant:"body1"},i.label)))))))))};var we=s(96299),ia=s(75951),ca=s.n(ia);const ma=({createdAt:t})=>{const n=we.ou.fromISO(t),a=we.Xp.fromDateTimes(n,we.ou.local()).toDuration().valueOf();return e.createElement("p",null,ca()(a,{round:!0})," ago")},da=({entityRef:t})=>{var o,i,d;const n=(0,y.useApi)(T.catalogApiRef),{value:a,loading:l,error:r}=(0,Q.default)(()=>n.getEntityByRef(t||""),[n,t]);return t?l||r?null:e.createElement(T.EntityRefLink,{entityRef:(0,te.of)(t),title:(d=(i=(o=a==null?void 0:a.spec)==null?void 0:o.profile)==null?void 0:i.displayName)!=null?d:a==null?void 0:a.metadata.name}):e.createElement("p",null,"Unknown")},ua=({status:t})=>{switch(t){case"processing":return e.createElement(h.StatusPending,null,t);case"completed":return e.createElement(h.StatusOK,null,t);case"error":default:return e.createElement(h.StatusError,null,t)}},fa=({entityRef:t})=>{const n=(0,y.useApi)(X.l),{value:a,loading:l,error:r}=(0,Q.default)(()=>n.getTemplateParameterSchema(t||""),[n,t]);return l||r||!t?null:e.createElement(T.EntityRefLink,{entityRef:(0,te.of)(t),title:a==null?void 0:a.title})},pa=t=>{var m;const{initiallySelectedFilter:n="owned"}=t,a=(0,y.useApi)(X.l),l=(0,y.useRouteRef)(F._Z),[r,o]=(0,e.useState)(n),{value:i,loading:d,error:c}=(0,Q.default)(()=>{var u;return a.listTasks?(u=a.listTasks)==null?void 0:u.call(a,{filterByOwnership:r}):(console.warn("listTasks is not implemented in the scaffolderApi, please make sure to implement this method."),Promise.resolve({tasks:[]}))},[a,r]);return d?e.createElement(h.Progress,null):c?e.createElement(e.Fragment,null,e.createElement(h.ErrorPanel,{error:c}),e.createElement(h.EmptyState,{missing:"info",title:"No information to display",description:"There is no Tasks or there was an issue communicating with backend."})):e.createElement(T.CatalogFilterLayout,null,e.createElement(T.CatalogFilterLayout.Filters,null,e.createElement(oa,{filter:r,onSelectOwner:u=>o(u)})),e.createElement(T.CatalogFilterLayout.Content,null,e.createElement(na.ZP,{data:(m=i==null?void 0:i.tasks)!=null?m:[],title:"Tasks",columns:[{title:"Task ID",field:"id",render:u=>e.createElement(h.Link,{to:`${l()}/tasks/${u.id}`},u.id)},{title:"Template",render:u=>{var f;return e.createElement(fa,{entityRef:(f=u.spec.templateInfo)==null?void 0:f.entityRef})}},{title:"Created",field:"createdAt",render:u=>e.createElement(ma,{createdAt:u.createdAt})},{title:"Owner",field:"createdBy",render:u=>{var f,p;return e.createElement(da,{entityRef:(p=(f=u.spec)==null?void 0:f.user)==null?void 0:p.ref})}},{title:"Status",field:"status",render:u=>e.createElement(ua,{status:u.status})}]})))},Ea=t=>e.createElement(h.Page,{themeId:"home"},e.createElement(h.Header,{pageTitleOverride:"Templates Tasks",title:e.createElement(e.Fragment,null,"List template tasks ",e.createElement(h.Lifecycle,{shorthand:!0,alpha:!0})),subtitle:"All tasks that have been started"}),e.createElement(h.Content,null,e.createElement(pa,{...t}))),ha=t=>{const{groups:n,components:a={},defaultPreviewTemplate:l}=t,{TemplateCardComponent:r,TaskPageComponent:o}=a,i=(0,b.pC)(),d=o!=null?o:Ht.Y,c=(0,y.useElementFilter)(i,u=>u.selectByComponentData({key:be.n0}).findComponentData({key:be.rL})),m=[...c,...be.zc.filter(({name:u})=>!c.some(f=>f.name===u))];return e.createElement(b.Z5,null,e.createElement(b.AW,{element:e.createElement(St,{groups:n,TemplateCardComponent:r,contextMenu:t.contextMenu})}),e.createElement(b.AW,{path:F.QQ.path,element:e.createElement(he.A3,null,e.createElement(Wt,{customFieldExtensions:m}))}),e.createElement(b.AW,{path:F.p3.path,element:e.createElement(Ea,null)}),e.createElement(b.AW,{path:F.gV.path,element:e.createElement(d,null)}),e.createElement(b.AW,{path:F._H.path,element:e.createElement(Kt,null)}),e.createElement(b.AW,{path:F.Wp.path,element:e.createElement(he.A3,null,e.createElement(ta,{defaultPreviewTemplate:l,customFieldExtensions:m}))}),e.createElement(b.AW,{path:"preview",element:e.createElement(b.Fg,{to:"../edit"})}))}}}]);})();

//# sourceMappingURL=7732.04991d2b.chunk.js.map