{"version":3,"file":"index.cjs.js","sources":["../src/manifest.ts"],"sourcesContent":["/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport fetch from 'cross-fetch';\n\nconst VERSIONS_DOMAIN = 'https://versions.backstage.io';\n\n/**\n * Contains mapping between Backstage release and package versions.\n * @public\n */\nexport type ReleaseManifest = {\n  releaseVersion: string;\n  packages: { name: string; version: string }[];\n};\n\n/**\n * Options for {@link getManifestByVersion}.\n * @public\n */\nexport type GetManifestByVersionOptions = {\n  version: string;\n};\n\n/**\n * Returns a release manifest based on supplied version.\n * @public\n */\nexport async function getManifestByVersion(\n  options: GetManifestByVersionOptions,\n): Promise<ReleaseManifest> {\n  const url = `${VERSIONS_DOMAIN}/v1/releases/${encodeURIComponent(\n    options.version,\n  )}/manifest.json`;\n  const response = await fetch(url);\n  if (response.status === 404) {\n    throw new Error(`No release found for ${options.version} version`);\n  }\n  if (response.status !== 200) {\n    throw new Error(\n      `Unexpected response status ${response.status} when fetching release from ${url}.`,\n    );\n  }\n  return await response.json();\n}\n\n/**\n * Options for {@link getManifestByReleaseLine}.\n * @public\n */\nexport type GetManifestByReleaseLineOptions = {\n  releaseLine: string;\n};\n\n/**\n * Returns a release manifest based on supplied release line.\n * @public\n */\nexport async function getManifestByReleaseLine(\n  options: GetManifestByReleaseLineOptions,\n): Promise<ReleaseManifest> {\n  const url = `${VERSIONS_DOMAIN}/v1/tags/${encodeURIComponent(\n    options.releaseLine,\n  )}/manifest.json`;\n  const response = await fetch(url);\n  if (response.status === 404) {\n    throw new Error(`No '${options.releaseLine}' release line found`);\n  }\n  if (response.status !== 200) {\n    throw new Error(\n      `Unexpected response status ${response.status} when fetching release from ${url}.`,\n    );\n  }\n  return await response.json();\n}\n"],"names":["fetch"],"mappings":";;;;;;;;;;AACA,MAAM,eAAe,GAAG,+BAA+B,CAAC;AACjD,eAAe,oBAAoB,CAAC,OAAO,EAAE;AACpD,EAAE,MAAM,GAAG,GAAG,CAAC,EAAE,eAAe,CAAC,aAAa,EAAE,kBAAkB,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,cAAc,CAAC,CAAC;AACpG,EAAE,MAAM,QAAQ,GAAG,MAAMA,yBAAK,CAAC,GAAG,CAAC,CAAC;AACpC,EAAE,IAAI,QAAQ,CAAC,MAAM,KAAK,GAAG,EAAE;AAC/B,IAAI,MAAM,IAAI,KAAK,CAAC,CAAC,qBAAqB,EAAE,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,CAAC;AACvE,GAAG;AACH,EAAE,IAAI,QAAQ,CAAC,MAAM,KAAK,GAAG,EAAE;AAC/B,IAAI,MAAM,IAAI,KAAK,CAAC,CAAC,2BAA2B,EAAE,QAAQ,CAAC,MAAM,CAAC,4BAA4B,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;AACxG,GAAG;AACH,EAAE,OAAO,MAAM,QAAQ,CAAC,IAAI,EAAE,CAAC;AAC/B,CAAC;AACM,eAAe,wBAAwB,CAAC,OAAO,EAAE;AACxD,EAAE,MAAM,GAAG,GAAG,CAAC,EAAE,eAAe,CAAC,SAAS,EAAE,kBAAkB,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC,cAAc,CAAC,CAAC;AACpG,EAAE,MAAM,QAAQ,GAAG,MAAMA,yBAAK,CAAC,GAAG,CAAC,CAAC;AACpC,EAAE,IAAI,QAAQ,CAAC,MAAM,KAAK,GAAG,EAAE;AAC/B,IAAI,MAAM,IAAI,KAAK,CAAC,CAAC,IAAI,EAAE,OAAO,CAAC,WAAW,CAAC,oBAAoB,CAAC,CAAC,CAAC;AACtE,GAAG;AACH,EAAE,IAAI,QAAQ,CAAC,MAAM,KAAK,GAAG,EAAE;AAC/B,IAAI,MAAM,IAAI,KAAK,CAAC,CAAC,2BAA2B,EAAE,QAAQ,CAAC,MAAM,CAAC,4BAA4B,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;AACxG,GAAG;AACH,EAAE,OAAO,MAAM,QAAQ,CAAC,IAAI,EAAE,CAAC;AAC/B;;;;;"}