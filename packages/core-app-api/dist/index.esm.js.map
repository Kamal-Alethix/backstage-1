{"version":3,"file":"index.esm.js","sources":["../src/apis/system/ApiAggregator.ts","../src/apis/system/ApiProvider.tsx","../src/apis/system/ApiResolver.ts","../src/apis/system/ApiFactoryRegistry.ts","../src/lib/loginPopup.ts","../src/lib/AuthConnector/DefaultAuthConnector.ts","../src/lib/AuthConnector/DirectAuthConnector.ts","../src/lib/AuthSessionManager/common.ts","../src/lib/subjects.ts","../src/lib/AuthSessionManager/SessionStateTracker.ts","../src/lib/AuthSessionManager/RefreshingAuthSessionManager.ts","../src/lib/AuthSessionManager/StaticAuthSessionManager.ts","../src/lib/AuthSessionManager/AuthSessionStore.ts","../src/apis/implementations/auth/oauth2/OAuth2.ts","../src/apis/implementations/auth/github/GithubAuth.ts","../src/apis/implementations/auth/gitlab/GitlabAuth.ts","../src/apis/implementations/auth/google/GoogleAuth.ts","../src/apis/implementations/auth/okta/OktaAuth.ts","../src/apis/implementations/auth/saml/types.ts","../src/apis/implementations/auth/saml/SamlAuth.ts","../src/apis/implementations/auth/microsoft/MicrosoftAuth.ts","../src/apis/implementations/auth/onelogin/OneLoginAuth.ts","../src/apis/implementations/auth/bitbucket/BitbucketAuth.ts","../src/apis/implementations/auth/atlassian/AtlassianAuth.ts","../src/apis/implementations/AlertApi/AlertApiForwarder.ts","../src/apis/implementations/AnalyticsApi/NoOpAnalyticsApi.ts","../src/apis/implementations/AppThemeApi/AppThemeSelector.ts","../src/apis/implementations/DiscoveryApi/UrlPatternDiscovery.ts","../src/apis/implementations/ErrorApi/ErrorAlerter.ts","../src/apis/implementations/ErrorApi/ErrorApiForwarder.ts","../src/apis/implementations/ErrorApi/UnhandledErrorForwarder.ts","../src/apis/implementations/FeatureFlagsApi/LocalStorageFeatureFlags.tsx","../src/apis/implementations/FetchApi/createFetchApi.ts","../src/apis/implementations/FetchApi/IdentityAuthInjectorFetchMiddleware.ts","../src/apis/implementations/FetchApi/PluginProtocolResolverFetchMiddleware.ts","../src/apis/implementations/FetchApi/FetchMiddlewares.ts","../src/apis/implementations/OAuthRequestApi/OAuthPendingRequests.ts","../src/apis/implementations/OAuthRequestApi/OAuthRequestManager.ts","../src/apis/implementations/StorageApi/WebStorage.ts","../src/extensions/traversal.ts","../src/plugins/collectors.ts","../src/routing/FeatureFlagged.tsx","../src/routing/collectors.tsx","../src/routing/types.ts","../src/routing/RouteResolver.ts","../src/routing/RoutingProvider.tsx","../src/routing/RouteTracker.tsx","../src/routing/validation.ts","../src/app/AppContext.tsx","../src/apis/implementations/IdentityApi/AppIdentityProxy.ts","../src/app/AppThemeProvider.tsx","../src/app/defaultConfigLoader.ts","../src/apis/system/ApiRegistry.ts","../src/app/resolveRouteBindings.ts","../src/app/AppManager.tsx","../src/app/createSpecializedApp.tsx","../src/routing/FlatRoutes.tsx"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ApiRef, ApiHolder } from '@backstage/core-plugin-api';\n\n/**\n * An ApiHolder that queries multiple other holders from for\n * an Api implementation, returning the first one encountered..\n */\nexport class ApiAggregator implements ApiHolder {\n  private readonly holders: ApiHolder[];\n\n  constructor(...holders: ApiHolder[]) {\n    this.holders = holders;\n  }\n\n  get<T>(apiRef: ApiRef<T>): T | undefined {\n    for (const holder of this.holders) {\n      const api = holder.get(apiRef);\n      if (api) {\n        return api;\n      }\n    }\n    return undefined;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useContext, ReactNode, PropsWithChildren } from 'react';\nimport PropTypes from 'prop-types';\nimport { ApiHolder } from '@backstage/core-plugin-api';\nimport { ApiAggregator } from './ApiAggregator';\nimport {\n  createVersionedValueMap,\n  createVersionedContext,\n} from '@backstage/version-bridge';\n\n/**\n * Prop types for the ApiProvider component.\n * @public\n */\nexport type ApiProviderProps = {\n  apis: ApiHolder;\n  children: ReactNode;\n};\n\nconst ApiContext = createVersionedContext<{ 1: ApiHolder }>('api-context');\n\n/**\n * Provides an {@link @backstage/core-plugin-api#ApiHolder} for consumption in\n * the React tree.\n *\n * @public\n */\nexport const ApiProvider = (props: PropsWithChildren<ApiProviderProps>) => {\n  const { apis, children } = props;\n  const parentHolder = useContext(ApiContext)?.atVersion(1);\n  const holder = parentHolder ? new ApiAggregator(apis, parentHolder) : apis;\n\n  return (\n    <ApiContext.Provider\n      value={createVersionedValueMap({ 1: holder })}\n      children={children}\n    />\n  );\n};\n\nApiProvider.propTypes = {\n  apis: PropTypes.shape({ get: PropTypes.func.isRequired }).isRequired,\n  children: PropTypes.node,\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  ApiRef,\n  ApiHolder,\n  AnyApiRef,\n  TypesToApiRefs,\n} from '@backstage/core-plugin-api';\nimport { ApiFactoryHolder } from './types';\n\n/**\n * Handles the actual on-demand instantiation and memoization of APIs out of\n * an {@link ApiFactoryHolder}.\n *\n * @public\n */\nexport class ApiResolver implements ApiHolder {\n  /**\n   * Validate factories by making sure that each of the apis can be created\n   * without hitting any circular dependencies.\n   */\n  static validateFactories(\n    factories: ApiFactoryHolder,\n    apis: Iterable<AnyApiRef>,\n  ) {\n    for (const api of apis) {\n      const heap = [api];\n      const allDeps = new Set<AnyApiRef>();\n\n      while (heap.length) {\n        const apiRef = heap.shift()!;\n        const factory = factories.get(apiRef);\n        if (!factory) {\n          continue;\n        }\n\n        for (const dep of Object.values(factory.deps)) {\n          if (dep.id === api.id) {\n            throw new Error(`Circular dependency of api factory for ${api}`);\n          }\n          if (!allDeps.has(dep)) {\n            allDeps.add(dep);\n            heap.push(dep);\n          }\n        }\n      }\n    }\n  }\n\n  private readonly apis = new Map<string, unknown>();\n\n  constructor(private readonly factories: ApiFactoryHolder) {}\n\n  get<T>(ref: ApiRef<T>): T | undefined {\n    return this.load(ref);\n  }\n\n  private load<T>(ref: ApiRef<T>, loading: AnyApiRef[] = []): T | undefined {\n    const impl = this.apis.get(ref.id);\n    if (impl) {\n      return impl as T;\n    }\n\n    const factory = this.factories.get(ref);\n    if (!factory) {\n      return undefined;\n    }\n\n    if (loading.includes(factory.api)) {\n      throw new Error(`Circular dependency of api factory for ${factory.api}`);\n    }\n\n    const deps = this.loadDeps(ref, factory.deps, [...loading, factory.api]);\n    const api = factory.factory(deps);\n    this.apis.set(ref.id, api);\n    return api as T;\n  }\n\n  private loadDeps<T>(\n    dependent: ApiRef<unknown>,\n    apis: TypesToApiRefs<T>,\n    loading: AnyApiRef[],\n  ): T {\n    const impls = {} as T;\n\n    for (const key in apis) {\n      if (apis.hasOwnProperty(key)) {\n        const ref = apis[key];\n\n        const api = this.load(ref, loading);\n        if (!api) {\n          throw new Error(\n            `No API factory available for dependency ${ref} of dependent ${dependent}`,\n          );\n        }\n        impls[key] = api;\n      }\n    }\n\n    return impls;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ApiFactoryHolder } from './types';\nimport {\n  ApiRef,\n  ApiFactory,\n  AnyApiRef,\n  AnyApiFactory,\n} from '@backstage/core-plugin-api';\n\n/**\n * Scope type when registering API factories.\n * @public\n */\nexport type ApiFactoryScope =\n  | 'default' // Default factories registered by core and plugins\n  | 'app' // Factories registered in the app, overriding default ones\n  | 'static'; // APIs that can't be overridden, e.g. config\n\nenum ScopePriority {\n  default = 10,\n  app = 50,\n  static = 100,\n}\n\ntype FactoryTuple = {\n  priority: number;\n  factory: AnyApiFactory;\n};\n\n/**\n * ApiFactoryRegistry is an ApiFactoryHolder implementation that enables\n * registration of API Factories with different scope.\n *\n * Each scope has an assigned priority, where factories registered with\n * higher priority scopes override ones with lower priority.\n *\n * @public\n */\nexport class ApiFactoryRegistry implements ApiFactoryHolder {\n  private readonly factories = new Map<string, FactoryTuple>();\n\n  /**\n   * Register a new API factory. Returns true if the factory was added\n   * to the registry.\n   *\n   * A factory will not be added to the registry if there is already\n   * an existing factory with the same or higher priority.\n   */\n  register<Api, Impl extends Api, Deps extends { [name in string]: unknown }>(\n    scope: ApiFactoryScope,\n    factory: ApiFactory<Api, Impl, Deps>,\n  ) {\n    const priority = ScopePriority[scope];\n    const existing = this.factories.get(factory.api.id);\n    if (existing && existing.priority >= priority) {\n      return false;\n    }\n\n    this.factories.set(factory.api.id, { priority, factory });\n    return true;\n  }\n\n  get<T>(\n    api: ApiRef<T>,\n  ): ApiFactory<T, T, { [x: string]: unknown }> | undefined {\n    const tuple = this.factories.get(api.id);\n    if (!tuple) {\n      return undefined;\n    }\n    return tuple.factory as ApiFactory<T, T, { [x: string]: unknown }>;\n  }\n\n  getAllApis(): Set<AnyApiRef> {\n    const refs = new Set<AnyApiRef>();\n    for (const { factory } of this.factories.values()) {\n      refs.add(factory.api);\n    }\n    return refs;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Options used to open a login popup.\n */\nexport type LoginPopupOptions = {\n  /**\n   * The URL that the auth popup should point to\n   */\n  url: string;\n\n  /**\n   * The name of the popup, as in second argument to window.open\n   */\n  name: string;\n\n  /**\n   * The origin of the final popup page that will post a message to this window.\n   */\n  origin: string;\n\n  /**\n   * The width of the popup in pixels, defaults to 500\n   */\n  width?: number;\n\n  /**\n   * The height of the popup in pixels, defaults to 700\n   */\n  height?: number;\n};\n\ntype AuthResult =\n  | {\n      type: 'authorization_response';\n      response: unknown;\n    }\n  | {\n      type: 'authorization_response';\n      error: {\n        name: string;\n        message: string;\n      };\n    };\n\n/**\n * Show a popup pointing to a URL that starts an auth flow. Implementing the receiving\n * end of the postMessage mechanism outlined in https://tools.ietf.org/html/draft-sakimura-oauth-wmrm-00\n *\n * The redirect handler of the flow should use postMessage to communicate back\n * to the app window. The message posted to the app must match the AuthResult type.\n *\n * The returned promise resolves to the response of the message that was posted from the auth popup.\n */\nexport function showLoginPopup(options: LoginPopupOptions): Promise<any> {\n  return new Promise((resolve, reject) => {\n    const width = options.width || 500;\n    const height = options.height || 700;\n    const left = window.screen.width / 2 - width / 2;\n    const top = window.screen.height / 2 - height / 2;\n\n    const popup = window.open(\n      options.url,\n      options.name,\n      `menubar=no,location=no,resizable=no,scrollbars=no,status=no,width=${width},height=${height},top=${top},left=${left}`,\n    );\n\n    let targetOrigin = '';\n\n    if (!popup || typeof popup.closed === 'undefined' || popup.closed) {\n      const error = new Error('Failed to open auth popup.');\n      error.name = 'PopupRejectedError';\n      reject(error);\n      return;\n    }\n\n    const messageListener = (event: MessageEvent) => {\n      if (event.source !== popup) {\n        return;\n      }\n      if (event.origin !== options.origin) {\n        return;\n      }\n      const { data } = event;\n\n      if (data.type === 'config_info') {\n        targetOrigin = data.targetOrigin;\n        return;\n      }\n\n      if (data.type !== 'authorization_response') {\n        return;\n      }\n      const authResult = data as AuthResult;\n\n      if ('error' in authResult) {\n        const error = new Error(authResult.error.message);\n        error.name = authResult.error.name;\n        // TODO: proper error type\n        // error.extra = authResult.error.extra;\n        reject(error);\n      } else {\n        resolve(authResult.response);\n      }\n      done();\n    };\n\n    const intervalId = setInterval(() => {\n      if (popup.closed) {\n        const errMessage = `Login failed, ${\n          targetOrigin && targetOrigin !== window.location.origin\n            ? `Incorrect app origin, expected ${targetOrigin}`\n            : 'popup was closed'\n        }`;\n        const error = new Error(errMessage);\n        error.name = 'PopupClosedError';\n        reject(error);\n        done();\n      }\n    }, 100);\n\n    function done() {\n      window.removeEventListener('message', messageListener);\n      clearInterval(intervalId);\n    }\n\n    window.addEventListener('message', messageListener);\n  });\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  OAuthRequester,\n  OAuthRequestApi,\n  AuthProviderInfo,\n  DiscoveryApi,\n} from '@backstage/core-plugin-api';\nimport { showLoginPopup } from '../loginPopup';\nimport { AuthConnector, CreateSessionOptions } from './types';\n\ntype Options<AuthSession> = {\n  /**\n   * DiscoveryApi instance used to locate the auth backend endpoint.\n   */\n  discoveryApi: DiscoveryApi;\n  /**\n   * Environment hint passed on to auth backend, for example 'production' or 'development'\n   */\n  environment: string;\n  /**\n   * Information about the auth provider to be shown to the user.\n   * The ID Must match the backend auth plugin configuration, for example 'google'.\n   */\n  provider: AuthProviderInfo;\n  /**\n   * API used to instantiate an auth requester.\n   */\n  oauthRequestApi: OAuthRequestApi;\n  /**\n   * Function used to join together a set of scopes, defaults to joining with a space character.\n   */\n  joinScopes?: (scopes: Set<string>) => string;\n  /**\n   * Function used to transform an auth response into the session type.\n   */\n  sessionTransform?(response: any): AuthSession | Promise<AuthSession>;\n};\n\nfunction defaultJoinScopes(scopes: Set<string>) {\n  return [...scopes].join(' ');\n}\n\n/**\n * DefaultAuthConnector is the default auth connector in Backstage. It talks to the\n * backend auth plugin through the standardized API, and requests user permission\n * via the OAuthRequestApi.\n */\nexport class DefaultAuthConnector<AuthSession>\n  implements AuthConnector<AuthSession>\n{\n  private readonly discoveryApi: DiscoveryApi;\n  private readonly environment: string;\n  private readonly provider: AuthProviderInfo;\n  private readonly joinScopesFunc: (scopes: Set<string>) => string;\n  private readonly authRequester: OAuthRequester<AuthSession>;\n  private readonly sessionTransform: (response: any) => Promise<AuthSession>;\n\n  constructor(options: Options<AuthSession>) {\n    const {\n      discoveryApi,\n      environment,\n      provider,\n      joinScopes = defaultJoinScopes,\n      oauthRequestApi,\n      sessionTransform = id => id,\n    } = options;\n\n    this.authRequester = oauthRequestApi.createAuthRequester({\n      provider,\n      onAuthRequest: scopes => this.showPopup(scopes),\n    });\n\n    this.discoveryApi = discoveryApi;\n    this.environment = environment;\n    this.provider = provider;\n    this.joinScopesFunc = joinScopes;\n    this.sessionTransform = sessionTransform;\n  }\n\n  async createSession(options: CreateSessionOptions): Promise<AuthSession> {\n    if (options.instantPopup) {\n      return this.showPopup(options.scopes);\n    }\n    return this.authRequester(options.scopes);\n  }\n\n  async refreshSession(): Promise<any> {\n    const res = await fetch(\n      await this.buildUrl('/refresh', { optional: true }),\n      {\n        headers: {\n          'x-requested-with': 'XMLHttpRequest',\n        },\n        credentials: 'include',\n      },\n    ).catch(error => {\n      throw new Error(`Auth refresh request failed, ${error}`);\n    });\n\n    if (!res.ok) {\n      const error: any = new Error(\n        `Auth refresh request failed, ${res.statusText}`,\n      );\n      error.status = res.status;\n      throw error;\n    }\n\n    const authInfo = await res.json();\n\n    if (authInfo.error) {\n      const error = new Error(authInfo.error.message);\n      if (authInfo.error.name) {\n        error.name = authInfo.error.name;\n      }\n      throw error;\n    }\n    return await this.sessionTransform(authInfo);\n  }\n\n  async removeSession(): Promise<void> {\n    const res = await fetch(await this.buildUrl('/logout'), {\n      method: 'POST',\n      headers: {\n        'x-requested-with': 'XMLHttpRequest',\n      },\n      credentials: 'include',\n    }).catch(error => {\n      throw new Error(`Logout request failed, ${error}`);\n    });\n\n    if (!res.ok) {\n      const error: any = new Error(`Logout request failed, ${res.statusText}`);\n      error.status = res.status;\n      throw error;\n    }\n  }\n\n  private async showPopup(scopes: Set<string>): Promise<AuthSession> {\n    const scope = this.joinScopesFunc(scopes);\n    const popupUrl = await this.buildUrl('/start', {\n      scope,\n      origin: location.origin,\n    });\n\n    const payload = await showLoginPopup({\n      url: popupUrl,\n      name: `${this.provider.title} Login`,\n      origin: new URL(popupUrl).origin,\n      width: 450,\n      height: 730,\n    });\n\n    return await this.sessionTransform(payload);\n  }\n\n  private async buildUrl(\n    path: string,\n    query?: { [key: string]: string | boolean | undefined },\n  ): Promise<string> {\n    const baseUrl = await this.discoveryApi.getBaseUrl('auth');\n    const queryString = this.buildQueryString({\n      ...query,\n      env: this.environment,\n    });\n\n    return `${baseUrl}/${this.provider.id}${path}${queryString}`;\n  }\n\n  private buildQueryString(query?: {\n    [key: string]: string | boolean | undefined;\n  }): string {\n    if (!query) {\n      return '';\n    }\n\n    const queryString = Object.entries<string | boolean | undefined>(query)\n      .map(([key, value]) => {\n        if (typeof value === 'string') {\n          return `${encodeURIComponent(key)}=${encodeURIComponent(value)}`;\n        } else if (value) {\n          return encodeURIComponent(key);\n        }\n        return undefined;\n      })\n      .filter(Boolean)\n      .join('&');\n\n    if (!queryString) {\n      return '';\n    }\n    return `?${queryString}`;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { AuthProviderInfo, DiscoveryApi } from '@backstage/core-plugin-api';\nimport { showLoginPopup } from '../loginPopup';\n\ntype Options = {\n  discoveryApi: DiscoveryApi;\n  environment?: string;\n  provider: AuthProviderInfo;\n};\nexport class DirectAuthConnector<DirectAuthResponse> {\n  private readonly discoveryApi: DiscoveryApi;\n  private readonly environment: string | undefined;\n  private readonly provider: AuthProviderInfo;\n\n  constructor(options: Options) {\n    const { discoveryApi, environment, provider } = options;\n\n    this.discoveryApi = discoveryApi;\n    this.environment = environment;\n    this.provider = provider;\n  }\n\n  async createSession(): Promise<DirectAuthResponse> {\n    const popupUrl = await this.buildUrl('/start');\n    const payload = await showLoginPopup({\n      url: popupUrl,\n      name: `${this.provider.title} Login`,\n      origin: new URL(popupUrl).origin,\n      width: 450,\n      height: 730,\n    });\n\n    return {\n      ...payload,\n      id: payload.profile.email,\n    };\n  }\n\n  async refreshSession(): Promise<any> {}\n\n  async removeSession(): Promise<void> {\n    const res = await fetch(await this.buildUrl('/logout'), {\n      method: 'POST',\n      headers: {\n        'x-requested-with': 'XMLHttpRequest',\n      },\n      credentials: 'include',\n    }).catch(error => {\n      throw new Error(`Logout request failed, ${error}`);\n    });\n\n    if (!res.ok) {\n      const error: any = new Error(`Logout request failed, ${res.statusText}`);\n      error.status = res.status;\n      throw error;\n    }\n  }\n\n  private async buildUrl(path: string): Promise<string> {\n    const baseUrl = await this.discoveryApi.getBaseUrl('auth');\n    return `${baseUrl}/${this.provider.id}${path}?env=${this.environment}`;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { SessionScopesFunc } from './types';\n\nexport function hasScopes(\n  searched: Set<string>,\n  searchFor: Set<string>,\n): boolean {\n  for (const scope of searchFor) {\n    if (!searched.has(scope)) {\n      return false;\n    }\n  }\n  return true;\n}\n\ntype ScopeHelperOptions<T> = {\n  sessionScopes: SessionScopesFunc<T> | undefined;\n  defaultScopes?: Set<string>;\n};\n\nexport class SessionScopeHelper<T> {\n  constructor(private readonly options: ScopeHelperOptions<T>) {}\n\n  sessionExistsAndHasScope(\n    session: T | undefined,\n    scopes?: Set<string>,\n  ): boolean {\n    if (!session) {\n      return false;\n    }\n    if (!scopes) {\n      return true;\n    }\n    if (this.options.sessionScopes === undefined) {\n      return true;\n    }\n    const sessionScopes = this.options.sessionScopes(session);\n    return hasScopes(sessionScopes, scopes);\n  }\n\n  getExtendedScope(session: T | undefined, scopes?: Set<string>) {\n    const newScope = new Set(this.options.defaultScopes);\n    if (session && this.options.sessionScopes !== undefined) {\n      const sessionScopes = this.options.sessionScopes(session);\n      for (const scope of sessionScopes) {\n        newScope.add(scope);\n      }\n    }\n    if (scopes) {\n      for (const scope of scopes) {\n        newScope.add(scope);\n      }\n    }\n    return newScope;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Observable } from '@backstage/types';\nimport ObservableImpl from 'zen-observable';\n\n// TODO(Rugvip): These are stopgap and probably incomplete implementations of subjects.\n// If we add a more complete Observables library they should be replaced.\n\n/**\n * A basic implementation of ReactiveX publish subjects.\n *\n * A subject is a convenient way to create an observable when you want\n * to fan out a single value to all subscribers.\n *\n * See http://reactivex.io/documentation/subject.html\n */\nexport class PublishSubject<T>\n  implements Observable<T>, ZenObservable.SubscriptionObserver<T>\n{\n  private isClosed = false;\n  private terminatingError?: Error;\n\n  private readonly observable = new ObservableImpl<T>(subscriber => {\n    if (this.isClosed) {\n      if (this.terminatingError) {\n        subscriber.error(this.terminatingError);\n      } else {\n        subscriber.complete();\n      }\n      return () => {};\n    }\n\n    this.subscribers.add(subscriber);\n    return () => {\n      this.subscribers.delete(subscriber);\n    };\n  });\n\n  private readonly subscribers = new Set<\n    ZenObservable.SubscriptionObserver<T>\n  >();\n\n  [Symbol.observable]() {\n    return this;\n  }\n\n  get closed() {\n    return this.isClosed;\n  }\n\n  next(value: T) {\n    if (this.isClosed) {\n      throw new Error('PublishSubject is closed');\n    }\n    this.subscribers.forEach(subscriber => subscriber.next(value));\n  }\n\n  error(error: Error) {\n    if (this.isClosed) {\n      throw new Error('PublishSubject is closed');\n    }\n    this.isClosed = true;\n    this.terminatingError = error;\n    this.subscribers.forEach(subscriber => subscriber.error(error));\n  }\n\n  complete() {\n    if (this.isClosed) {\n      throw new Error('PublishSubject is closed');\n    }\n    this.isClosed = true;\n    this.subscribers.forEach(subscriber => subscriber.complete());\n  }\n\n  subscribe(observer: ZenObservable.Observer<T>): ZenObservable.Subscription;\n  subscribe(\n    onNext: (value: T) => void,\n    onError?: (error: any) => void,\n    onComplete?: () => void,\n  ): ZenObservable.Subscription;\n  subscribe(\n    onNext: ZenObservable.Observer<T> | ((value: T) => void),\n    onError?: (error: any) => void,\n    onComplete?: () => void,\n  ): ZenObservable.Subscription {\n    const observer =\n      typeof onNext === 'function'\n        ? {\n            next: onNext,\n            error: onError,\n            complete: onComplete,\n          }\n        : onNext;\n\n    return this.observable.subscribe(observer);\n  }\n}\n\n/**\n * A basic implementation of ReactiveX behavior subjects.\n *\n * A subject is a convenient way to create an observable when you want\n * to fan out a single value to all subscribers.\n *\n * The BehaviorSubject will emit the most recently emitted value or error\n * whenever a new observer subscribes to the subject.\n *\n * See http://reactivex.io/documentation/subject.html\n */\n\nexport class BehaviorSubject<T>\n  implements Observable<T>, ZenObservable.SubscriptionObserver<T>\n{\n  private isClosed: boolean;\n  private currentValue: T;\n  private terminatingError: Error | undefined;\n  private readonly observable: Observable<T>;\n\n  constructor(value: T) {\n    this.isClosed = false;\n    this.currentValue = value;\n    this.terminatingError = undefined;\n    this.observable = new ObservableImpl<T>(subscriber => {\n      if (this.isClosed) {\n        if (this.terminatingError) {\n          subscriber.error(this.terminatingError);\n        } else {\n          subscriber.complete();\n        }\n        return () => {};\n      }\n\n      subscriber.next(this.currentValue);\n\n      this.subscribers.add(subscriber);\n      return () => {\n        this.subscribers.delete(subscriber);\n      };\n    });\n  }\n\n  private readonly subscribers = new Set<\n    ZenObservable.SubscriptionObserver<T>\n  >();\n\n  [Symbol.observable]() {\n    return this;\n  }\n\n  get closed() {\n    return this.isClosed;\n  }\n\n  next(value: T) {\n    if (this.isClosed) {\n      throw new Error('BehaviorSubject is closed');\n    }\n    this.currentValue = value;\n    this.subscribers.forEach(subscriber => subscriber.next(value));\n  }\n\n  error(error: Error) {\n    if (this.isClosed) {\n      throw new Error('BehaviorSubject is closed');\n    }\n    this.isClosed = true;\n    this.terminatingError = error;\n    this.subscribers.forEach(subscriber => subscriber.error(error));\n  }\n\n  complete() {\n    if (this.isClosed) {\n      throw new Error('BehaviorSubject is closed');\n    }\n    this.isClosed = true;\n    this.subscribers.forEach(subscriber => subscriber.complete());\n  }\n\n  subscribe(observer: ZenObservable.Observer<T>): ZenObservable.Subscription;\n  subscribe(\n    onNext: (value: T) => void,\n    onError?: (error: any) => void,\n    onComplete?: () => void,\n  ): ZenObservable.Subscription;\n  subscribe(\n    onNext: ZenObservable.Observer<T> | ((value: T) => void),\n    onError?: (error: any) => void,\n    onComplete?: () => void,\n  ): ZenObservable.Subscription {\n    const observer =\n      typeof onNext === 'function'\n        ? {\n            next: onNext,\n            error: onError,\n            complete: onComplete,\n          }\n        : onNext;\n\n    return this.observable.subscribe(observer);\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { BehaviorSubject } from '../subjects';\nimport { SessionState } from '@backstage/core-plugin-api';\nimport { Observable } from '@backstage/types';\n\nexport class SessionStateTracker {\n  private readonly subject = new BehaviorSubject<SessionState>(\n    SessionState.SignedOut,\n  );\n\n  private signedIn: boolean = false;\n\n  setIsSignedIn(isSignedIn: boolean) {\n    if (this.signedIn !== isSignedIn) {\n      this.signedIn = isSignedIn;\n      this.subject.next(\n        this.signedIn ? SessionState.SignedIn : SessionState.SignedOut,\n      );\n    }\n  }\n\n  sessionState$(): Observable<SessionState> {\n    return this.subject;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  SessionManager,\n  SessionScopesFunc,\n  SessionShouldRefreshFunc,\n  GetSessionOptions,\n} from './types';\nimport { AuthConnector } from '../AuthConnector';\nimport { SessionScopeHelper, hasScopes } from './common';\nimport { SessionStateTracker } from './SessionStateTracker';\n\ntype Options<T> = {\n  /** The connector used for acting on the auth session */\n  connector: AuthConnector<T>;\n  /** Used to get the scope of the session */\n  sessionScopes: SessionScopesFunc<T>;\n  /** Used to check if the session needs to be refreshed */\n  sessionShouldRefresh: SessionShouldRefreshFunc<T>;\n  /** The default scopes that should always be present in a session, defaults to none. */\n  defaultScopes?: Set<string>;\n};\n\n/**\n * RefreshingAuthSessionManager manages an underlying session that has\n * and expiration time and needs to be refreshed periodically.\n */\nexport class RefreshingAuthSessionManager<T> implements SessionManager<T> {\n  private readonly connector: AuthConnector<T>;\n  private readonly helper: SessionScopeHelper<T>;\n  private readonly sessionScopesFunc: SessionScopesFunc<T>;\n  private readonly sessionShouldRefreshFunc: SessionShouldRefreshFunc<T>;\n  private readonly stateTracker = new SessionStateTracker();\n\n  private refreshPromise?: Promise<T>;\n  private currentSession: T | undefined;\n\n  constructor(options: Options<T>) {\n    const {\n      connector,\n      defaultScopes = new Set(),\n      sessionScopes,\n      sessionShouldRefresh,\n    } = options;\n\n    this.connector = connector;\n    this.sessionScopesFunc = sessionScopes;\n    this.sessionShouldRefreshFunc = sessionShouldRefresh;\n    this.helper = new SessionScopeHelper({ sessionScopes, defaultScopes });\n  }\n\n  async getSession(options: GetSessionOptions): Promise<T | undefined> {\n    if (\n      this.helper.sessionExistsAndHasScope(this.currentSession, options.scopes)\n    ) {\n      const shouldRefresh = this.sessionShouldRefreshFunc(this.currentSession!);\n      if (!shouldRefresh) {\n        return this.currentSession!;\n      }\n\n      try {\n        const refreshedSession = await this.collapsedSessionRefresh();\n        const currentScopes = this.sessionScopesFunc(this.currentSession!);\n        const refreshedScopes = this.sessionScopesFunc(refreshedSession);\n        if (hasScopes(refreshedScopes, currentScopes)) {\n          this.currentSession = refreshedSession;\n        }\n        return refreshedSession;\n      } catch (error) {\n        if (options.optional) {\n          return undefined;\n        }\n        throw error;\n      }\n    }\n\n    // The user may still have a valid refresh token in their cookies. Attempt to\n    // initiate a fresh session through the backend using that refresh token.\n    //\n    // We skip this check if an instant login popup is requested, as we need to\n    // stay in a synchronous call stack from the user interaction. The downside\n    // is that that the user will sometimes be requested to log in even if they\n    // already had an existing session.\n    if (!this.currentSession && !options.instantPopup) {\n      try {\n        const newSession = await this.collapsedSessionRefresh();\n        this.currentSession = newSession;\n        // The session might not have the scopes requested so go back and check again\n        return this.getSession(options);\n      } catch {\n        // If the refresh attempt fails we assume we don't have a session, so continue to create one.\n      }\n    }\n\n    // If we continue here we will show a popup, so exit if this is an optional session request.\n    if (options.optional) {\n      return undefined;\n    }\n\n    // We can call authRequester multiple times, the returned session will contain all requested scopes.\n    this.currentSession = await this.connector.createSession({\n      ...options,\n      scopes: this.helper.getExtendedScope(this.currentSession, options.scopes),\n    });\n    this.stateTracker.setIsSignedIn(true);\n    return this.currentSession;\n  }\n\n  async removeSession() {\n    this.currentSession = undefined;\n    await this.connector.removeSession();\n    this.stateTracker.setIsSignedIn(false);\n  }\n\n  sessionState$() {\n    return this.stateTracker.sessionState$();\n  }\n\n  private async collapsedSessionRefresh(): Promise<T> {\n    if (this.refreshPromise) {\n      return this.refreshPromise;\n    }\n\n    this.refreshPromise = this.connector.refreshSession();\n\n    try {\n      const session = await this.refreshPromise;\n      this.stateTracker.setIsSignedIn(true);\n      return session;\n    } finally {\n      delete this.refreshPromise;\n    }\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { MutableSessionManager, GetSessionOptions } from './types';\nimport { AuthConnector } from '../AuthConnector';\nimport { SessionScopeHelper } from './common';\nimport { SessionStateTracker } from './SessionStateTracker';\n\ntype Options<T> = {\n  /** The connector used for acting on the auth session */\n  connector: AuthConnector<T>;\n  /** Used to get the scope of the session */\n  sessionScopes?: (session: T) => Set<string>;\n  /** The default scopes that should always be present in a session, defaults to none. */\n  defaultScopes?: Set<string>;\n};\n\n/**\n * StaticAuthSessionManager manages an underlying session that does not expire.\n */\nexport class StaticAuthSessionManager<T> implements MutableSessionManager<T> {\n  private readonly connector: AuthConnector<T>;\n  private readonly helper: SessionScopeHelper<T>;\n  private readonly stateTracker = new SessionStateTracker();\n\n  private currentSession: T | undefined;\n\n  constructor(options: Options<T>) {\n    const { connector, defaultScopes = new Set(), sessionScopes } = options;\n\n    this.connector = connector;\n    this.helper = new SessionScopeHelper({ sessionScopes, defaultScopes });\n  }\n\n  setSession(session: T | undefined): void {\n    this.currentSession = session;\n    this.stateTracker.setIsSignedIn(Boolean(session));\n  }\n\n  async getSession(options: GetSessionOptions): Promise<T | undefined> {\n    if (\n      this.helper.sessionExistsAndHasScope(this.currentSession, options.scopes)\n    ) {\n      return this.currentSession;\n    }\n\n    // If we continue here we will show a popup, so exit if this is an optional session request.\n    if (options.optional) {\n      return undefined;\n    }\n\n    // We can call authRequester multiple times, the returned session will contain all requested scopes.\n    this.currentSession = await this.connector.createSession({\n      ...options,\n      scopes: this.helper.getExtendedScope(this.currentSession, options.scopes),\n    });\n    this.stateTracker.setIsSignedIn(true);\n    return this.currentSession;\n  }\n\n  /**\n   * We don't call this.connector.removeSession here, since this session manager\n   * is intended to be static. As such there's no need to hit the remote logout\n   * endpoint - simply discarding the local session state when signing out is\n   * enough.\n   */\n  async removeSession() {\n    this.currentSession = undefined;\n    this.stateTracker.setIsSignedIn(false);\n  }\n\n  sessionState$() {\n    return this.stateTracker.sessionState$();\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ZodSchema } from 'zod';\nimport {\n  MutableSessionManager,\n  SessionScopesFunc,\n  SessionShouldRefreshFunc,\n  GetSessionOptions,\n} from './types';\nimport { SessionScopeHelper } from './common';\n\ntype Options<T> = {\n  /** The connector used for acting on the auth session */\n  manager: MutableSessionManager<T>;\n  /** Storage key to use to store sessions */\n  storageKey: string;\n  /** The schema used to validate the stored data */\n  schema: ZodSchema<T>;\n  /** Used to get the scope of the session */\n  sessionScopes?: SessionScopesFunc<T>;\n  /** Used to check if the session needs to be refreshed, defaults to never refresh */\n  sessionShouldRefresh?: SessionShouldRefreshFunc<T>;\n};\n\n/**\n * AuthSessionStore decorates another SessionManager with a functionality\n * to store the session in local storage.\n *\n * Session is serialized to JSON with special support for following types: Set.\n */\nexport class AuthSessionStore<T> implements MutableSessionManager<T> {\n  private readonly manager: MutableSessionManager<T>;\n  private readonly storageKey: string;\n  private readonly schema: ZodSchema<T>;\n  private readonly sessionShouldRefreshFunc: SessionShouldRefreshFunc<T>;\n  private readonly helper: SessionScopeHelper<T>;\n\n  constructor(options: Options<T>) {\n    const {\n      manager,\n      storageKey,\n      schema,\n      sessionScopes,\n      sessionShouldRefresh = () => false,\n    } = options;\n\n    this.manager = manager;\n    this.storageKey = storageKey;\n    this.schema = schema;\n    this.sessionShouldRefreshFunc = sessionShouldRefresh;\n    this.helper = new SessionScopeHelper({\n      sessionScopes,\n      defaultScopes: new Set(),\n    });\n  }\n\n  setSession(session: T | undefined): void {\n    this.manager.setSession(session);\n    this.saveSession(session);\n  }\n\n  async getSession(options: GetSessionOptions): Promise<T | undefined> {\n    const { scopes } = options;\n    const session = this.loadSession();\n\n    if (this.helper.sessionExistsAndHasScope(session, scopes)) {\n      const shouldRefresh = this.sessionShouldRefreshFunc(session!);\n\n      if (!shouldRefresh) {\n        this.manager.setSession(session!);\n        return session!;\n      }\n    }\n\n    const newSession = await this.manager.getSession(options);\n    this.saveSession(newSession);\n    return newSession;\n  }\n\n  async removeSession() {\n    localStorage.removeItem(this.storageKey);\n    await this.manager.removeSession();\n  }\n\n  sessionState$() {\n    return this.manager.sessionState$();\n  }\n\n  private loadSession(): T | undefined {\n    try {\n      const sessionJson = localStorage.getItem(this.storageKey);\n      if (sessionJson) {\n        const session = JSON.parse(sessionJson, (_key, value) => {\n          if (value?.__type === 'Set') {\n            return new Set(value.__value);\n          }\n          return value;\n        });\n\n        try {\n          return this.schema.parse(session);\n        } catch (e) {\n          // eslint-disable-next-line no-console\n          console.log(\n            `Failed to load session from local storage because it did not conform to the expected schema, ${e}`,\n          );\n          throw e;\n        }\n      }\n\n      return undefined;\n    } catch (error) {\n      localStorage.removeItem(this.storageKey);\n      return undefined;\n    }\n  }\n\n  private saveSession(session: T | undefined) {\n    if (session === undefined) {\n      localStorage.removeItem(this.storageKey);\n      return;\n    }\n\n    try {\n      this.schema.parse(session);\n    } catch (e) {\n      // eslint-disable-next-line no-console\n      console.warn(\n        `Failed to save session to local storage because it did not conform to the expected schema, ${e}`,\n      );\n      return;\n    }\n\n    localStorage.setItem(\n      this.storageKey,\n      JSON.stringify(session, (_key, value) => {\n        if (value instanceof Set) {\n          return {\n            __type: 'Set',\n            __value: Array.from(value),\n          };\n        }\n        return value;\n      }),\n    );\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DefaultAuthConnector } from '../../../../lib/AuthConnector';\nimport { RefreshingAuthSessionManager } from '../../../../lib/AuthSessionManager';\nimport { SessionManager } from '../../../../lib/AuthSessionManager/types';\nimport {\n  AuthRequestOptions,\n  BackstageIdentityResponse,\n  OAuthApi,\n  OpenIdConnectApi,\n  ProfileInfo,\n  ProfileInfoApi,\n  SessionState,\n  SessionApi,\n  BackstageIdentityApi,\n} from '@backstage/core-plugin-api';\nimport { Observable } from '@backstage/types';\nimport { OAuth2Session } from './types';\nimport { OAuthApiCreateOptions } from '../types';\n\n/**\n * OAuth2 create options.\n * @public\n */\nexport type OAuth2CreateOptions = OAuthApiCreateOptions & {\n  scopeTransform?: (scopes: string[]) => string[];\n};\n\nexport type OAuth2Response = {\n  providerInfo: {\n    accessToken: string;\n    idToken: string;\n    scope: string;\n    expiresInSeconds: number;\n  };\n  profile: ProfileInfo;\n  backstageIdentity: BackstageIdentityResponse;\n};\n\nconst DEFAULT_PROVIDER = {\n  id: 'oauth2',\n  title: 'Your Identity Provider',\n  icon: () => null,\n};\n\n/**\n * Implements a generic OAuth2 flow for auth.\n *\n * @public\n */\nexport default class OAuth2\n  implements\n    OAuthApi,\n    OpenIdConnectApi,\n    ProfileInfoApi,\n    BackstageIdentityApi,\n    SessionApi\n{\n  static create(options: OAuth2CreateOptions) {\n    const {\n      discoveryApi,\n      environment = 'development',\n      provider = DEFAULT_PROVIDER,\n      oauthRequestApi,\n      defaultScopes = [],\n      scopeTransform = x => x,\n    } = options;\n\n    const connector = new DefaultAuthConnector({\n      discoveryApi,\n      environment,\n      provider,\n      oauthRequestApi: oauthRequestApi,\n      sessionTransform(res: OAuth2Response): OAuth2Session {\n        return {\n          ...res,\n          providerInfo: {\n            idToken: res.providerInfo.idToken,\n            accessToken: res.providerInfo.accessToken,\n            scopes: OAuth2.normalizeScopes(\n              scopeTransform,\n              res.providerInfo.scope,\n            ),\n            expiresAt: new Date(\n              Date.now() + res.providerInfo.expiresInSeconds * 1000,\n            ),\n          },\n        };\n      },\n    });\n\n    const sessionManager = new RefreshingAuthSessionManager({\n      connector,\n      defaultScopes: new Set(defaultScopes),\n      sessionScopes: (session: OAuth2Session) => session.providerInfo.scopes,\n      sessionShouldRefresh: (session: OAuth2Session) => {\n        const expiresInSec =\n          (session.providerInfo.expiresAt.getTime() - Date.now()) / 1000;\n        return expiresInSec < 60 * 5;\n      },\n    });\n\n    return new OAuth2({ sessionManager, scopeTransform });\n  }\n\n  private readonly sessionManager: SessionManager<OAuth2Session>;\n  private readonly scopeTransform: (scopes: string[]) => string[];\n\n  private constructor(options: {\n    sessionManager: SessionManager<OAuth2Session>;\n    scopeTransform: (scopes: string[]) => string[];\n  }) {\n    this.sessionManager = options.sessionManager;\n    this.scopeTransform = options.scopeTransform;\n  }\n\n  async signIn() {\n    await this.getAccessToken();\n  }\n\n  async signOut() {\n    await this.sessionManager.removeSession();\n  }\n\n  sessionState$(): Observable<SessionState> {\n    return this.sessionManager.sessionState$();\n  }\n\n  async getAccessToken(\n    scope?: string | string[],\n    options?: AuthRequestOptions,\n  ) {\n    const normalizedScopes = OAuth2.normalizeScopes(this.scopeTransform, scope);\n    const session = await this.sessionManager.getSession({\n      ...options,\n      scopes: normalizedScopes,\n    });\n    return session?.providerInfo.accessToken ?? '';\n  }\n\n  async getIdToken(options: AuthRequestOptions = {}) {\n    const session = await this.sessionManager.getSession(options);\n    return session?.providerInfo.idToken ?? '';\n  }\n\n  async getBackstageIdentity(\n    options: AuthRequestOptions = {},\n  ): Promise<BackstageIdentityResponse | undefined> {\n    const session = await this.sessionManager.getSession(options);\n    return session?.backstageIdentity;\n  }\n\n  async getProfile(options: AuthRequestOptions = {}) {\n    const session = await this.sessionManager.getSession(options);\n    return session?.profile;\n  }\n\n  private static normalizeScopes(\n    scopeTransform: (scopes: string[]) => string[],\n    scopes?: string | string[],\n  ): Set<string> {\n    if (!scopes) {\n      return new Set();\n    }\n\n    const scopeList = Array.isArray(scopes)\n      ? scopes\n      : scopes.split(/[\\s|,]/).filter(Boolean);\n\n    return new Set(scopeTransform(scopeList));\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { githubAuthApiRef } from '@backstage/core-plugin-api';\nimport { OAuth2 } from '../oauth2';\nimport { OAuthApiCreateOptions } from '../types';\n\nconst DEFAULT_PROVIDER = {\n  id: 'github',\n  title: 'GitHub',\n  icon: () => null,\n};\n\n/**\n * Implements the OAuth flow to GitHub products.\n *\n * @public\n */\nexport default class GithubAuth {\n  static create(options: OAuthApiCreateOptions): typeof githubAuthApiRef.T {\n    const {\n      discoveryApi,\n      environment = 'development',\n      provider = DEFAULT_PROVIDER,\n      oauthRequestApi,\n      defaultScopes = ['read:user'],\n    } = options;\n\n    return OAuth2.create({\n      discoveryApi,\n      oauthRequestApi,\n      provider,\n      environment,\n      defaultScopes,\n    });\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { gitlabAuthApiRef } from '@backstage/core-plugin-api';\nimport { OAuth2 } from '../oauth2';\nimport { OAuthApiCreateOptions } from '../types';\n\nconst DEFAULT_PROVIDER = {\n  id: 'gitlab',\n  title: 'GitLab',\n  icon: () => null,\n};\n\n/**\n * Implements the OAuth flow to GitLab products.\n *\n * @public\n */\nexport default class GitlabAuth {\n  static create(options: OAuthApiCreateOptions): typeof gitlabAuthApiRef.T {\n    const {\n      discoveryApi,\n      environment = 'development',\n      provider = DEFAULT_PROVIDER,\n      oauthRequestApi,\n      defaultScopes = ['read_user'],\n    } = options;\n\n    return OAuth2.create({\n      discoveryApi,\n      oauthRequestApi,\n      provider,\n      environment,\n      defaultScopes,\n    });\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { googleAuthApiRef } from '@backstage/core-plugin-api';\nimport { OAuth2 } from '../oauth2';\nimport { OAuthApiCreateOptions } from '../types';\n\nconst DEFAULT_PROVIDER = {\n  id: 'google',\n  title: 'Google',\n  icon: () => null,\n};\n\nconst SCOPE_PREFIX = 'https://www.googleapis.com/auth/';\n\n/**\n * Implements the OAuth flow to Google products.\n *\n * @public\n */\nexport default class GoogleAuth {\n  static create(options: OAuthApiCreateOptions): typeof googleAuthApiRef.T {\n    const {\n      discoveryApi,\n      oauthRequestApi,\n      environment = 'development',\n      provider = DEFAULT_PROVIDER,\n      defaultScopes = [\n        'openid',\n        `${SCOPE_PREFIX}userinfo.email`,\n        `${SCOPE_PREFIX}userinfo.profile`,\n      ],\n    } = options;\n\n    return OAuth2.create({\n      discoveryApi,\n      oauthRequestApi,\n      provider,\n      environment,\n      defaultScopes,\n      scopeTransform(scopes: string[]) {\n        return scopes.map(scope => {\n          if (scope === 'openid') {\n            return scope;\n          }\n\n          if (scope === 'profile' || scope === 'email') {\n            return `${SCOPE_PREFIX}userinfo.${scope}`;\n          }\n\n          if (scope.startsWith(SCOPE_PREFIX)) {\n            return scope;\n          }\n\n          return `${SCOPE_PREFIX}${scope}`;\n        });\n      },\n    });\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { oktaAuthApiRef } from '@backstage/core-plugin-api';\nimport { OAuth2 } from '../oauth2';\nimport { OAuthApiCreateOptions } from '../types';\n\nconst DEFAULT_PROVIDER = {\n  id: 'okta',\n  title: 'Okta',\n  icon: () => null,\n};\n\nconst OKTA_OIDC_SCOPES: Set<String> = new Set([\n  'openid',\n  'profile',\n  'email',\n  'phone',\n  'address',\n  'groups',\n  'offline_access',\n]);\n\nconst OKTA_SCOPE_PREFIX: string = 'okta.';\n\n/**\n * Implements the OAuth flow to Okta products.\n *\n * @public\n */\nexport default class OktaAuth {\n  static create(options: OAuthApiCreateOptions): typeof oktaAuthApiRef.T {\n    const {\n      discoveryApi,\n      environment = 'development',\n      provider = DEFAULT_PROVIDER,\n      oauthRequestApi,\n      defaultScopes = ['openid', 'email', 'profile', 'offline_access'],\n    } = options;\n\n    return OAuth2.create({\n      discoveryApi,\n      oauthRequestApi,\n      provider,\n      environment,\n      defaultScopes,\n      scopeTransform(scopes) {\n        return scopes.map(scope => {\n          if (OKTA_OIDC_SCOPES.has(scope)) {\n            return scope;\n          }\n\n          if (scope.startsWith(OKTA_SCOPE_PREFIX)) {\n            return scope;\n          }\n\n          return `${OKTA_SCOPE_PREFIX}${scope}`;\n        });\n      },\n    });\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  BackstageIdentityResponse,\n  ProfileInfo,\n} from '@backstage/core-plugin-api';\nimport { z } from 'zod';\n\n/** @internal */\nexport type SamlSession = {\n  profile: ProfileInfo;\n  backstageIdentity: BackstageIdentityResponse;\n};\n\n/** @internal */\nexport const samlSessionSchema: z.ZodSchema<SamlSession> = z.object({\n  profile: z.object({\n    email: z.string().optional(),\n    displayName: z.string().optional(),\n    picture: z.string().optional(),\n  }),\n  backstageIdentity: z.object({\n    token: z.string(),\n    identity: z.object({\n      type: z.literal('user'),\n      userEntityRef: z.string(),\n      ownershipEntityRefs: z.array(z.string()),\n    }),\n  }),\n});\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  AuthRequestOptions,\n  BackstageIdentityApi,\n  ProfileInfo,\n  ProfileInfoApi,\n  SessionApi,\n  SessionState,\n  BackstageIdentityResponse,\n} from '@backstage/core-plugin-api';\nimport { Observable } from '@backstage/types';\nimport { DirectAuthConnector } from '../../../../lib/AuthConnector';\nimport {\n  AuthSessionStore,\n  StaticAuthSessionManager,\n} from '../../../../lib/AuthSessionManager';\nimport { SessionManager } from '../../../../lib/AuthSessionManager/types';\nimport { AuthApiCreateOptions } from '../types';\nimport { SamlSession, samlSessionSchema } from './types';\n\nexport type SamlAuthResponse = {\n  profile: ProfileInfo;\n  backstageIdentity: BackstageIdentityResponse;\n};\n\nconst DEFAULT_PROVIDER = {\n  id: 'saml',\n  title: 'SAML',\n  icon: () => null,\n};\n\n/**\n * Implements a general SAML based auth flow.\n *\n * @public\n */\nexport default class SamlAuth\n  implements ProfileInfoApi, BackstageIdentityApi, SessionApi\n{\n  static create(options: AuthApiCreateOptions) {\n    const {\n      discoveryApi,\n      environment = 'development',\n      provider = DEFAULT_PROVIDER,\n    } = options;\n\n    const connector = new DirectAuthConnector<SamlSession>({\n      discoveryApi,\n      environment,\n      provider,\n    });\n\n    const sessionManager = new StaticAuthSessionManager<SamlSession>({\n      connector,\n    });\n\n    const authSessionStore = new AuthSessionStore<SamlSession>({\n      manager: sessionManager,\n      storageKey: `${provider.id}Session`,\n      schema: samlSessionSchema,\n    });\n\n    return new SamlAuth(authSessionStore);\n  }\n\n  sessionState$(): Observable<SessionState> {\n    return this.sessionManager.sessionState$();\n  }\n\n  private constructor(\n    private readonly sessionManager: SessionManager<SamlSession>,\n  ) {}\n\n  async signIn() {\n    await this.getBackstageIdentity({});\n  }\n  async signOut() {\n    await this.sessionManager.removeSession();\n  }\n\n  async getBackstageIdentity(\n    options: AuthRequestOptions = {},\n  ): Promise<BackstageIdentityResponse | undefined> {\n    const session = await this.sessionManager.getSession(options);\n    return session?.backstageIdentity;\n  }\n\n  async getProfile(options: AuthRequestOptions = {}) {\n    const session = await this.sessionManager.getSession(options);\n    return session?.profile;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { microsoftAuthApiRef } from '@backstage/core-plugin-api';\nimport { OAuth2 } from '../oauth2';\nimport { OAuthApiCreateOptions } from '../types';\n\nconst DEFAULT_PROVIDER = {\n  id: 'microsoft',\n  title: 'Microsoft',\n  icon: () => null,\n};\n\n/**\n * Implements the OAuth flow to Microsoft products.\n *\n * @public\n */\nexport default class MicrosoftAuth {\n  static create(options: OAuthApiCreateOptions): typeof microsoftAuthApiRef.T {\n    const {\n      environment = 'development',\n      provider = DEFAULT_PROVIDER,\n      oauthRequestApi,\n      discoveryApi,\n      defaultScopes = [\n        'openid',\n        'offline_access',\n        'profile',\n        'email',\n        'User.Read',\n      ],\n    } = options;\n\n    return OAuth2.create({\n      discoveryApi,\n      oauthRequestApi,\n      provider,\n      environment,\n      defaultScopes,\n    });\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  oneloginAuthApiRef,\n  OAuthRequestApi,\n  AuthProviderInfo,\n  DiscoveryApi,\n} from '@backstage/core-plugin-api';\nimport { OAuth2 } from '../oauth2';\n\n/**\n * OneLogin auth provider create options.\n * @public\n */\nexport type OneLoginAuthCreateOptions = {\n  discoveryApi: DiscoveryApi;\n  oauthRequestApi: OAuthRequestApi;\n  environment?: string;\n  provider?: AuthProviderInfo;\n};\n\nconst DEFAULT_PROVIDER = {\n  id: 'onelogin',\n  title: 'onelogin',\n  icon: () => null,\n};\n\nconst OIDC_SCOPES: Set<String> = new Set([\n  'openid',\n  'profile',\n  'email',\n  'phone',\n  'address',\n  'groups',\n  'offline_access',\n]);\n\nconst SCOPE_PREFIX: string = 'onelogin.';\n\n/**\n * Implements a OneLogin OAuth flow.\n *\n * @public\n */\nexport default class OneLoginAuth {\n  static create(\n    options: OneLoginAuthCreateOptions,\n  ): typeof oneloginAuthApiRef.T {\n    const {\n      discoveryApi,\n      environment = 'development',\n      provider = DEFAULT_PROVIDER,\n      oauthRequestApi,\n    } = options;\n\n    return OAuth2.create({\n      discoveryApi,\n      oauthRequestApi,\n      provider,\n      environment,\n      defaultScopes: ['openid', 'email', 'profile', 'offline_access'],\n      scopeTransform(scopes) {\n        return scopes.map(scope => {\n          if (OIDC_SCOPES.has(scope)) {\n            return scope;\n          }\n\n          if (scope.startsWith(SCOPE_PREFIX)) {\n            return scope;\n          }\n\n          return `${SCOPE_PREFIX}${scope}`;\n        });\n      },\n    });\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  BackstageIdentityResponse,\n  bitbucketAuthApiRef,\n  ProfileInfo,\n} from '@backstage/core-plugin-api';\n\nimport { OAuthApiCreateOptions } from '../types';\nimport { OAuth2 } from '../oauth2';\n\nexport type BitbucketAuthResponse = {\n  providerInfo: {\n    accessToken: string;\n    scope: string;\n    expiresInSeconds: number;\n  };\n  profile: ProfileInfo;\n  backstageIdentity: BackstageIdentityResponse;\n};\n\nconst DEFAULT_PROVIDER = {\n  id: 'bitbucket',\n  title: 'Bitbucket',\n  icon: () => null,\n};\n\n/**\n * Implements the OAuth flow to Bitbucket products.\n *\n * @public\n */\nexport default class BitbucketAuth {\n  static create(options: OAuthApiCreateOptions): typeof bitbucketAuthApiRef.T {\n    const {\n      discoveryApi,\n      environment = 'development',\n      provider = DEFAULT_PROVIDER,\n      oauthRequestApi,\n      defaultScopes = ['team'],\n    } = options;\n\n    return OAuth2.create({\n      discoveryApi,\n      oauthRequestApi,\n      provider,\n      environment,\n      defaultScopes,\n    });\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { atlassianAuthApiRef } from '@backstage/core-plugin-api';\nimport { OAuth2 } from '../oauth2';\nimport { OAuthApiCreateOptions } from '../types';\n\nconst DEFAULT_PROVIDER = {\n  id: 'atlassian',\n  title: 'Atlassian',\n  icon: () => null,\n};\n\n/**\n * Implements the OAuth flow to Atlassian products.\n *\n * @public\n */\nexport default class AtlassianAuth {\n  static create(options: OAuthApiCreateOptions): typeof atlassianAuthApiRef.T {\n    const {\n      discoveryApi,\n      environment = 'development',\n      provider = DEFAULT_PROVIDER,\n      oauthRequestApi,\n    } = options;\n\n    return OAuth2.create({\n      discoveryApi,\n      oauthRequestApi,\n      provider,\n      environment,\n    });\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AlertApi, AlertMessage } from '@backstage/core-plugin-api';\nimport { Observable } from '@backstage/types';\nimport { PublishSubject } from '../../../lib/subjects';\n\n/**\n * Base implementation for the AlertApi that simply forwards alerts to consumers.\n *\n * @public\n */\nexport class AlertApiForwarder implements AlertApi {\n  private readonly subject = new PublishSubject<AlertMessage>();\n\n  post(alert: AlertMessage) {\n    this.subject.next(alert);\n  }\n\n  alert$(): Observable<AlertMessage> {\n    return this.subject;\n  }\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { AnalyticsApi, AnalyticsEvent } from '@backstage/core-plugin-api';\n\n/**\n * Base implementation for the AnalyticsApi that does nothing.\n *\n * @public\n */\nexport class NoOpAnalyticsApi implements AnalyticsApi {\n  captureEvent(_event: AnalyticsEvent): void {}\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AppThemeApi, AppTheme } from '@backstage/core-plugin-api';\nimport { Observable } from '@backstage/types';\nimport { BehaviorSubject } from '../../../lib/subjects';\n\nconst STORAGE_KEY = 'theme';\n\n/**\n * Exposes the themes installed in the app, and permits switching the currently\n * active theme.\n *\n * @public\n */\nexport class AppThemeSelector implements AppThemeApi {\n  static createWithStorage(themes: AppTheme[]) {\n    const selector = new AppThemeSelector(themes);\n\n    if (!window.localStorage) {\n      return selector;\n    }\n\n    const initialThemeId =\n      window.localStorage.getItem(STORAGE_KEY) ?? undefined;\n\n    selector.setActiveThemeId(initialThemeId);\n\n    selector.activeThemeId$().subscribe(themeId => {\n      if (themeId) {\n        window.localStorage.setItem(STORAGE_KEY, themeId);\n      } else {\n        window.localStorage.removeItem(STORAGE_KEY);\n      }\n    });\n\n    window.addEventListener('storage', event => {\n      if (event.key === STORAGE_KEY) {\n        const themeId = localStorage.getItem(STORAGE_KEY) ?? undefined;\n        selector.setActiveThemeId(themeId);\n      }\n    });\n\n    return selector;\n  }\n\n  private activeThemeId: string | undefined;\n  private readonly subject = new BehaviorSubject<string | undefined>(undefined);\n\n  constructor(private readonly themes: AppTheme[]) {}\n\n  getInstalledThemes(): AppTheme[] {\n    return this.themes.slice();\n  }\n\n  activeThemeId$(): Observable<string | undefined> {\n    return this.subject;\n  }\n\n  getActiveThemeId(): string | undefined {\n    return this.activeThemeId;\n  }\n\n  setActiveThemeId(themeId?: string): void {\n    this.activeThemeId = themeId;\n    this.subject.next(themeId);\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DiscoveryApi } from '@backstage/core-plugin-api';\n\nconst ERROR_PREFIX = 'Invalid discovery URL pattern,';\n\n/**\n * UrlPatternDiscovery is a lightweight DiscoveryApi implementation.\n * It uses a single template string to construct URLs for each plugin.\n *\n * @public\n */\nexport class UrlPatternDiscovery implements DiscoveryApi {\n  /**\n   * Creates a new UrlPatternDiscovery given a template. The the only\n   * interpolation done for the template is to replace instances of `{{pluginId}}`\n   * with the ID of the plugin being requested.\n   *\n   * Example pattern: `http://localhost:7007/api/{{ pluginId }}`\n   */\n  static compile(pattern: string): UrlPatternDiscovery {\n    const parts = pattern.split(/\\{\\{\\s*pluginId\\s*\\}\\}/);\n    const urlStr = parts.join('pluginId');\n\n    let url;\n    try {\n      url = new URL(urlStr);\n    } catch {\n      throw new Error(`${ERROR_PREFIX} URL '${urlStr}' is invalid`);\n    }\n    if (url.hash) {\n      throw new Error(`${ERROR_PREFIX} URL must not have a hash`);\n    }\n    if (url.search) {\n      throw new Error(`${ERROR_PREFIX} URL must not have a query`);\n    }\n    if (urlStr.endsWith('/')) {\n      throw new Error(`${ERROR_PREFIX} URL must not end with a slash`);\n    }\n\n    return new UrlPatternDiscovery(parts);\n  }\n\n  private constructor(private readonly parts: string[]) {}\n\n  async getBaseUrl(pluginId: string): Promise<string> {\n    return this.parts.join(pluginId);\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {\n  ErrorApi,\n  ErrorApiError,\n  ErrorApiErrorContext,\n  AlertApi,\n} from '@backstage/core-plugin-api';\n\n/**\n * Decorates an ErrorApi by also forwarding error messages\n * to the alertApi with an 'error' severity.\n *\n * @public\n */\nexport class ErrorAlerter implements ErrorApi {\n  constructor(\n    private readonly alertApi: AlertApi,\n    private readonly errorApi: ErrorApi,\n  ) {}\n\n  post(error: ErrorApiError, context?: ErrorApiErrorContext) {\n    if (!context?.hidden) {\n      this.alertApi.post({ message: error.message, severity: 'error' });\n    }\n\n    return this.errorApi.post(error, context);\n  }\n\n  error$() {\n    return this.errorApi.error$();\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  ErrorApi,\n  ErrorApiError,\n  ErrorApiErrorContext,\n} from '@backstage/core-plugin-api';\nimport { Observable } from '@backstage/types';\nimport { PublishSubject } from '../../../lib/subjects';\n\n/**\n * Base implementation for the ErrorApi that simply forwards errors to consumers.\n *\n * @public\n */\nexport class ErrorApiForwarder implements ErrorApi {\n  private readonly subject = new PublishSubject<{\n    error: Error;\n    context?: ErrorApiErrorContext;\n  }>();\n\n  post(error: ErrorApiError, context?: ErrorApiErrorContext) {\n    this.subject.next({ error, context });\n  }\n\n  error$(): Observable<{ error: Error; context?: ErrorApiErrorContext }> {\n    return this.subject;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  ErrorApi,\n  ErrorApiError,\n  ErrorApiErrorContext,\n} from '@backstage/core-plugin-api';\n\n/**\n * Utility class that helps with error forwarding.\n *\n * @public\n */\nexport class UnhandledErrorForwarder {\n  /**\n   * Add event listener, such that unhandled errors can be forwarded using an given `ErrorApi` instance\n   */\n  static forward(errorApi: ErrorApi, errorContext: ErrorApiErrorContext) {\n    window.addEventListener(\n      'unhandledrejection',\n      (e: PromiseRejectionEvent) => {\n        errorApi.post(e.reason as ErrorApiError, errorContext);\n      },\n    );\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  FeatureFlagState,\n  FeatureFlagsApi,\n  FeatureFlag,\n  FeatureFlagsSaveOptions,\n} from '@backstage/core-plugin-api';\n\nexport function validateFlagName(name: string): void {\n  if (name.length < 3) {\n    throw new Error(\n      `The '${name}' feature flag must have a minimum length of three characters.`,\n    );\n  }\n\n  if (name.length > 150) {\n    throw new Error(\n      `The '${name}' feature flag must not exceed 150 characters.`,\n    );\n  }\n\n  if (!name.match(/^[a-z]+[a-z0-9-]+$/)) {\n    throw new Error(\n      `The '${name}' feature flag must start with a lowercase letter and only contain lowercase letters, numbers and hyphens. ` +\n        'Examples: feature-flag-one, alpha, release-2020',\n    );\n  }\n}\n\n/**\n * A feature flags implementation that stores the flags in the browser's local\n * storage.\n *\n * @public\n */\nexport class LocalStorageFeatureFlags implements FeatureFlagsApi {\n  private registeredFeatureFlags: FeatureFlag[] = [];\n  private flags?: Map<string, FeatureFlagState>;\n\n  registerFlag(flag: FeatureFlag) {\n    validateFlagName(flag.name);\n    this.registeredFeatureFlags.push(flag);\n  }\n\n  getRegisteredFlags(): FeatureFlag[] {\n    return this.registeredFeatureFlags.slice();\n  }\n\n  isActive(name: string): boolean {\n    if (!this.flags) {\n      this.flags = this.load();\n    }\n    return this.flags.get(name) === FeatureFlagState.Active;\n  }\n\n  save(options: FeatureFlagsSaveOptions): void {\n    if (!this.flags) {\n      this.flags = this.load();\n    }\n    if (!options.merge) {\n      this.flags.clear();\n    }\n    for (const [name, state] of Object.entries(options.states)) {\n      this.flags.set(name, state);\n    }\n\n    const enabled = Array.from(this.flags.entries()).filter(\n      ([, state]) => state === FeatureFlagState.Active,\n    );\n    window.localStorage.setItem(\n      'featureFlags',\n      JSON.stringify(Object.fromEntries(enabled)),\n    );\n  }\n\n  private load(): Map<string, FeatureFlagState> {\n    try {\n      const jsonStr = window.localStorage.getItem('featureFlags');\n      if (!jsonStr) {\n        return new Map();\n      }\n      const json = JSON.parse(jsonStr) as unknown;\n      if (typeof json !== 'object' || json === null || Array.isArray(json)) {\n        return new Map();\n      }\n\n      const entries = Object.entries(json).filter(([name, value]) => {\n        validateFlagName(name);\n        return value === FeatureFlagState.Active;\n      });\n\n      return new Map(entries);\n    } catch {\n      return new Map();\n    }\n  }\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { FetchApi } from '@backstage/core-plugin-api';\nimport { FetchMiddleware } from './types';\n\n/**\n * Builds a fetch API, based on the builtin fetch wrapped by a set of optional\n * middleware implementations that add behaviors.\n *\n * @remarks\n *\n * The middleware are applied in reverse order, i.e. the last one will be\n * \"closest\" to the base implementation. Passing in `[M1, M2, M3]` effectively\n * leads to `M1(M2(M3(baseImplementation)))`.\n *\n * @public\n */\nexport function createFetchApi(options: {\n  baseImplementation?: typeof fetch | undefined;\n  middleware?: FetchMiddleware | FetchMiddleware[] | undefined;\n}): FetchApi {\n  let result = options.baseImplementation || global.fetch;\n\n  const middleware = [options.middleware ?? []].flat().reverse();\n  for (const m of middleware) {\n    result = m.apply(result);\n  }\n\n  return {\n    fetch: result,\n  };\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Config } from '@backstage/config';\nimport { IdentityApi } from '@backstage/core-plugin-api';\nimport { FetchMiddleware } from './types';\n\n/**\n * A fetch middleware, which injects a Backstage token header when the user is\n * signed in.\n */\nexport class IdentityAuthInjectorFetchMiddleware implements FetchMiddleware {\n  static create(options: {\n    identityApi: IdentityApi;\n    config?: Config;\n    urlPrefixAllowlist?: string[];\n    allowUrl?: (url: string) => boolean;\n    header?: {\n      name: string;\n      value: (backstageToken: string) => string;\n    };\n  }): IdentityAuthInjectorFetchMiddleware {\n    const matcher = buildMatcher(options);\n    const headerName = options.header?.name || 'authorization';\n    const headerValue = options.header?.value || (token => `Bearer ${token}`);\n\n    return new IdentityAuthInjectorFetchMiddleware(\n      options.identityApi,\n      matcher,\n      headerName,\n      headerValue,\n    );\n  }\n\n  constructor(\n    public readonly identityApi: IdentityApi,\n    public readonly allowUrl: (url: string) => boolean,\n    public readonly headerName: string,\n    public readonly headerValue: (pluginId: string) => string,\n  ) {}\n\n  apply(next: typeof fetch): typeof fetch {\n    return async (input, init) => {\n      // Skip this middleware if the header already exists, or if the URL\n      // doesn't match any of the allowlist items, or if there was no token\n      const request = new Request(input, init);\n      const { token } = await this.identityApi.getCredentials();\n      if (\n        request.headers.get(this.headerName) ||\n        typeof token !== 'string' ||\n        !token ||\n        !this.allowUrl(request.url)\n      ) {\n        return next(input, init);\n      }\n\n      request.headers.set(this.headerName, this.headerValue(token));\n      return next(request);\n    };\n  }\n}\n\nfunction buildMatcher(options: {\n  config?: Config;\n  urlPrefixAllowlist?: string[];\n  allowUrl?: (url: string) => boolean;\n}): (url: string) => boolean {\n  if (options.allowUrl) {\n    return options.allowUrl;\n  } else if (options.urlPrefixAllowlist) {\n    return buildPrefixMatcher(options.urlPrefixAllowlist);\n  } else if (options.config) {\n    return buildPrefixMatcher([options.config.getString('backend.baseUrl')]);\n  }\n  return () => false;\n}\n\nfunction buildPrefixMatcher(prefixes: string[]): (url: string) => boolean {\n  const trimmedPrefixes = prefixes.map(prefix => prefix.replace(/\\/$/, ''));\n  return url =>\n    trimmedPrefixes.some(\n      prefix => url === prefix || url.startsWith(`${prefix}/`),\n    );\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DiscoveryApi } from '@backstage/core-plugin-api';\nimport { FetchMiddleware } from './types';\n\nfunction join(left: string, right: string): string {\n  if (!right || right === '/') {\n    return left;\n  }\n\n  return `${left.replace(/\\/$/, '')}/${right.replace(/^\\//, '')}`;\n}\n\n/**\n * Handles translation from plugin://some-plugin-id/<path> to concrete http(s)\n * URLs.\n */\nexport class PluginProtocolResolverFetchMiddleware implements FetchMiddleware {\n  constructor(private readonly discoveryApi: DiscoveryApi) {}\n\n  apply(next: typeof fetch): typeof fetch {\n    return async (input, init) => {\n      const request = new Request(input, init);\n      const prefix = 'plugin://';\n\n      if (!request.url.startsWith(prefix)) {\n        return next(input, init);\n      }\n\n      // Switch to a known protocol, since browser URL parsing misbehaves wildly\n      // on foreign protocols\n      const { hostname, pathname, search, hash, username, password } = new URL(\n        `http://${request.url.substring(prefix.length)}`,\n      );\n\n      let base = await this.discoveryApi.getBaseUrl(hostname);\n      if (username || password) {\n        const baseUrl = new URL(base);\n        const authority = `${username}${password ? `:${password}` : ''}@`;\n        base = `${baseUrl.protocol}//${authority}${baseUrl.host}${baseUrl.pathname}`;\n      }\n\n      const target = `${join(base, pathname)}${search}${hash}`;\n      return next(target, typeof input === 'string' ? init : input);\n    };\n  }\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Config } from '@backstage/config';\nimport { DiscoveryApi, IdentityApi } from '@backstage/core-plugin-api';\nimport { IdentityAuthInjectorFetchMiddleware } from './IdentityAuthInjectorFetchMiddleware';\nimport { PluginProtocolResolverFetchMiddleware } from './PluginProtocolResolverFetchMiddleware';\nimport { FetchMiddleware } from './types';\n\n/**\n * A collection of common middlewares for the FetchApi.\n *\n * @public\n */\nexport class FetchMiddlewares {\n  /**\n   * Handles translation from `plugin://` URLs to concrete http(s) URLs based on\n   * the discovery API.\n   *\n   * @remarks\n   *\n   * If the request is for `plugin://catalog/entities?filter=x=y`, the discovery\n   * API will be queried for `'catalog'`. If it returned\n   * `https://backstage.example.net/api/catalog`, the resulting query would be\n   * `https://backstage.example.net/api/catalog/entities?filter=x=y`.\n   *\n   * If the incoming URL protocol was not `plugin`, the request is just passed\n   * through verbatim to the underlying implementation.\n   */\n  static resolvePluginProtocol(options: {\n    discoveryApi: DiscoveryApi;\n  }): FetchMiddleware {\n    return new PluginProtocolResolverFetchMiddleware(options.discoveryApi);\n  }\n\n  /**\n   * Injects a Backstage token header when the user is signed in.\n   *\n   * @remarks\n   *\n   * Per default, an `Authorization: Bearer <token>` is generated. This can be\n   * customized using the `header` option.\n   *\n   * The header injection only happens on allowlisted URLs. Per default, if the\n   * `config` option is passed in, the `backend.baseUrl` is allowlisted, unless\n   * the `urlPrefixAllowlist` or `allowUrl` options are passed in, in which case\n   * they take precedence. If you pass in neither config nor an\n   * allowlist/callback, the middleware will have no effect since effectively no\n   * request will match the (nonexistent) rules.\n   */\n  static injectIdentityAuth(options: {\n    identityApi: IdentityApi;\n    config?: Config;\n    urlPrefixAllowlist?: string[];\n    allowUrl?: (url: string) => boolean;\n    header?: {\n      name: string;\n      value: (backstageToken: string) => string;\n    };\n  }): FetchMiddleware {\n    return IdentityAuthInjectorFetchMiddleware.create(options);\n  }\n\n  private constructor() {}\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Observable } from '@backstage/types';\nimport { BehaviorSubject } from '../../../lib/subjects';\n\ntype RequestQueueEntry<ResultType> = {\n  scopes: Set<string>;\n  resolve: (value: ResultType | PromiseLike<ResultType>) => void;\n  reject: (reason: Error) => void;\n};\n\nexport type PendingRequest<ResultType> = {\n  scopes: Set<string> | undefined;\n  resolve: (value: ResultType) => void;\n  reject: (reason: Error) => void;\n};\n\nexport function hasScopes(\n  searched: Set<string>,\n  searchFor: Set<string>,\n): boolean {\n  for (const scope of searchFor) {\n    if (!searched.has(scope)) {\n      return false;\n    }\n  }\n  return true;\n}\n\nexport function joinScopes(\n  scopes: Set<string>,\n  ...moreScopess: Set<string>[]\n): Set<string> {\n  const result = new Set(scopes);\n\n  for (const moreScopes of moreScopess) {\n    for (const scope of moreScopes) {\n      result.add(scope);\n    }\n  }\n\n  return result;\n}\n\n/**\n * The OAuthPendingRequests class is a utility for managing and observing\n * a stream of requests for oauth scopes for a single provider, and resolving\n * them correctly once requests are fulfilled.\n */\nexport class OAuthPendingRequests<ResultType> {\n  private requests: RequestQueueEntry<ResultType>[] = [];\n  private subject = new BehaviorSubject<PendingRequest<ResultType>>(\n    this.getCurrentPending(),\n  );\n\n  request(scopes: Set<string>): Promise<ResultType> {\n    return new Promise((resolve, reject) => {\n      this.requests.push({ scopes, resolve, reject });\n\n      this.subject.next(this.getCurrentPending());\n    });\n  }\n\n  resolve(scopes: Set<string>, result: ResultType): void {\n    this.requests = this.requests.filter(request => {\n      if (hasScopes(scopes, request.scopes)) {\n        request.resolve(result);\n        return false;\n      }\n      return true;\n    });\n\n    this.subject.next(this.getCurrentPending());\n  }\n\n  reject(error: Error) {\n    this.requests.forEach(request => request.reject(error));\n    this.requests = [];\n\n    this.subject.next(this.getCurrentPending());\n  }\n\n  pending(): Observable<PendingRequest<ResultType>> {\n    return this.subject;\n  }\n\n  private getCurrentPending(): PendingRequest<ResultType> {\n    const currentScopes =\n      this.requests.length === 0\n        ? undefined\n        : this.requests\n            .slice(1)\n            .reduce(\n              (acc, current) => joinScopes(acc, current.scopes),\n              this.requests[0].scopes,\n            );\n\n    return {\n      scopes: currentScopes,\n      resolve: (value: ResultType) => {\n        if (currentScopes) {\n          this.resolve(currentScopes, value);\n        }\n      },\n      reject: (reason: Error) => {\n        if (currentScopes) {\n          this.reject(reason);\n        }\n      },\n    };\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  OAuthRequestApi,\n  PendingOAuthRequest,\n  OAuthRequester,\n  OAuthRequesterOptions,\n} from '@backstage/core-plugin-api';\nimport { Observable } from '@backstage/types';\nimport { OAuthPendingRequests, PendingRequest } from './OAuthPendingRequests';\nimport { BehaviorSubject } from '../../../lib/subjects';\n\n/**\n * The OAuthRequestManager is an implementation of the OAuthRequestApi.\n *\n * The purpose of this class and the API is to read a stream of incoming requests\n * of OAuth access tokens from different providers with varying scope, and funnel\n * them all together into a single request for each OAuth provider.\n *\n * @public\n */\nexport class OAuthRequestManager implements OAuthRequestApi {\n  private readonly subject = new BehaviorSubject<PendingOAuthRequest[]>([]);\n  private currentRequests: PendingOAuthRequest[] = [];\n  private handlerCount = 0;\n\n  createAuthRequester<T>(options: OAuthRequesterOptions<T>): OAuthRequester<T> {\n    const handler = new OAuthPendingRequests<T>();\n\n    const index = this.handlerCount;\n    this.handlerCount++;\n\n    handler.pending().subscribe({\n      next: scopeRequest => {\n        const newRequests = this.currentRequests.slice();\n        const request = this.makeAuthRequest(scopeRequest, options);\n        if (!request) {\n          delete newRequests[index];\n        } else {\n          newRequests[index] = request;\n        }\n        this.currentRequests = newRequests;\n        // Convert from sparse array to array of present items only\n        this.subject.next(newRequests.filter(Boolean));\n      },\n    });\n\n    return scopes => {\n      return handler.request(scopes);\n    };\n  }\n\n  // Converts the pending request and popup options into a popup request that we can forward to subscribers.\n  private makeAuthRequest(\n    request: PendingRequest<any>,\n    options: OAuthRequesterOptions<any>,\n  ): PendingOAuthRequest | undefined {\n    const { scopes } = request;\n    if (!scopes) {\n      return undefined;\n    }\n\n    return {\n      provider: options.provider,\n      trigger: async () => {\n        const result = await options.onAuthRequest(scopes);\n        request.resolve(result);\n      },\n      reject: () => {\n        const error = new Error('Login failed, rejected by user');\n        error.name = 'RejectedError';\n        request.reject(error);\n      },\n    };\n  }\n\n  authRequest$(): Observable<PendingOAuthRequest[]> {\n    return this.subject;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  StorageApi,\n  StorageValueSnapshot,\n  ErrorApi,\n} from '@backstage/core-plugin-api';\nimport { JsonValue, Observable } from '@backstage/types';\nimport ObservableImpl from 'zen-observable';\n\nconst buckets = new Map<string, WebStorage>();\n\n/**\n * An implementation of the storage API, that uses the browser's local storage.\n *\n * @public\n */\nexport class WebStorage implements StorageApi {\n  constructor(\n    private readonly namespace: string,\n    private readonly errorApi: ErrorApi,\n  ) {}\n\n  static create(options: {\n    errorApi: ErrorApi;\n    namespace?: string;\n  }): WebStorage {\n    return new WebStorage(options.namespace ?? '', options.errorApi);\n  }\n\n  get<T>(key: string): T | undefined {\n    return this.snapshot(key).value as T | undefined;\n  }\n\n  snapshot<T extends JsonValue>(key: string): StorageValueSnapshot<T> {\n    let value = undefined;\n    let presence: 'present' | 'absent' = 'absent';\n    try {\n      const item = localStorage.getItem(this.getKeyName(key));\n      if (item) {\n        value = JSON.parse(item, (_key, val) => {\n          if (typeof val === 'object' && val !== null) {\n            Object.freeze(val);\n          }\n          return val;\n        });\n        presence = 'present';\n      }\n    } catch (e) {\n      this.errorApi.post(\n        new Error(`Error when parsing JSON config from storage for: ${key}`),\n      );\n    }\n    return { key, value, presence };\n  }\n\n  forBucket(name: string): WebStorage {\n    const bucketPath = `${this.namespace}/${name}`;\n    if (!buckets.has(bucketPath)) {\n      buckets.set(bucketPath, new WebStorage(bucketPath, this.errorApi));\n    }\n    return buckets.get(bucketPath)!;\n  }\n\n  async set<T>(key: string, data: T): Promise<void> {\n    localStorage.setItem(this.getKeyName(key), JSON.stringify(data));\n    this.notifyChanges(key);\n  }\n\n  async remove(key: string): Promise<void> {\n    localStorage.removeItem(this.getKeyName(key));\n    this.notifyChanges(key);\n  }\n\n  observe$<T>(key: string): Observable<StorageValueSnapshot<T>> {\n    return this.observable.filter(({ key: messageKey }) => messageKey === key);\n  }\n\n  private getKeyName(key: string) {\n    return `${this.namespace}/${encodeURIComponent(key)}`;\n  }\n\n  private notifyChanges(key: string) {\n    const snapshot = this.snapshot(key);\n    for (const subscription of this.subscribers) {\n      subscription.next(snapshot);\n    }\n  }\n\n  private subscribers = new Set<\n    ZenObservable.SubscriptionObserver<StorageValueSnapshot<JsonValue>>\n  >();\n\n  private readonly observable = new ObservableImpl<\n    StorageValueSnapshot<JsonValue>\n  >(subscriber => {\n    this.subscribers.add(subscriber);\n    return () => {\n      this.subscribers.delete(subscriber);\n    };\n  });\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { isValidElement, ReactNode, ReactElement, Children } from 'react';\n\nexport type Discoverer = (element: ReactElement) => ReactNode;\n\nexport type Collector<Result, Context> = () => {\n  accumulator: Result;\n  visit(\n    accumulator: Result,\n    element: ReactElement,\n    parent: ReactElement | undefined,\n    context: Context,\n  ): Context;\n};\n\n/**\n * A function that allows you to traverse a tree of React elements using\n * varying methods to discover child nodes and collect data along the way.\n */\nexport function traverseElementTree<Results>(options: {\n  root: ReactNode;\n  discoverers: Discoverer[];\n  collectors: { [name in keyof Results]: Collector<Results[name], any> };\n}): Results {\n  const collectors: {\n    [name in string]: ReturnType<Collector<any, any>>;\n  } = {};\n\n  // Bootstrap all collectors, initializing the accumulators and providing the visitor function\n  for (const name in options.collectors) {\n    if (options.collectors.hasOwnProperty(name)) {\n      collectors[name] = options.collectors[name]();\n    }\n  }\n\n  // Internal representation of an element in the tree that we're iterating over\n  type QueueItem = {\n    node: ReactNode;\n    parent: ReactElement | undefined;\n    contexts: { [name in string]: unknown };\n  };\n\n  const queue = [\n    {\n      node: Children.toArray(options.root),\n      parent: undefined,\n      contexts: {},\n    } as QueueItem,\n  ];\n\n  while (queue.length !== 0) {\n    const { node, parent, contexts } = queue.shift()!;\n\n    // While the parent and the element we pass on to collectors and discoverers\n    // have been validated and are known to be React elements, the child nodes\n    // emitted by the discoverers are not.\n    Children.forEach(node, element => {\n      if (!isValidElement(element)) {\n        return;\n      }\n\n      const nextContexts: QueueItem['contexts'] = {};\n\n      // Collectors populate their result data using the current node, and compute\n      // context for the next iteration\n      for (const name in collectors) {\n        if (collectors.hasOwnProperty(name)) {\n          const collector = collectors[name];\n\n          nextContexts[name] = collector.visit(\n            collector.accumulator,\n            element,\n            parent,\n            contexts[name],\n          );\n        }\n      }\n\n      // Discoverers provide ways to continue the traversal from the current element\n      for (const discoverer of options.discoverers) {\n        const children = discoverer(element);\n        if (children) {\n          queue.push({\n            node: children,\n            parent: element,\n            contexts: nextContexts,\n          });\n        }\n      }\n    });\n  }\n\n  return Object.fromEntries(\n    Object.entries(collectors).map(([name, c]) => [name, c.accumulator]),\n  ) as Results;\n}\n\nexport function createCollector<Result, Context>(\n  accumulatorFactory: () => Result,\n  visit: ReturnType<Collector<Result, Context>>['visit'],\n): Collector<Result, Context> {\n  return () => ({ accumulator: accumulatorFactory(), visit });\n}\n\nexport function childDiscoverer(element: ReactElement): ReactNode {\n  return element.props?.children;\n}\n\nexport function routeElementDiscoverer(element: ReactElement): ReactNode {\n  if (element.props?.path && element.props?.element) {\n    return element.props?.element;\n  }\n  return undefined;\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { BackstagePlugin, getComponentData } from '@backstage/core-plugin-api';\nimport { createCollector } from '../extensions/traversal';\n\nexport const pluginCollector = createCollector(\n  () => new Set<BackstagePlugin<any, any>>(),\n  (acc, node) => {\n    const plugin = getComponentData<BackstagePlugin<any, any>>(\n      node,\n      'core.plugin',\n    );\n    if (plugin) {\n      acc.add(plugin);\n    }\n  },\n);\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  featureFlagsApiRef,\n  useApi,\n  attachComponentData,\n} from '@backstage/core-plugin-api';\nimport React, { ReactNode } from 'react';\n\n/**\n * Props for the {@link FeatureFlagged} component.\n *\n * @public\n */\nexport type FeatureFlaggedProps = { children: ReactNode } & (\n  | { with: string }\n  | { without: string }\n);\n\n/**\n * Enables or disables rendering of its children based on the state of a given\n * feature flag.\n *\n * @public\n */\nexport const FeatureFlagged = (props: FeatureFlaggedProps) => {\n  const { children } = props;\n  const featureFlagApi = useApi(featureFlagsApiRef);\n  const isEnabled =\n    'with' in props\n      ? featureFlagApi.isActive(props.with)\n      : !featureFlagApi.isActive(props.without);\n  return <>{isEnabled ? children : null}</>;\n};\n\nattachComponentData(FeatureFlagged, 'core.featureFlagged', true);\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  RouteRef,\n  getComponentData,\n  BackstagePlugin,\n} from '@backstage/core-plugin-api';\nimport { isValidElement } from 'react';\nimport { BackstageRouteObject } from './types';\nimport { createCollector } from '../extensions/traversal';\nimport { FeatureFlagged, FeatureFlaggedProps } from './FeatureFlagged';\n\n// We always add a child that matches all subroutes but without any route refs. This makes\n// sure that we're always able to match each route no matter how deep the navigation goes.\n// The route resolver then takes care of selecting the most specific match in order to find\n// mount points that are as deep in the routing tree as possible.\nexport const MATCH_ALL_ROUTE: BackstageRouteObject = {\n  caseSensitive: false,\n  path: '/*',\n  element: 'match-all', // These elements aren't used, so we add in a bit of debug information\n  routeRefs: new Set(),\n};\n\ninterface RoutingV1CollectorContext {\n  path?: string;\n  routeRef?: RouteRef;\n  obj?: BackstageRouteObject;\n  sticky?: boolean;\n}\n\n/**\n * This is the old V1 logic for collecting the routing model.\n * It is being replaced by a new collector because this collection\n * logic does not work well beyond react-router v6 beta.\n *\n * The breaking change is that react-router now requires route\n * elements to be `Route` components, and directly renders the\n * element prop rather than the `Route` itself. This means it is\n * no longer possible to create utility route components. In order\n * to fill this gap and in general simplify the route collection\n * logic, a new route collection logic is created.\n *\n * @internal\n */\nexport const routingV1Collector = createCollector(\n  () => ({\n    paths: new Map<RouteRef, string>(),\n    parents: new Map<RouteRef, RouteRef | undefined>(),\n    objects: new Array<BackstageRouteObject>(),\n  }),\n  (acc, node, parent, ctx?: RoutingV1CollectorContext) => {\n    // Ignore the top-level element within element props, since it's already been collected.\n    if (parent?.props.element === node) {\n      return ctx;\n    }\n\n    let currentObj = ctx?.obj;\n    let currentParentRouteRef = ctx?.routeRef;\n    let sticky = ctx?.sticky;\n\n    const path: string | undefined = node.props?.path;\n    const parentChildren = currentObj?.children ?? acc.objects;\n    const caseSensitive: boolean = Boolean(node.props?.caseSensitive);\n\n    // The context path is used during mount point gathering to assign the same path\n    // to all discovered mount points\n    let currentCtxPath = ctx?.path;\n\n    // Start gathering mount points when we encounter a mount point gathering flag\n    if (getComponentData<boolean>(node, 'core.gatherMountPoints')) {\n      if (!path) {\n        throw new Error('Mount point gatherer must have a path');\n      }\n      currentCtxPath = path;\n    }\n\n    // Route refs are discovered on the element itself, and on the top-level\n    // element within the element prop if it exists.\n    const element = node.props?.element;\n    let routeRef = getComponentData<RouteRef>(node, 'core.mountPoint');\n    if (!routeRef && isValidElement(element)) {\n      routeRef = getComponentData<RouteRef>(element, 'core.mountPoint');\n    }\n\n    if (routeRef) {\n      // First the path gathering\n\n      let routePath: string | undefined = path;\n      // If we're gathering mount points we use the context path as out path, unless\n      // the element has its own path, in which case we use that instead and stop gathering\n      if (currentCtxPath) {\n        if (routePath) {\n          currentCtxPath = undefined;\n        } else {\n          routePath = currentCtxPath;\n        }\n      }\n      if (!routePath) {\n        throw new Error('Mounted routable extension must have a path');\n      }\n      acc.paths.set(routeRef, routePath);\n\n      // Then the parent gathering\n\n      // \"sticky\" route ref is when we've encountered a mount point gatherer, and we want a\n      // mount points beneath it to have the same parent, regardless of internal structure\n      if (currentParentRouteRef && sticky) {\n        acc.parents.set(routeRef, currentParentRouteRef);\n\n        // When we encounter a mount point with an explicit path, we stop gathering\n        // mount points within the children and remove the sticky state\n        if (path) {\n          currentParentRouteRef = routeRef;\n          sticky = false;\n        }\n      } else {\n        acc.parents.set(routeRef, currentParentRouteRef);\n        currentParentRouteRef = routeRef;\n      }\n\n      // Then construct the objects\n\n      if (path) {\n        currentObj = {\n          caseSensitive,\n          path,\n          element: 'mounted',\n          routeRefs: new Set([routeRef]),\n          children: [MATCH_ALL_ROUTE],\n          plugin: getComponentData<BackstagePlugin>(\n            node.props.element,\n            'core.plugin',\n          ),\n        };\n        parentChildren.push(currentObj);\n      } else {\n        currentObj?.routeRefs.add(routeRef);\n      }\n    }\n\n    if (getComponentData<boolean>(node, 'core.gatherMountPoints')) {\n      sticky = true;\n    }\n\n    const isGatherer = getComponentData<boolean>(\n      node,\n      'core.gatherMountPoints',\n    );\n    if (isGatherer) {\n      if (!path) {\n        throw new Error('Mount point gatherer must have a path');\n      }\n      if (!routeRef) {\n        currentObj = {\n          caseSensitive,\n          path,\n          element: 'gathered',\n          routeRefs: new Set(),\n          children: [MATCH_ALL_ROUTE],\n          plugin: ctx?.obj?.plugin,\n        };\n        parentChildren.push(currentObj);\n      }\n    }\n\n    return {\n      obj: currentObj,\n      path: currentCtxPath,\n      routeRef: currentParentRouteRef,\n      sticky,\n    };\n  },\n);\n\nexport const featureFlagCollector = createCollector(\n  () => new Set<string>(),\n  (acc, node) => {\n    if (node.type === FeatureFlagged) {\n      const props = node.props as FeatureFlaggedProps;\n      acc.add('with' in props ? props.with : props.without);\n    }\n  },\n);\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  RouteRef,\n  SubRouteRef,\n  ExternalRouteRef,\n  BackstagePlugin,\n} from '@backstage/core-plugin-api';\nimport { getOrCreateGlobalSingleton } from '@backstage/version-bridge';\n\ntype RouteRefType = Exclude<\n  keyof RouteRef,\n  'params' | 'path' | 'title' | 'icon'\n>;\nexport const routeRefType: RouteRefType = getOrCreateGlobalSingleton<any>(\n  'route-ref-type',\n  () => Symbol('route-ref-type'),\n);\n\nexport type AnyParams = { [param in string]: string } | undefined;\n\nexport type AnyRouteRef =\n  | RouteRef<any>\n  | SubRouteRef<any>\n  | ExternalRouteRef<any, any>;\n\n// The extra TS magic here is to require a single params argument if the RouteRef\n// had at least one param defined, but require 0 arguments if there are no params defined.\n// Without this we'd have to pass in empty object to all parameter-less RouteRefs\n// just to make TypeScript happy, or we would have to make the argument optional in\n// which case you might forget to pass it in when it is actually required.\nexport type RouteFunc<Params extends AnyParams> = (\n  ...[params]: Params extends undefined ? readonly [] : readonly [Params]\n) => string;\n\n// A duplicate of the react-router RouteObject, but with routeRef added\nexport interface BackstageRouteObject {\n  caseSensitive: boolean;\n  children?: BackstageRouteObject[];\n  element: React.ReactNode;\n  path: string;\n  routeRefs: Set<RouteRef>;\n  plugin?: BackstagePlugin;\n}\n\nexport function isRouteRef<Params extends AnyParams>(\n  routeRef:\n    | RouteRef<Params>\n    | SubRouteRef<Params>\n    | ExternalRouteRef<Params, any>,\n): routeRef is RouteRef<Params> {\n  return routeRef[routeRefType] === 'absolute';\n}\n\nexport function isSubRouteRef<Params extends AnyParams>(\n  routeRef:\n    | RouteRef<Params>\n    | SubRouteRef<Params>\n    | ExternalRouteRef<Params, any>,\n): routeRef is SubRouteRef<Params> {\n  return routeRef[routeRefType] === 'sub';\n}\n\nexport function isExternalRouteRef<\n  Params extends AnyParams,\n  Optional extends boolean,\n>(\n  routeRef:\n    | RouteRef<Params>\n    | SubRouteRef<Params>\n    | ExternalRouteRef<Params, Optional>,\n): routeRef is ExternalRouteRef<Params, Optional> {\n  return routeRef[routeRefType] === 'external';\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { generatePath, matchRoutes } from 'react-router-dom';\nimport {\n  AnyRouteRef,\n  BackstageRouteObject,\n  AnyParams,\n  RouteFunc,\n  routeRefType,\n  isRouteRef,\n  isSubRouteRef,\n  isExternalRouteRef,\n} from './types';\nimport {\n  RouteRef,\n  ExternalRouteRef,\n  SubRouteRef,\n} from '@backstage/core-plugin-api';\n\n// Joins a list of paths together, avoiding trailing and duplicate slashes\nfunction joinPaths(...paths: string[]): string {\n  const normalized = paths.join('/').replace(/\\/\\/+/g, '/');\n  if (normalized !== '/' && normalized.endsWith('/')) {\n    return normalized.slice(0, -1);\n  }\n  return normalized;\n}\n\n/**\n * Resolves the absolute route ref that our target route ref is pointing pointing to, as well\n * as the relative target path.\n *\n * Returns an undefined target ref if one could not be fully resolved.\n */\nfunction resolveTargetRef(\n  anyRouteRef: AnyRouteRef,\n  routePaths: Map<RouteRef, string>,\n  routeBindings: Map<AnyRouteRef, AnyRouteRef | undefined>,\n): readonly [RouteRef | undefined, string] {\n  // First we figure out which absolute route ref we're dealing with, an if there was an sub route path to append.\n  // For sub routes it will be the parent path, while for external routes it will be the bound route.\n  let targetRef: RouteRef;\n  let subRoutePath = '';\n  if (isRouteRef(anyRouteRef)) {\n    targetRef = anyRouteRef;\n  } else if (isSubRouteRef(anyRouteRef)) {\n    targetRef = anyRouteRef.parent;\n    subRoutePath = anyRouteRef.path;\n  } else if (isExternalRouteRef(anyRouteRef)) {\n    const resolvedRoute = routeBindings.get(anyRouteRef);\n    if (!resolvedRoute) {\n      return [undefined, ''];\n    }\n    if (isRouteRef(resolvedRoute)) {\n      targetRef = resolvedRoute;\n    } else if (isSubRouteRef(resolvedRoute)) {\n      targetRef = resolvedRoute.parent;\n      subRoutePath = resolvedRoute.path;\n    } else {\n      throw new Error(\n        `ExternalRouteRef was bound to invalid target, ${resolvedRoute}`,\n      );\n    }\n  } else if (anyRouteRef[routeRefType]) {\n    throw new Error(\n      `Unknown or invalid route ref type, ${anyRouteRef[routeRefType]}`,\n    );\n  } else {\n    throw new Error(`Unknown object passed to useRouteRef, got ${anyRouteRef}`);\n  }\n\n  // Bail if no absolute path could be resolved\n  if (!targetRef) {\n    return [undefined, ''];\n  }\n\n  // Find the path that our target route is bound to\n  const resolvedPath = routePaths.get(targetRef);\n  if (!resolvedPath) {\n    return [undefined, ''];\n  }\n\n  // SubRouteRefs join the path from the parent route with its own path\n  const targetPath = joinPaths(resolvedPath, subRoutePath);\n  return [targetRef, targetPath];\n}\n\n/**\n * Resolves the complete base path for navigating to the target RouteRef.\n */\nfunction resolveBasePath(\n  targetRef: RouteRef,\n  sourceLocation: Parameters<typeof matchRoutes>[1],\n  routePaths: Map<RouteRef, string>,\n  routeParents: Map<RouteRef, RouteRef | undefined>,\n  routeObjects: BackstageRouteObject[],\n) {\n  // While traversing the app element tree we build up the routeObjects structure\n  // used here. It is the same kind of structure that react-router creates, with the\n  // addition that associated route refs are stored throughout the tree. This lets\n  // us look up all route refs that can be reached from our source location.\n  // Because of the similar route object structure, we can use `matchRoutes` from\n  // react-router to do the lookup of our current location.\n  const match = matchRoutes(routeObjects, sourceLocation) ?? [];\n\n  // While we search for a common routing root between our current location and\n  // the target route, we build a list of all route refs we find that we need\n  // to traverse to reach the target.\n  const refDiffList = Array<RouteRef>();\n\n  let matchIndex = -1;\n  for (\n    let targetSearchRef: RouteRef | undefined = targetRef;\n    targetSearchRef;\n    targetSearchRef = routeParents.get(targetSearchRef)\n  ) {\n    // The match contains a list of all ancestral route refs present at our current location\n    // Starting at the desired target ref and traversing back through its parents, we search\n    // for a target ref that is present in the match for our current location. When a match\n    // is found it means we have found a common base to resolve the route from.\n    matchIndex = match.findIndex(m =>\n      (m.route as BackstageRouteObject).routeRefs.has(targetSearchRef!),\n    );\n    if (matchIndex !== -1) {\n      break;\n    }\n\n    // Every time we move a step up in the ancestry of the target ref, we add the current ref\n    // to the diff list, which ends up being the list of route refs to traverse form the common base\n    // in order to reach our target.\n    refDiffList.unshift(targetSearchRef);\n  }\n\n  // If our target route is present in the initial match we need to construct the final path\n  // from the parent of the matched route segment. That's to allow the caller of the route\n  // function to supply their own params.\n  if (refDiffList.length === 0) {\n    matchIndex -= 1;\n  }\n\n  // This is the part of the route tree that the target and source locations have in common.\n  // We re-use the existing pathname directly along with all params.\n  const parentPath = matchIndex === -1 ? '' : match[matchIndex].pathname;\n\n  // This constructs the mid section of the path using paths resolved from all route refs\n  // we need to traverse to reach our target except for the very last one. None of these\n  // paths are allowed to require any parameters, as the caller would have no way of knowing\n  // what parameters those are.\n  const diffPath = joinPaths(\n    ...refDiffList.slice(0, -1).map(ref => {\n      const path = routePaths.get(ref);\n      if (!path) {\n        throw new Error(`No path for ${ref}`);\n      }\n      if (path.includes(':')) {\n        throw new Error(\n          `Cannot route to ${targetRef} with parent ${ref} as it has parameters`,\n        );\n      }\n      return path;\n    }),\n  );\n\n  return parentPath + diffPath;\n}\n\nexport class RouteResolver {\n  constructor(\n    private readonly routePaths: Map<RouteRef, string>,\n    private readonly routeParents: Map<RouteRef, RouteRef | undefined>,\n    private readonly routeObjects: BackstageRouteObject[],\n    private readonly routeBindings: Map<\n      ExternalRouteRef,\n      RouteRef | SubRouteRef\n    >,\n    private readonly appBasePath: string, // base path without a trailing slash\n  ) {}\n\n  resolve<Params extends AnyParams>(\n    anyRouteRef:\n      | RouteRef<Params>\n      | SubRouteRef<Params>\n      | ExternalRouteRef<Params, any>,\n    sourceLocation: Parameters<typeof matchRoutes>[1],\n  ): RouteFunc<Params> | undefined {\n    // First figure out what our target absolute ref is, as well as our target path.\n    const [targetRef, targetPath] = resolveTargetRef(\n      anyRouteRef,\n      this.routePaths,\n      this.routeBindings,\n    );\n    if (!targetRef) {\n      return undefined;\n    }\n\n    // The location that we get passed in uses the full path, so start by trimming off\n    // the app base path prefix in case we're running the app on a sub-path.\n    let relativeSourceLocation: Parameters<typeof matchRoutes>[1];\n    if (typeof sourceLocation === 'string') {\n      relativeSourceLocation = this.trimPath(sourceLocation);\n    } else if (sourceLocation.pathname) {\n      relativeSourceLocation = {\n        ...sourceLocation,\n        pathname: this.trimPath(sourceLocation.pathname),\n      };\n    } else {\n      relativeSourceLocation = sourceLocation;\n    }\n\n    // Next we figure out the base path, which is the combination of the common parent path\n    // between our current location and our target location, as well as the additional path\n    // that is the difference between the parent path and the base of our target location.\n    const basePath =\n      this.appBasePath +\n      resolveBasePath(\n        targetRef,\n        relativeSourceLocation,\n        this.routePaths,\n        this.routeParents,\n        this.routeObjects,\n      );\n\n    const routeFunc: RouteFunc<Params> = (...[params]) => {\n      return basePath + generatePath(targetPath, params);\n    };\n    return routeFunc;\n  }\n\n  private trimPath(targetPath: string) {\n    if (!targetPath) {\n      return targetPath;\n    }\n\n    if (targetPath.startsWith(this.appBasePath)) {\n      return targetPath.slice(this.appBasePath.length);\n    }\n    return targetPath;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { ReactNode } from 'react';\nimport {\n  ExternalRouteRef,\n  RouteRef,\n  SubRouteRef,\n} from '@backstage/core-plugin-api';\nimport {\n  createVersionedValueMap,\n  createVersionedContext,\n} from '@backstage/version-bridge';\nimport { RouteResolver } from './RouteResolver';\nimport { BackstageRouteObject } from './types';\n\nconst RoutingContext = createVersionedContext<{ 1: RouteResolver }>(\n  'routing-context',\n);\n\ntype ProviderProps = {\n  routePaths: Map<RouteRef, string>;\n  routeParents: Map<RouteRef, RouteRef | undefined>;\n  routeObjects: BackstageRouteObject[];\n  routeBindings: Map<ExternalRouteRef, RouteRef | SubRouteRef>;\n  basePath?: string;\n  children: ReactNode;\n};\n\nexport const RoutingProvider = ({\n  routePaths,\n  routeParents,\n  routeObjects,\n  routeBindings,\n  basePath = '',\n  children,\n}: ProviderProps) => {\n  const resolver = new RouteResolver(\n    routePaths,\n    routeParents,\n    routeObjects,\n    routeBindings,\n    basePath,\n  );\n\n  const versionedValue = createVersionedValueMap({ 1: resolver });\n  return (\n    <RoutingContext.Provider value={versionedValue}>\n      {children}\n    </RoutingContext.Provider>\n  );\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useEffect } from 'react';\nimport { matchRoutes, useLocation } from 'react-router-dom';\nimport {\n  useAnalytics,\n  AnalyticsContext,\n  CommonAnalyticsContext,\n  RouteRef,\n} from '@backstage/core-plugin-api';\nimport { BackstageRouteObject } from './types';\n\n/**\n * Returns an extension context given the current pathname and a list of\n * Backstage route objects.\n */\nconst getExtensionContext = (\n  pathname: string,\n  routes: BackstageRouteObject[],\n): CommonAnalyticsContext | {} => {\n  try {\n    // Find matching routes for the given path name.\n    const matches = matchRoutes(routes, { pathname }) as\n      | { route: BackstageRouteObject }[]\n      | null;\n\n    // Of the matching routes, get the last (e.g. most specific) instance of\n    // the BackstageRouteObject.\n    const routeObject = matches\n      ?.filter(match => match?.route.routeRefs?.size > 0)\n      .pop()?.route;\n\n    // If there is no route object, then allow inheritance of default context.\n    if (!routeObject) {\n      return {};\n    }\n\n    // If there is a single route ref, return it.\n    // todo: get routeRef of rendered gathered mount point(?)\n    let routeRef: RouteRef | undefined;\n    if (routeObject.routeRefs.size === 1) {\n      routeRef = routeObject.routeRefs.values().next().value;\n    }\n\n    return {\n      extension: 'App',\n      pluginId: routeObject.plugin?.getId() || 'root',\n      ...(routeRef ? { routeRef: (routeRef as { id?: string }).id } : {}),\n    };\n  } catch {\n    return {};\n  }\n};\n\n/**\n * Performs the actual event capture on render.\n */\nconst TrackNavigation = ({\n  pathname,\n  search,\n  hash,\n}: {\n  pathname: string;\n  search: string;\n  hash: string;\n}) => {\n  const analytics = useAnalytics();\n\n  useEffect(() => {\n    analytics.captureEvent('navigate', `${pathname}${search}${hash}`);\n  }, [analytics, pathname, search, hash]);\n\n  return null;\n};\n\n/**\n * Logs a \"navigate\" event with appropriate plugin-level analytics context\n * attributes each time the user navigates to a page.\n */\nexport const RouteTracker = ({\n  routeObjects,\n}: {\n  routeObjects: BackstageRouteObject[];\n}) => {\n  const { pathname, search, hash } = useLocation();\n\n  return (\n    <AnalyticsContext attributes={getExtensionContext(pathname, routeObjects)}>\n      <TrackNavigation pathname={pathname} search={search} hash={hash} />\n    </AnalyticsContext>\n  );\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  BackstagePlugin,\n  ExternalRouteRef,\n  RouteRef,\n  SubRouteRef,\n} from '@backstage/core-plugin-api';\nimport { AnyRouteRef } from './types';\n\n// Validates that there is no duplication of route parameter names\nexport function validateRouteParameters(\n  routePaths: Map<AnyRouteRef, string>,\n  routeParents: Map<AnyRouteRef, AnyRouteRef | undefined>,\n) {\n  const notLeafRoutes = new Set(routeParents.values());\n  notLeafRoutes.delete(undefined);\n\n  for (const route of routeParents.keys()) {\n    if (notLeafRoutes.has(route)) {\n      continue;\n    }\n\n    let currentRouteRef: AnyRouteRef | undefined = route;\n\n    let fullPath = '';\n    while (currentRouteRef) {\n      const path = routePaths.get(currentRouteRef);\n      if (!path) {\n        throw new Error(`No path for ${currentRouteRef}`);\n      }\n      fullPath = `${path}${fullPath}`;\n      currentRouteRef = routeParents.get(currentRouteRef);\n    }\n\n    const params = fullPath.match(/:(\\w+)/g);\n    if (params) {\n      for (let j = 0; j < params.length; j++) {\n        for (let i = j + 1; i < params.length; i++) {\n          if (params[i] === params[j]) {\n            throw new Error(\n              `Parameter ${params[i]} is duplicated in path ${fullPath}`,\n            );\n          }\n        }\n      }\n    }\n  }\n}\n\n// Validates that all non-optional external routes have been bound\nexport function validateRouteBindings(\n  routeBindings: Map<ExternalRouteRef, RouteRef | SubRouteRef>,\n  plugins: Iterable<BackstagePlugin<{}, Record<string, ExternalRouteRef>>>,\n) {\n  for (const plugin of plugins) {\n    if (!plugin.externalRoutes) {\n      continue;\n    }\n\n    for (const [name, externalRouteRef] of Object.entries(\n      plugin.externalRoutes,\n    )) {\n      if (externalRouteRef.optional) {\n        continue;\n      }\n\n      if (!routeBindings.has(externalRouteRef)) {\n        throw new Error(\n          `External route '${name}' of the '${plugin.getId()}' plugin must be bound to a target route. ` +\n            'See https://backstage.io/link?bind-routes for details.',\n        );\n      }\n    }\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { PropsWithChildren } from 'react';\nimport {\n  createVersionedValueMap,\n  createVersionedContext,\n} from '@backstage/version-bridge';\nimport { AppContext as AppContextV1 } from './types';\n\nconst AppContext = createVersionedContext<{ 1: AppContextV1 }>('app-context');\n\ntype Props = {\n  appContext: AppContextV1;\n};\n\nexport const AppContextProvider = ({\n  appContext,\n  children,\n}: PropsWithChildren<Props>) => {\n  const versionedValue = createVersionedValueMap({ 1: appContext });\n\n  return <AppContext.Provider value={versionedValue} children={children} />;\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  IdentityApi,\n  ProfileInfo,\n  BackstageUserIdentity,\n} from '@backstage/core-plugin-api';\n\nfunction mkError(thing: string) {\n  return new Error(\n    `Tried to access IdentityApi ${thing} before app was loaded`,\n  );\n}\n\nfunction logDeprecation(thing: string) {\n  // eslint-disable-next-line no-console\n  console.warn(\n    `WARNING: Call to ${thing} is deprecated and will break in the future`,\n  );\n}\n\n// We use this for a period of backwards compatibility. It is a hidden\n// compatibility that will allow old plugins to continue working for a limited time.\ntype CompatibilityIdentityApi = IdentityApi & {\n  getUserId?(): string;\n  getIdToken?(): Promise<string | undefined>;\n  getProfile?(): ProfileInfo;\n};\n\n/**\n * Implementation of the connection between the App-wide IdentityApi\n * and sign-in page.\n */\nexport class AppIdentityProxy implements IdentityApi {\n  private target?: CompatibilityIdentityApi;\n  private waitForTarget: Promise<CompatibilityIdentityApi>;\n  private resolveTarget: (api: CompatibilityIdentityApi) => void = () => {};\n\n  constructor() {\n    this.waitForTarget = new Promise<CompatibilityIdentityApi>(resolve => {\n      this.resolveTarget = resolve;\n    });\n  }\n\n  // This is called by the app manager once the sign-in page provides us with an implementation\n  setTarget(identityApi: CompatibilityIdentityApi) {\n    this.target = identityApi;\n    this.resolveTarget(identityApi);\n  }\n\n  getUserId(): string {\n    if (!this.target) {\n      throw mkError('getUserId');\n    }\n    if (!this.target.getUserId) {\n      throw new Error('IdentityApi does not implement getUserId');\n    }\n    logDeprecation('getUserId');\n    return this.target.getUserId();\n  }\n\n  getProfile(): ProfileInfo {\n    if (!this.target) {\n      throw mkError('getProfile');\n    }\n    if (!this.target.getProfile) {\n      throw new Error('IdentityApi does not implement getProfile');\n    }\n    logDeprecation('getProfile');\n    return this.target.getProfile();\n  }\n\n  async getProfileInfo(): Promise<ProfileInfo> {\n    return this.waitForTarget.then(target => target.getProfileInfo());\n  }\n\n  async getBackstageIdentity(): Promise<BackstageUserIdentity> {\n    const identity = await this.waitForTarget.then(target =>\n      target.getBackstageIdentity(),\n    );\n    if (!identity.userEntityRef.match(/^.*:.*\\/.*$/)) {\n      // eslint-disable-next-line no-console\n      console.warn(\n        `WARNING: The App IdentityApi provided an invalid userEntityRef, '${identity.userEntityRef}'. ` +\n          `It must be a full Entity Reference of the form '<kind>:<namespace>/<name>'.`,\n      );\n    }\n\n    return identity;\n  }\n\n  async getCredentials(): Promise<{ token?: string | undefined }> {\n    return this.waitForTarget.then(target => target.getCredentials());\n  }\n\n  async getIdToken(): Promise<string | undefined> {\n    return this.waitForTarget.then(target => {\n      if (!target.getIdToken) {\n        throw new Error('IdentityApi does not implement getIdToken');\n      }\n      logDeprecation('getIdToken');\n      return target.getIdToken();\n    });\n  }\n\n  async signOut(): Promise<void> {\n    await this.waitForTarget.then(target => target.signOut());\n    location.reload();\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useMemo, useEffect, useState, PropsWithChildren } from 'react';\nimport { useApi, appThemeApiRef, AppTheme } from '@backstage/core-plugin-api';\nimport useObservable from 'react-use/lib/useObservable';\n\n// This tries to find the most accurate match, but also falls back to less\n// accurate results in order to avoid errors.\nfunction resolveTheme(\n  themeId: string | undefined,\n  shouldPreferDark: boolean,\n  themes: AppTheme[],\n) {\n  if (themeId !== undefined) {\n    const selectedTheme = themes.find(theme => theme.id === themeId);\n    if (selectedTheme) {\n      return selectedTheme;\n    }\n  }\n\n  if (shouldPreferDark) {\n    const darkTheme = themes.find(theme => theme.variant === 'dark');\n    if (darkTheme) {\n      return darkTheme;\n    }\n  }\n\n  const lightTheme = themes.find(theme => theme.variant === 'light');\n  if (lightTheme) {\n    return lightTheme;\n  }\n\n  return themes[0];\n}\n\nconst useShouldPreferDarkTheme = () => {\n  const mediaQuery = useMemo(\n    () => window.matchMedia('(prefers-color-scheme: dark)'),\n    [],\n  );\n  const [shouldPreferDark, setPrefersDark] = useState(mediaQuery.matches);\n\n  useEffect(() => {\n    const listener = (event: MediaQueryListEvent) => {\n      setPrefersDark(event.matches);\n    };\n    mediaQuery.addListener(listener);\n    return () => {\n      mediaQuery.removeListener(listener);\n    };\n  }, [mediaQuery]);\n\n  return shouldPreferDark;\n};\n\nexport function AppThemeProvider({ children }: PropsWithChildren<{}>) {\n  const appThemeApi = useApi(appThemeApiRef);\n  const themeId = useObservable(\n    appThemeApi.activeThemeId$(),\n    appThemeApi.getActiveThemeId(),\n  );\n\n  // Browser feature detection won't change over time, so ignore lint rule\n  const shouldPreferDark = Boolean(window.matchMedia)\n    ? useShouldPreferDarkTheme() // eslint-disable-line react-hooks/rules-of-hooks\n    : false;\n\n  const appTheme = resolveTheme(\n    themeId,\n    shouldPreferDark,\n    appThemeApi.getInstalledThemes(),\n  );\n  if (!appTheme) {\n    throw new Error('App has no themes');\n  }\n\n  return <appTheme.Provider children={children} />;\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AppConfig } from '@backstage/config';\nimport { JsonObject } from '@backstage/types';\nimport { AppConfigLoader } from './types';\n\n/**\n * The default config loader, which expects that config is available at compile-time\n * in `process.env.APP_CONFIG`. APP_CONFIG should be an array of config objects as\n * returned by the config loader.\n *\n * It will also load runtime config from the __APP_INJECTED_RUNTIME_CONFIG__ string,\n * which can be rewritten at runtime to contain an additional JSON config object.\n * If runtime config is present, it will be placed first in the config array, overriding\n * other config values.\n *\n * @public\n */\nexport const defaultConfigLoader: AppConfigLoader = async (\n  // This string may be replaced at runtime to provide additional config.\n  // It should be replaced by a JSON-serialized config object.\n  // It's a param so we can test it, but at runtime this will always fall back to default.\n  runtimeConfigJson: string = '__APP_INJECTED_RUNTIME_CONFIG__',\n) => {\n  const appConfig = process.env.APP_CONFIG;\n  if (!appConfig) {\n    throw new Error('No static configuration provided');\n  }\n  if (!Array.isArray(appConfig)) {\n    throw new Error('Static configuration has invalid format');\n  }\n  const configs = appConfig.slice() as unknown as AppConfig[];\n\n  // Avoiding this string also being replaced at runtime\n  if (\n    runtimeConfigJson !==\n    '__app_injected_runtime_config__'.toLocaleUpperCase('en-US')\n  ) {\n    try {\n      const data = JSON.parse(runtimeConfigJson) as JsonObject;\n      if (Array.isArray(data)) {\n        configs.push(...data);\n      } else {\n        configs.push({ data, context: 'env' });\n      }\n    } catch (error) {\n      throw new Error(`Failed to load runtime configuration, ${error}`);\n    }\n  }\n\n  const windowAppConfig = (window as any).__APP_CONFIG__;\n  if (windowAppConfig) {\n    configs.push({\n      context: 'window',\n      data: windowAppConfig,\n    });\n  }\n  return configs;\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ApiRef, ApiHolder } from '@backstage/core-plugin-api';\n\ntype ApiImpl<T = unknown> = readonly [ApiRef<T>, T];\n\n/** @internal */\nclass ApiRegistryBuilder {\n  private apis: [string, unknown][] = [];\n\n  add<T, I extends T>(api: ApiRef<T>, impl: I): I {\n    this.apis.push([api.id, impl]);\n    return impl;\n  }\n\n  build(): ApiRegistry {\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\n    return new ApiRegistry(new Map(this.apis));\n  }\n}\n\n/**\n * A registry for utility APIs.\n *\n * @internal\n */\nexport class ApiRegistry implements ApiHolder {\n  static builder() {\n    return new ApiRegistryBuilder();\n  }\n\n  /**\n   * Creates a new ApiRegistry with a list of API implementations.\n   *\n   * @param apis - A list of pairs mapping an ApiRef to its respective implementation\n   */\n  static from(apis: ApiImpl[]) {\n    return new ApiRegistry(new Map(apis.map(([api, impl]) => [api.id, impl])));\n  }\n\n  /**\n   * Creates a new ApiRegistry with a single API implementation.\n   *\n   * @param api - ApiRef for the API to add\n   * @param impl - Implementation of the API to add\n   */\n  static with<T>(api: ApiRef<T>, impl: T): ApiRegistry {\n    return new ApiRegistry(new Map([[api.id, impl]]));\n  }\n\n  constructor(private readonly apis: Map<string, unknown>) {}\n\n  /**\n   * Returns a new ApiRegistry with the provided API added to the existing ones.\n   *\n   * @param api - ApiRef for the API to add\n   * @param impl - Implementation of the API to add\n   */\n  with<T>(api: ApiRef<T>, impl: T): ApiRegistry {\n    return new ApiRegistry(new Map([...this.apis, [api.id, impl]]));\n  }\n\n  get<T>(api: ApiRef<T>): T | undefined {\n    return this.apis.get(api.id) as T | undefined;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  RouteRef,\n  SubRouteRef,\n  ExternalRouteRef,\n} from '@backstage/core-plugin-api';\nimport { AppOptions, AppRouteBinder } from './types';\n\nexport function resolveRouteBindings(bindRoutes: AppOptions['bindRoutes']) {\n  const result = new Map<ExternalRouteRef, RouteRef | SubRouteRef>();\n\n  if (bindRoutes) {\n    const bind: AppRouteBinder = (\n      externalRoutes,\n      targetRoutes: { [name: string]: RouteRef | SubRouteRef },\n    ) => {\n      for (const [key, value] of Object.entries(targetRoutes)) {\n        const externalRoute = externalRoutes[key];\n        if (!externalRoute) {\n          throw new Error(`Key ${key} is not an existing external route`);\n        }\n        if (!value && !externalRoute.optional) {\n          throw new Error(\n            `External route ${key} is required but was undefined`,\n          );\n        }\n        if (value) {\n          result.set(externalRoute, value);\n        }\n      }\n    };\n    bindRoutes({ bind });\n  }\n\n  return result;\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Config } from '@backstage/config';\nimport React, {\n  ComponentType,\n  createContext,\n  PropsWithChildren,\n  ReactElement,\n  useContext,\n  useEffect,\n  useMemo,\n  useState,\n} from 'react';\nimport { Route, Routes } from 'react-router-dom';\nimport useAsync from 'react-use/lib/useAsync';\nimport {\n  ApiProvider,\n  AppThemeSelector,\n  ConfigReader,\n  LocalStorageFeatureFlags,\n} from '../apis';\nimport {\n  useApi,\n  AnyApiFactory,\n  ApiHolder,\n  IconComponent,\n  AppTheme,\n  appThemeApiRef,\n  configApiRef,\n  AppThemeApi,\n  ConfigApi,\n  featureFlagsApiRef,\n  IdentityApi,\n  identityApiRef,\n  BackstagePlugin,\n} from '@backstage/core-plugin-api';\nimport { ApiFactoryRegistry, ApiResolver } from '../apis/system';\nimport {\n  childDiscoverer,\n  routeElementDiscoverer,\n  traverseElementTree,\n} from '../extensions/traversal';\nimport { pluginCollector } from '../plugins/collectors';\nimport {\n  featureFlagCollector,\n  routingV1Collector,\n} from '../routing/collectors';\nimport { RoutingProvider } from '../routing/RoutingProvider';\nimport { RouteTracker } from '../routing/RouteTracker';\nimport {\n  validateRouteParameters,\n  validateRouteBindings,\n} from '../routing/validation';\nimport { AppContextProvider } from './AppContext';\nimport { AppIdentityProxy } from '../apis/implementations/IdentityApi/AppIdentityProxy';\nimport {\n  AppComponents,\n  AppConfigLoader,\n  AppContext,\n  AppOptions,\n  BackstageApp,\n  SignInPageProps,\n} from './types';\nimport { AppThemeProvider } from './AppThemeProvider';\nimport { defaultConfigLoader } from './defaultConfigLoader';\nimport { ApiRegistry } from '../apis/system/ApiRegistry';\nimport { resolveRouteBindings } from './resolveRouteBindings';\nimport { BackstageRouteObject } from '../routing/types';\n\ntype CompatiblePlugin =\n  | BackstagePlugin<any, any>\n  | (Omit<BackstagePlugin<any, any>, 'getFeatureFlags'> & {\n      output(): Array<{ type: 'feature-flag'; name: string }>;\n    });\n\nconst InternalAppContext = createContext<{\n  routeObjects: BackstageRouteObject[];\n}>({ routeObjects: [] });\n\n/**\n * Get the app base path from the configured app baseUrl.\n *\n * The returned path does not have a trailing slash.\n */\nfunction getBasePath(configApi: Config) {\n  let { pathname } = new URL(\n    configApi.getOptionalString('app.baseUrl') ?? '/',\n    'http://dummy.dev', // baseUrl can be specified as just a path\n  );\n  pathname = pathname.replace(/\\/*$/, '');\n  return pathname;\n}\n\nfunction useConfigLoader(\n  configLoader: AppConfigLoader | undefined,\n  components: AppComponents,\n  appThemeApi: AppThemeApi,\n): { api: ConfigApi } | { node: JSX.Element } {\n  // Keeping this synchronous when a config loader isn't set simplifies tests a lot\n  const hasConfig = Boolean(configLoader);\n  const config = useAsync(configLoader || (() => Promise.resolve([])));\n\n  let noConfigNode = undefined;\n\n  if (hasConfig && config.loading) {\n    const { Progress } = components;\n    noConfigNode = <Progress />;\n  } else if (config.error) {\n    const { BootErrorPage } = components;\n    noConfigNode = <BootErrorPage step=\"load-config\" error={config.error} />;\n  }\n\n  const { ThemeProvider = AppThemeProvider } = components;\n\n  // Before the config is loaded we can't use a router, so exit early\n  if (noConfigNode) {\n    return {\n      node: (\n        <ApiProvider apis={ApiRegistry.with(appThemeApiRef, appThemeApi)}>\n          <ThemeProvider>{noConfigNode}</ThemeProvider>\n        </ApiProvider>\n      ),\n    };\n  }\n\n  const configReader = ConfigReader.fromConfigs(config.value ?? []);\n\n  return { api: configReader };\n}\n\nclass AppContextImpl implements AppContext {\n  constructor(private readonly app: AppManager) {}\n\n  getPlugins(): BackstagePlugin<any, any>[] {\n    return this.app.getPlugins();\n  }\n\n  getSystemIcon(key: string): IconComponent | undefined {\n    return this.app.getSystemIcon(key);\n  }\n\n  getComponents(): AppComponents {\n    return this.app.getComponents();\n  }\n}\n\nexport class AppManager implements BackstageApp {\n  private apiHolder?: ApiHolder;\n  private configApi?: ConfigApi;\n\n  private readonly apis: Iterable<AnyApiFactory>;\n  private readonly icons: NonNullable<AppOptions['icons']>;\n  private readonly plugins: Set<CompatiblePlugin>;\n  private readonly components: AppComponents;\n  private readonly themes: AppTheme[];\n  private readonly configLoader?: AppConfigLoader;\n  private readonly defaultApis: Iterable<AnyApiFactory>;\n  private readonly bindRoutes: AppOptions['bindRoutes'];\n\n  private readonly appIdentityProxy = new AppIdentityProxy();\n  private readonly apiFactoryRegistry: ApiFactoryRegistry;\n\n  constructor(options: AppOptions) {\n    this.apis = options.apis ?? [];\n    this.icons = options.icons;\n    this.plugins = new Set((options.plugins as CompatiblePlugin[]) ?? []);\n    this.components = options.components;\n    this.themes = options.themes as AppTheme[];\n    this.configLoader = options.configLoader ?? defaultConfigLoader;\n    this.defaultApis = options.defaultApis ?? [];\n    this.bindRoutes = options.bindRoutes;\n    this.apiFactoryRegistry = new ApiFactoryRegistry();\n  }\n\n  getPlugins(): BackstagePlugin<any, any>[] {\n    return Array.from(this.plugins) as BackstagePlugin<any, any>[];\n  }\n\n  getSystemIcon(key: string): IconComponent | undefined {\n    return this.icons[key];\n  }\n\n  getComponents(): AppComponents {\n    return this.components;\n  }\n\n  getProvider(): ComponentType<{}> {\n    const appContext = new AppContextImpl(this);\n\n    // We only validate routes once\n    let routesHaveBeenValidated = false;\n\n    const Provider = ({ children }: PropsWithChildren<{}>) => {\n      const appThemeApi = useMemo(\n        () => AppThemeSelector.createWithStorage(this.themes),\n        [],\n      );\n\n      const { routing, featureFlags, routeBindings } = useMemo(() => {\n        const result = traverseElementTree({\n          root: children,\n          discoverers: [childDiscoverer, routeElementDiscoverer],\n          collectors: {\n            routing: routingV1Collector,\n            collectedPlugins: pluginCollector,\n            featureFlags: featureFlagCollector,\n          },\n        });\n\n        // TODO(Rugvip): Restructure the public API so that we can get an immediate view of\n        //               the app, rather than having to wait for the provider to render.\n        //               For now we need to push the additional plugins we find during\n        //               collection and then make sure we initialize things afterwards.\n        result.collectedPlugins.forEach(plugin => this.plugins.add(plugin));\n        this.verifyPlugins(this.plugins);\n\n        // Initialize APIs once all plugins are available\n        this.getApiHolder();\n        return {\n          ...result,\n          routeBindings: resolveRouteBindings(this.bindRoutes),\n        };\n      }, [children]);\n\n      if (!routesHaveBeenValidated) {\n        routesHaveBeenValidated = true;\n        validateRouteParameters(routing.paths, routing.parents);\n        validateRouteBindings(\n          routeBindings,\n          this.plugins as Iterable<BackstagePlugin<any, any>>,\n        );\n      }\n\n      const loadedConfig = useConfigLoader(\n        this.configLoader,\n        this.components,\n        appThemeApi,\n      );\n\n      const hasConfigApi = 'api' in loadedConfig;\n      if (hasConfigApi) {\n        const { api } = loadedConfig as { api: Config };\n        this.configApi = api;\n      }\n\n      useEffect(() => {\n        if (hasConfigApi) {\n          const featureFlagsApi = this.getApiHolder().get(featureFlagsApiRef)!;\n\n          for (const plugin of this.plugins.values()) {\n            if ('getFeatureFlags' in plugin) {\n              for (const flag of plugin.getFeatureFlags()) {\n                featureFlagsApi.registerFlag({\n                  name: flag.name,\n                  pluginId: plugin.getId(),\n                });\n              }\n            } else {\n              for (const output of plugin.output()) {\n                if (output.type === 'feature-flag') {\n                  featureFlagsApi.registerFlag({\n                    name: output.name,\n                    pluginId: plugin.getId(),\n                  });\n                }\n              }\n            }\n          }\n\n          // Go through the featureFlags returned from the traversal and\n          // register those now the configApi has been loaded\n          for (const name of featureFlags) {\n            featureFlagsApi.registerFlag({ name, pluginId: '' });\n          }\n        }\n      }, [hasConfigApi, loadedConfig, featureFlags]);\n\n      if ('node' in loadedConfig) {\n        // Loading or error\n        return loadedConfig.node;\n      }\n\n      const { ThemeProvider = AppThemeProvider } = this.components;\n\n      return (\n        <ApiProvider apis={this.getApiHolder()}>\n          <AppContextProvider appContext={appContext}>\n            <ThemeProvider>\n              <RoutingProvider\n                routePaths={routing.paths}\n                routeParents={routing.parents}\n                routeObjects={routing.objects}\n                routeBindings={routeBindings}\n                basePath={getBasePath(loadedConfig.api)}\n              >\n                <InternalAppContext.Provider\n                  value={{ routeObjects: routing.objects }}\n                >\n                  {children}\n                </InternalAppContext.Provider>\n              </RoutingProvider>\n            </ThemeProvider>\n          </AppContextProvider>\n        </ApiProvider>\n      );\n    };\n    return Provider;\n  }\n\n  getRouter(): ComponentType<{}> {\n    const { Router: RouterComponent, SignInPage: SignInPageComponent } =\n      this.components;\n\n    // This wraps the sign-in page and waits for sign-in to be completed before rendering the app\n    const SignInPageWrapper = ({\n      component: Component,\n      children,\n    }: {\n      component: ComponentType<SignInPageProps>;\n      children: ReactElement;\n    }) => {\n      const [identityApi, setIdentityApi] = useState<IdentityApi>();\n\n      if (!identityApi) {\n        return <Component onSignInSuccess={setIdentityApi} />;\n      }\n\n      this.appIdentityProxy.setTarget(identityApi);\n      return children;\n    };\n\n    const AppRouter = ({ children }: PropsWithChildren<{}>) => {\n      const configApi = useApi(configApiRef);\n      const mountPath = `${getBasePath(configApi)}/*`;\n      const { routeObjects } = useContext(InternalAppContext);\n\n      // If the app hasn't configured a sign-in page, we just continue as guest.\n      if (!SignInPageComponent) {\n        this.appIdentityProxy.setTarget({\n          getUserId: () => 'guest',\n          getIdToken: async () => undefined,\n          getProfile: () => ({\n            email: 'guest@example.com',\n            displayName: 'Guest',\n          }),\n          getProfileInfo: async () => ({\n            email: 'guest@example.com',\n            displayName: 'Guest',\n          }),\n          getBackstageIdentity: async () => ({\n            type: 'user',\n            userEntityRef: 'user:default/guest',\n            ownershipEntityRefs: ['user:default/guest'],\n          }),\n          getCredentials: async () => ({}),\n          signOut: async () => {},\n        });\n\n        return (\n          <RouterComponent>\n            <RouteTracker routeObjects={routeObjects} />\n            <Routes>\n              <Route path={mountPath} element={<>{children}</>} />\n            </Routes>\n          </RouterComponent>\n        );\n      }\n\n      return (\n        <RouterComponent>\n          <RouteTracker routeObjects={routeObjects} />\n          <SignInPageWrapper component={SignInPageComponent}>\n            <Routes>\n              <Route path={mountPath} element={<>{children}</>} />\n            </Routes>\n          </SignInPageWrapper>\n        </RouterComponent>\n      );\n    };\n\n    return AppRouter;\n  }\n\n  private getApiHolder(): ApiHolder {\n    if (this.apiHolder) {\n      // Register additional plugins if they have been added.\n      // Routes paths, objects and others are already updated in the provider when children of it change\n      for (const plugin of this.plugins) {\n        for (const factory of plugin.getApis()) {\n          if (!this.apiFactoryRegistry.get(factory.api)) {\n            this.apiFactoryRegistry.register('default', factory);\n          }\n        }\n      }\n      ApiResolver.validateFactories(\n        this.apiFactoryRegistry,\n        this.apiFactoryRegistry.getAllApis(),\n      );\n      return this.apiHolder;\n    }\n    this.apiFactoryRegistry.register('static', {\n      api: appThemeApiRef,\n      deps: {},\n      factory: () => AppThemeSelector.createWithStorage(this.themes),\n    });\n    this.apiFactoryRegistry.register('static', {\n      api: configApiRef,\n      deps: {},\n      factory: () => {\n        if (!this.configApi) {\n          throw new Error(\n            'Tried to access config API before config was loaded',\n          );\n        }\n        return this.configApi;\n      },\n    });\n    this.apiFactoryRegistry.register('static', {\n      api: identityApiRef,\n      deps: {},\n      factory: () => this.appIdentityProxy,\n    });\n\n    // It's possible to replace the feature flag API, but since we must have at least\n    // one implementation we add it here directly instead of through the defaultApis.\n    this.apiFactoryRegistry.register('default', {\n      api: featureFlagsApiRef,\n      deps: {},\n      factory: () => new LocalStorageFeatureFlags(),\n    });\n    for (const factory of this.defaultApis) {\n      this.apiFactoryRegistry.register('default', factory);\n    }\n\n    for (const plugin of this.plugins) {\n      for (const factory of plugin.getApis()) {\n        if (!this.apiFactoryRegistry.register('default', factory)) {\n          throw new Error(\n            `Plugin ${plugin.getId()} tried to register duplicate or forbidden API factory for ${\n              factory.api\n            }`,\n          );\n        }\n      }\n    }\n\n    for (const factory of this.apis) {\n      if (!this.apiFactoryRegistry.register('app', factory)) {\n        throw new Error(\n          `Duplicate or forbidden API factory for ${factory.api} in app`,\n        );\n      }\n    }\n\n    ApiResolver.validateFactories(\n      this.apiFactoryRegistry,\n      this.apiFactoryRegistry.getAllApis(),\n    );\n\n    this.apiHolder = new ApiResolver(this.apiFactoryRegistry);\n    return this.apiHolder;\n  }\n\n  private verifyPlugins(plugins: Iterable<CompatiblePlugin>) {\n    const pluginIds = new Set<string>();\n\n    for (const plugin of plugins) {\n      const id = plugin.getId();\n      if (pluginIds.has(id)) {\n        throw new Error(`Duplicate plugin found '${id}'`);\n      }\n      pluginIds.add(id);\n    }\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AppManager } from './AppManager';\nimport { AppOptions, BackstageApp } from './types';\n\n/**\n * Creates a new Backstage App where the full set of options are required.\n *\n * @public\n * @param options - A set of options for creating the app\n * @returns\n * @remarks\n *\n * You will most likely want to use {@link @backstage/app-defaults#createApp},\n * however, this low-level API allows you to provide a full set of options,\n * including your own `components`, `icons`, `defaultApis`, and `themes`. This\n * is particularly useful if you are not using `@backstage/core-components` or\n * MUI, as it allows you to avoid those dependencies completely.\n */\nexport function createSpecializedApp(options: AppOptions): BackstageApp {\n  return new AppManager(options);\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { ReactNode } from 'react';\nimport { useRoutes } from 'react-router-dom';\nimport { useApp, useElementFilter } from '@backstage/core-plugin-api';\n\ntype RouteObject = {\n  path: string;\n  element: ReactNode;\n  children?: RouteObject[];\n};\n\n/**\n * Props for the {@link FlatRoutes} component.\n *\n * @public\n */\nexport type FlatRoutesProps = {\n  children: ReactNode;\n};\n\n/**\n * A wrapper around a set of routes.\n *\n * @remarks\n *\n * The root of the routing hierarchy in your app should use this component,\n * instead of the one from `react-router-dom`. This ensures that all of the\n * plugin route and utility API wiring happens under the hood.\n *\n * @public\n */\nexport const FlatRoutes = (props: FlatRoutesProps): JSX.Element | null => {\n  const app = useApp();\n  const { NotFoundErrorPage } = app.getComponents();\n  const routes = useElementFilter(props.children, elements =>\n    elements\n      .getElements<{ path?: string; children: ReactNode }>()\n      .flatMap<RouteObject>(child => {\n        let path = child.props.path;\n\n        // TODO(Rugvip): Work around plugins registering empty paths, remove once deprecated routes are gone\n        if (path === '') {\n          return [];\n        }\n        path = path?.replace(/\\/\\*$/, '') ?? '/';\n\n        return [\n          {\n            path,\n            element: child,\n            children: child.props.children\n              ? [\n                  // These are the children of each route, which we all add in under a catch-all\n                  // subroute in order to make them available to `useOutlet`\n                  {\n                    path: path === '/' ? '/' : '/*', // The root path must require an exact match\n                    element: child.props.children,\n                  },\n                ]\n              : undefined,\n          },\n        ];\n      })\n      // Routes are sorted to work around a bug where prefixes are unexpectedly matched\n      .sort((a, b) => b.path.localeCompare(a.path))\n      // We make sure all routes have '/*' appended, except '/'\n      .map(obj => {\n        obj.path = obj.path === '/' ? '/' : `${obj.path}/*`;\n        return obj;\n      }),\n  );\n\n  // TODO(Rugvip): Possibly add a way to skip this, like a noNotFoundPage prop\n  routes.push({\n    element: <NotFoundErrorPage />,\n    path: '/*',\n  });\n\n  return useRoutes(routes);\n};\n"],"names":["hasScopes","DEFAULT_PROVIDER","SCOPE_PREFIX"],"mappings":"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"}