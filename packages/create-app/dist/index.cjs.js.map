{"version":3,"file":"index.cjs.js","sources":["../src/lib/errors.ts","../src/lib/versions.ts","../src/lib/tasks.ts","../src/createApp.ts","../src/index.ts"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport chalk from 'chalk';\n\nexport class CustomError extends Error {\n  get name(): string {\n    return this.constructor.name;\n  }\n}\n\nexport class ExitCodeError extends CustomError {\n  readonly code: number;\n\n  constructor(code: number, command?: string) {\n    if (command) {\n      super(`Command '${command}' exited with code ${code}`);\n    } else {\n      super(`Child exited with code ${code}`);\n    }\n    this.code = code;\n  }\n}\n\nexport function exitWithError(error: Error): never {\n  if (error instanceof ExitCodeError) {\n    process.stderr.write(`\\n${chalk.red(error.message)}\\n\\n`);\n    process.exit(error.code);\n  } else {\n    process.stderr.write(`\\n${chalk.red(`${error}`)}\\n\\n`);\n    process.exit(1);\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable monorepo/no-relative-import */\n\n/*\nThis is a list of all packages used by the template. If dependencies are added or removed,\nthis list should be updated as well.\n\nThe list, and the accompanying peerDependencies entries, are here to ensure correct versioning\nand bumping of this package. Without this list the version would not be bumped unless we\nmanually trigger a release.\n\nThis does not create an actual dependency on these packages and does not bring in any code.\nRelative imports are used rather than package imports to make sure the packages aren't externalized.\nRollup will extract the value of the version field in each package at build time without\nleaving any imports in place.\n*/\n\nimport { version as root } from '../../../../package.json';\n\nimport { version as appDefaults } from '../../../app-defaults/package.json';\nimport { version as backendCommon } from '../../../backend-common/package.json';\nimport { version as backendTasks } from '../../../backend-tasks/package.json';\nimport { version as catalogClient } from '../../../catalog-client/package.json';\nimport { version as catalogModel } from '../../../catalog-model/package.json';\nimport { version as cli } from '../../../cli/package.json';\nimport { version as config } from '../../../config/package.json';\nimport { version as coreAppApi } from '../../../core-app-api/package.json';\nimport { version as coreComponents } from '../../../core-components/package.json';\nimport { version as corePluginApi } from '../../../core-plugin-api/package.json';\nimport { version as errors } from '../../../errors/package.json';\nimport { version as integrationReact } from '../../../integration-react/package.json';\nimport { version as testUtils } from '../../../test-utils/package.json';\nimport { version as theme } from '../../../theme/package.json';\n\nimport { version as pluginApiDocs } from '../../../../plugins/api-docs/package.json';\nimport { version as pluginAppBackend } from '../../../../plugins/app-backend/package.json';\nimport { version as pluginAuthBackend } from '../../../../plugins/auth-backend/package.json';\nimport { version as pluginCatalog } from '../../../../plugins/catalog/package.json';\nimport { version as pluginCatalogCommon } from '../../../../plugins/catalog-common/package.json';\nimport { version as pluginCatalogReact } from '../../../../plugins/catalog-react/package.json';\nimport { version as pluginCatalogBackend } from '../../../../plugins/catalog-backend/package.json';\nimport { version as pluginCatalogGraph } from '../../../../plugins/catalog-graph/package.json';\nimport { version as pluginCatalogImport } from '../../../../plugins/catalog-import/package.json';\nimport { version as pluginCircleci } from '../../../../plugins/circleci/package.json';\nimport { version as pluginExplore } from '../../../../plugins/explore/package.json';\nimport { version as pluginGithubActions } from '../../../../plugins/github-actions/package.json';\nimport { version as pluginLighthouse } from '../../../../plugins/lighthouse/package.json';\nimport { version as pluginOrg } from '../../../../plugins/org/package.json';\nimport { version as pluginPermissionCommon } from '../../../../plugins/permission-common/package.json';\nimport { version as pluginPermissionReact } from '../../../../plugins/permission-react/package.json';\nimport { version as pluginPermissionNode } from '../../../../plugins/permission-node/package.json';\nimport { version as pluginProxyBackend } from '../../../../plugins/proxy-backend/package.json';\nimport { version as pluginRollbarBackend } from '../../../../plugins/rollbar-backend/package.json';\nimport { version as pluginScaffolder } from '../../../../plugins/scaffolder/package.json';\nimport { version as pluginScaffolderBackend } from '../../../../plugins/scaffolder-backend/package.json';\nimport { version as pluginSearch } from '../../../../plugins/search/package.json';\nimport { version as pluginSearchReact } from '../../../../plugins/search-react/package.json';\nimport { version as pluginSearchBackend } from '../../../../plugins/search-backend/package.json';\nimport { version as pluginSearchBackendModulePg } from '../../../../plugins/search-backend-module-pg/package.json';\nimport { version as pluginSearchBackendNode } from '../../../../plugins/search-backend-node/package.json';\nimport { version as pluginTechRadar } from '../../../../plugins/tech-radar/package.json';\nimport { version as pluginTechdocs } from '../../../../plugins/techdocs/package.json';\nimport { version as pluginTechdocsReact } from '../../../../plugins/techdocs-react/package.json';\nimport { version as pluginTechdocsModuleAddonsContrib } from '../../../../plugins/techdocs-module-addons-contrib/package.json';\nimport { version as pluginTechdocsBackend } from '../../../../plugins/techdocs-backend/package.json';\nimport { version as pluginUserSettings } from '../../../../plugins/user-settings/package.json';\n\nexport const packageVersions = {\n  root,\n  '@backstage/app-defaults': appDefaults,\n  '@backstage/backend-common': backendCommon,\n  '@backstage/backend-tasks': backendTasks,\n  '@backstage/catalog-client': catalogClient,\n  '@backstage/catalog-model': catalogModel,\n  '@backstage/cli': cli,\n  '@backstage/config': config,\n  '@backstage/core-app-api': coreAppApi,\n  '@backstage/core-components': coreComponents,\n  '@backstage/core-plugin-api': corePluginApi,\n  '@backstage/errors': errors,\n  '@backstage/integration-react': integrationReact,\n  '@backstage/plugin-api-docs': pluginApiDocs,\n  '@backstage/plugin-app-backend': pluginAppBackend,\n  '@backstage/plugin-auth-backend': pluginAuthBackend,\n  '@backstage/plugin-catalog': pluginCatalog,\n  '@backstage/plugin-catalog-common': pluginCatalogCommon,\n  '@backstage/plugin-catalog-react': pluginCatalogReact,\n  '@backstage/plugin-catalog-backend': pluginCatalogBackend,\n  '@backstage/plugin-catalog-graph': pluginCatalogGraph,\n  '@backstage/plugin-catalog-import': pluginCatalogImport,\n  '@backstage/plugin-circleci': pluginCircleci,\n  '@backstage/plugin-explore': pluginExplore,\n  '@backstage/plugin-github-actions': pluginGithubActions,\n  '@backstage/plugin-lighthouse': pluginLighthouse,\n  '@backstage/plugin-org': pluginOrg,\n  '@backstage/plugin-permission-common': pluginPermissionCommon,\n  '@backstage/plugin-permission-node': pluginPermissionNode,\n  '@backstage/plugin-permission-react': pluginPermissionReact,\n  '@backstage/plugin-proxy-backend': pluginProxyBackend,\n  '@backstage/plugin-rollbar-backend': pluginRollbarBackend,\n  '@backstage/plugin-scaffolder': pluginScaffolder,\n  '@backstage/plugin-scaffolder-backend': pluginScaffolderBackend,\n  '@backstage/plugin-search': pluginSearch,\n  '@backstage/plugin-search-react': pluginSearchReact,\n  '@backstage/plugin-search-backend': pluginSearchBackend,\n  '@backstage/plugin-search-backend-module-pg': pluginSearchBackendModulePg,\n  '@backstage/plugin-search-backend-node': pluginSearchBackendNode,\n  '@backstage/plugin-tech-radar': pluginTechRadar,\n  '@backstage/plugin-techdocs': pluginTechdocs,\n  '@backstage/plugin-techdocs-react': pluginTechdocsReact,\n  '@backstage/plugin-techdocs-module-addons-contrib':\n    pluginTechdocsModuleAddonsContrib,\n  '@backstage/plugin-techdocs-backend': pluginTechdocsBackend,\n  '@backstage/plugin-user-settings': pluginUserSettings,\n  '@backstage/test-utils': testUtils,\n  '@backstage/theme': theme,\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport chalk from 'chalk';\nimport fs from 'fs-extra';\nimport handlebars from 'handlebars';\nimport ora from 'ora';\nimport recursive from 'recursive-readdir';\nimport {\n  basename,\n  dirname,\n  resolve as resolvePath,\n  relative as relativePath,\n} from 'path';\nimport { exec as execCb } from 'child_process';\nimport { packageVersions } from './versions';\nimport { promisify } from 'util';\n\nconst TASK_NAME_MAX_LENGTH = 14;\nconst exec = promisify(execCb);\n\nexport class Task {\n  static log(name: string = '') {\n    process.stdout.write(`${chalk.green(name)}\\n`);\n  }\n\n  static error(message: string = '') {\n    process.stdout.write(`\\n${chalk.red(message)}\\n\\n`);\n  }\n\n  static section(name: string) {\n    const title = chalk.green(`${name}:`);\n    process.stdout.write(`\\n ${title}\\n`);\n  }\n\n  static exit(code: number = 0) {\n    process.exit(code);\n  }\n\n  static async forItem(\n    task: string,\n    item: string,\n    taskFunc: () => Promise<void>,\n  ): Promise<void> {\n    const paddedTask = chalk.green(task.padEnd(TASK_NAME_MAX_LENGTH));\n\n    const spinner = ora({\n      prefixText: chalk.green(`  ${paddedTask}${chalk.cyan(item)}`),\n      spinner: 'arc',\n      color: 'green',\n    }).start();\n\n    try {\n      await taskFunc();\n      spinner.succeed();\n    } catch (error) {\n      spinner.fail();\n      throw error;\n    }\n  }\n}\n\n/**\n * Generate a templated backstage project\n *\n * @param templateDir - location containing template files\n * @param destinationDir - location to save templated project\n * @param context - template parameters\n */\nexport async function templatingTask(\n  templateDir: string,\n  destinationDir: string,\n  context: any,\n) {\n  const files = await recursive(templateDir).catch(error => {\n    throw new Error(`Failed to read template directory: ${error.message}`);\n  });\n\n  for (const file of files) {\n    const destinationFile = resolvePath(\n      destinationDir,\n      relativePath(templateDir, file),\n    );\n    await fs.ensureDir(dirname(destinationFile));\n\n    if (file.endsWith('.hbs')) {\n      await Task.forItem('templating', basename(file), async () => {\n        const destination = destinationFile.replace(/\\.hbs$/, '');\n\n        const template = await fs.readFile(file);\n        const compiled = handlebars.compile(template.toString());\n        const contents = compiled(\n          { name: basename(destination), ...context },\n          {\n            helpers: {\n              version(name: keyof typeof packageVersions) {\n                if (name in packageVersions) {\n                  return packageVersions[name];\n                }\n                throw new Error(`No version available for package ${name}`);\n              },\n            },\n          },\n        );\n\n        await fs.writeFile(destination, contents).catch(error => {\n          throw new Error(\n            `Failed to create file: ${destination}: ${error.message}`,\n          );\n        });\n      });\n    } else {\n      await Task.forItem('copying', basename(file), async () => {\n        await fs.copyFile(file, destinationFile).catch(error => {\n          const destination = destinationFile;\n          throw new Error(\n            `Failed to copy file to ${destination} : ${error.message}`,\n          );\n        });\n      });\n    }\n  }\n}\n\n/**\n * Verify that application target does not already exist\n *\n * @param rootDir - The directory to create application folder `name`\n * @param name - The specified name of the application\n * @Throws Error - If directory with name of `destination` already exists\n */\nexport async function checkAppExistsTask(rootDir: string, name: string) {\n  await Task.forItem('checking', name, async () => {\n    const destination = resolvePath(rootDir, name);\n\n    if (await fs.pathExists(destination)) {\n      const existing = chalk.cyan(destination.replace(`${rootDir}/`, ''));\n      throw new Error(\n        `A directory with the same name already exists: ${existing}\\nPlease try again with a different app name`,\n      );\n    }\n  });\n}\n\n/**\n * Verify that application `path` exists, otherwise create the directory\n *\n * @param path - target to create directory\n * @throws if `path` is a file, or `fs.mkdir` fails\n */\nexport async function checkPathExistsTask(path: string) {\n  await Task.forItem('checking', path, async () => {\n    try {\n      await fs.mkdirs(path);\n    } catch (error) {\n      // will fail if a file already exists at given `path`\n      throw new Error(`Failed to create app directory: ${error.message}`);\n    }\n  });\n}\n\n/**\n * Create a folder to store templated files\n *\n * @param tempDir - target temporary directory\n * @throws if `fs.mkdir` fails\n */\nexport async function createTemporaryAppFolderTask(tempDir: string) {\n  await Task.forItem('creating', 'temporary directory', async () => {\n    try {\n      await fs.mkdir(tempDir);\n    } catch (error) {\n      throw new Error(`Failed to create temporary app directory, ${error}`);\n    }\n  });\n}\n\n/**\n * Run `yarn install` and `run tsc` in application directory\n *\n * @param appDir - location of application to build\n */\nexport async function buildAppTask(appDir: string) {\n  const runCmd = async (cmd: string) => {\n    await Task.forItem('executing', cmd, async () => {\n      process.chdir(appDir);\n      await exec(cmd).catch(error => {\n        process.stdout.write(error.stderr);\n        process.stdout.write(error.stdout);\n        throw new Error(`Could not execute command ${chalk.cyan(cmd)}`);\n      });\n    });\n  };\n\n  await runCmd('yarn install');\n  await runCmd('yarn tsc');\n}\n\n/**\n * Move temporary directory to destination application folder\n *\n * @param tempDir - source path to copy files from\n * @param destination - target path to copy files\n * @param id - item ID\n * @throws if `fs.move` fails\n */\nexport async function moveAppTask(\n  tempDir: string,\n  destination: string,\n  id: string,\n) {\n  await Task.forItem('moving', id, async () => {\n    await fs\n      .move(tempDir, destination)\n      .catch(error => {\n        throw new Error(\n          `Failed to move app from ${tempDir} to ${destination}: ${error.message}`,\n        );\n      })\n      .finally(() => {\n        // remove temporary files on both success and failure\n        fs.removeSync(tempDir);\n      });\n  });\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport chalk from 'chalk';\nimport { OptionValues } from 'commander';\nimport inquirer, { Answers } from 'inquirer';\nimport { resolve as resolvePath } from 'path';\nimport { findPaths } from '@backstage/cli-common';\nimport os from 'os';\nimport {\n  Task,\n  buildAppTask,\n  checkAppExistsTask,\n  checkPathExistsTask,\n  createTemporaryAppFolderTask,\n  moveAppTask,\n  templatingTask,\n} from './lib/tasks';\n\nexport default async (opts: OptionValues): Promise<void> => {\n  /* eslint-disable-next-line no-restricted-syntax */\n  const paths = findPaths(__dirname);\n\n  const answers: Answers = await inquirer.prompt([\n    {\n      type: 'input',\n      name: 'name',\n      message: chalk.blue('Enter a name for the app [required]'),\n      validate: (value: any) => {\n        if (!value) {\n          return chalk.red('Please enter a name for the app');\n        } else if (!/^[a-z0-9]+(-[a-z0-9]+)*$/.test(value)) {\n          return chalk.red(\n            'App name must be lowercase and contain only letters, digits, and dashes.',\n          );\n        }\n        return true;\n      },\n    },\n  ]);\n\n  const templateDir = paths.resolveOwn('templates/default-app');\n  const tempDir = resolvePath(os.tmpdir(), answers.name);\n\n  // Use `--path` argument as application directory when specified, otherwise\n  // create a directory using `answers.name`\n  const appDir = opts.path\n    ? resolvePath(paths.targetDir, opts.path)\n    : resolvePath(paths.targetDir, answers.name);\n\n  Task.log();\n  Task.log('Creating the app...');\n\n  try {\n    if (opts.path) {\n      // Template directly to specified path\n\n      Task.section('Checking that supplied path exists');\n      await checkPathExistsTask(appDir);\n\n      Task.section('Preparing files');\n      await templatingTask(templateDir, opts.path, answers);\n    } else {\n      // Template to temporary location, and then move files\n\n      Task.section('Checking if the directory is available');\n      await checkAppExistsTask(paths.targetDir, answers.name);\n\n      Task.section('Creating a temporary app directory');\n      await createTemporaryAppFolderTask(tempDir);\n\n      Task.section('Preparing files');\n      await templatingTask(templateDir, tempDir, answers);\n\n      Task.section('Moving to final location');\n      await moveAppTask(tempDir, appDir, answers.name);\n    }\n\n    if (!opts.skipInstall) {\n      Task.section('Building the app');\n      await buildAppTask(appDir);\n    }\n\n    Task.log();\n    Task.log(\n      chalk.green(`ðŸ¥‡  Successfully created ${chalk.cyan(answers.name)}`),\n    );\n    Task.log();\n    Task.section('All set! Now you might want to');\n    Task.log(`  Run the app: ${chalk.cyan(`cd ${answers.name} && yarn dev`)}`);\n    Task.log(\n      '  Set up the software catalog: https://backstage.io/docs/features/software-catalog/configuration',\n    );\n    Task.log('  Add authentication: https://backstage.io/docs/auth/');\n    Task.log();\n    Task.exit();\n  } catch (error) {\n    Task.error(String(error));\n\n    Task.log('It seems that something went wrong when creating the app ðŸ¤”');\n\n    Task.error('ðŸ”¥  Failed to create app!');\n    Task.exit(1);\n  }\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * A CLI that helps you create your own Backstage app\n *\n * @packageDocumentation\n */\n\nimport { program } from 'commander';\nimport { exitWithError } from './lib/errors';\nimport { version } from '../../../package.json';\nimport createApp from './createApp';\n\nconst main = (argv: string[]) => {\n  program\n    .name('backstage-create-app')\n    .version(version)\n    .description('Creates a new app in a new directory or specified path')\n    .option(\n      '--path [directory]',\n      'Location to store the app defaulting to a new folder with the app name',\n    )\n    .option(\n      '--skip-install',\n      'Skip the install and builds steps after creating the app',\n    )\n    .action(cmd => createApp(cmd));\n\n  program.parse(argv);\n};\n\nprocess.on('unhandledRejection', rejection => {\n  if (rejection instanceof Error) {\n    exitWithError(rejection);\n  } else {\n    exitWithError(new Error(`Unknown rejection: '${rejection}'`));\n  }\n});\n\nmain(process.argv);\n"],"names":["chalk","root","appDefaults","backendCommon","backendTasks","catalogClient","catalogModel","cli","config","coreAppApi","coreComponents","corePluginApi","errors","integrationReact","pluginApiDocs","pluginAppBackend","pluginAuthBackend","pluginCatalog","pluginCatalogCommon","pluginCatalogReact","pluginCatalogBackend","pluginCatalogGraph","pluginCatalogImport","pluginCircleci","pluginExplore","pluginGithubActions","pluginLighthouse","pluginOrg","pluginPermissionCommon","pluginPermissionNode","pluginPermissionReact","pluginProxyBackend","pluginRollbarBackend","pluginScaffolder","pluginScaffolderBackend","pluginSearch","pluginSearchReact","pluginSearchBackend","pluginSearchBackendModulePg","pluginSearchBackendNode","pluginTechRadar","pluginTechdocs","pluginTechdocsReact","pluginTechdocsModuleAddonsContrib","pluginTechdocsBackend","pluginUserSettings","testUtils","theme","promisify","execCb","ora","recursive","resolvePath","relativePath","fs","dirname","basename","handlebars","findPaths","inquirer","os","program","version"],"mappings":"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"}