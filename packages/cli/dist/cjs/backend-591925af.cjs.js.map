{"version":3,"file":"backend-591925af.cjs.js","sources":["../../src/lib/bundler/backend.ts"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport webpack from 'webpack';\nimport { createBackendConfig } from './config';\nimport { resolveBundlingPaths } from './paths';\nimport { BackendServeOptions } from './types';\n\nexport async function serveBackend(options: BackendServeOptions) {\n  const paths = resolveBundlingPaths(options);\n  const config = await createBackendConfig(paths, {\n    ...options,\n    isDev: true,\n  });\n\n  const compiler = webpack(config, (err: Error | undefined) => {\n    if (err) {\n      console.error(err);\n    } else console.log('Build succeeded');\n  });\n\n  const waitForExit = async () => {\n    for (const signal of ['SIGINT', 'SIGTERM'] as const) {\n      process.on(signal, () => {\n        // exit instead of resolve. The process is shutting down and resolving a promise here logs an error\n        compiler.close(() => process.exit());\n      });\n    }\n\n    // Block indefinitely and wait for the interrupt signal\n    return new Promise(() => {});\n  };\n\n  return waitForExit;\n}\n"],"names":["paths","resolveBundlingPaths","createBackendConfig","webpack"],"mappings":";;;;;;;;;AAGO,eAAe,YAAY,CAAC,OAAO,EAAE;AAC5C,EAAE,MAAMA,OAAK,GAAGC,0BAAoB,CAAC,OAAO,CAAC,CAAC;AAC9C,EAAE,MAAM,MAAM,GAAG,MAAMC,yBAAmB,CAACF,OAAK,EAAE;AAClD,IAAI,GAAG,OAAO;AACd,IAAI,KAAK,EAAE,IAAI;AACf,GAAG,CAAC,CAAC;AACL,EAAE,MAAM,QAAQ,GAAGG,2BAAO,CAAC,MAAM,EAAE,CAAC,GAAG,KAAK;AAC5C,IAAI,IAAI,GAAG,EAAE;AACb,MAAM,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;AACzB,KAAK;AACL,MAAM,OAAO,CAAC,GAAG,CAAC,iBAAiB,CAAC,CAAC;AACrC,GAAG,CAAC,CAAC;AACL,EAAE,MAAM,WAAW,GAAG,YAAY;AAClC,IAAI,KAAK,MAAM,MAAM,IAAI,CAAC,QAAQ,EAAE,SAAS,CAAC,EAAE;AAChD,MAAM,OAAO,CAAC,EAAE,CAAC,MAAM,EAAE,MAAM;AAC/B,QAAQ,QAAQ,CAAC,KAAK,CAAC,MAAM,OAAO,CAAC,IAAI,EAAE,CAAC,CAAC;AAC7C,OAAO,CAAC,CAAC;AACT,KAAK;AACL,IAAI,OAAO,IAAI,OAAO,CAAC,MAAM;AAC7B,KAAK,CAAC,CAAC;AACP,GAAG,CAAC;AACJ,EAAE,OAAO,WAAW,CAAC;AACrB;;;;"}