{"version":3,"file":"install-d962d8ff.cjs.js","sources":["../../src/commands/install/types.ts","../../src/commands/install/steps/appRoute.ts","../../src/commands/install/steps/dependencies.ts","../../src/commands/install/steps/message.ts","../../src/commands/install/install.ts"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { YarnInfoInspectData } from '../../lib/versioning';\nimport { JsonObject } from '@backstage/types';\n\n/**\n * TODO: possible types\n *\n * frontend-deps: Install one or many frontend packages in a Backstage app\n * backend-deps: Install one or many backend packages in a Backstage app\n * app-config: Update app-config.yaml (and ask for inputs). E.g. Use local or docker for techdocs.builder\n * frontend-route: Add a frontend route to the plugin homepage\n * backend-route: Add a backend route to the plugin\n * entity-page-tab: Add a tab on Catalogâ€™s entity page\n * sidebar-item: Add a sidebar item\n * frontend-api: Add a custom API\n */\n\n/** A serialized install step as it appears in JSON */\nexport type SerializedStep = {\n  type: string;\n} & unknown;\n\nexport type InstallationRecipe = {\n  type?: 'frontend' | 'backend';\n  steps: SerializedStep[];\n  peerPluginDependencies: { [pluginId: string]: string };\n};\n\n/** package.json data */\nexport type PackageWithInstallRecipe = YarnInfoInspectData & {\n  version: string;\n  experimentalInstallationRecipe?: InstallationRecipe;\n};\n\nexport type PeerPluginDependencies = Map<\n  string,\n  {\n    pkg: PackageWithInstallRecipe;\n    versionToInstall?: string;\n  }\n>;\n\nexport interface Step {\n  run(): Promise<void>;\n}\n\nexport interface StepDefinition<Options> {\n  /** The string identifying this type of step */\n  type: string;\n\n  /** Deserializes and validate a JSON description of the step data */\n  deserialize(obj: JsonObject, pkg: PackageWithInstallRecipe): Step;\n\n  /** Creates a step using known parameters */\n  create(options: Options): Step;\n}\n\n/** Creates a new step definition. Only used as a helper for type inference */\nexport function createStepDefinition<T>(\n  config: StepDefinition<T>,\n): StepDefinition<T> {\n  return config;\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport fs from 'fs-extra';\nimport { paths } from '../../../lib/paths';\nimport { Step, createStepDefinition } from '../types';\n\ntype Data = {\n  path: string;\n  element: string;\n  packageName: string;\n};\n\nclass AppRouteStep implements Step {\n  constructor(private readonly data: Data) {}\n\n  async run() {\n    const { path, element, packageName } = this.data;\n\n    const appTsxPath = paths.resolveTargetRoot('packages/app/src/App.tsx');\n    const contents = await fs.readFile(appTsxPath, 'utf-8');\n    let failed = false;\n\n    // Add a new route just above the end of the FlatRoutes block\n    const contentsWithRoute = contents.replace(\n      /(\\s*)<\\/FlatRoutes>/,\n      `$1  <Route path=\"${path}\" element={${element}} />$1</FlatRoutes>`,\n    );\n    if (contentsWithRoute === contents) {\n      failed = true;\n    }\n\n    // Grab the component name from the element\n    const componentName = element.match(/[A-Za-z0-9]+/)?.[0];\n    if (!componentName) {\n      throw new Error(`Could not find component name in ${element}`);\n    }\n\n    // Add plugin import\n    // TODO(Rugvip): Attempt to add this among the other plugin imports\n    const contentsWithImport = contentsWithRoute.replace(\n      /^import /m,\n      `import { ${componentName} } from '${packageName}';\\nimport `,\n    );\n    if (contentsWithImport === contentsWithRoute) {\n      failed = true;\n    }\n\n    if (failed) {\n      console.log(\n        'Failed to automatically add a route to package/app/src/App.tsx',\n      );\n      console.log(`Action needed, add the following:`);\n      console.log(`1. import { ${componentName} } from '${packageName}';`);\n      console.log(`2. <Route path=\"${path}\" element={${element}} />`);\n    } else {\n      await fs.writeFile(appTsxPath, contentsWithImport);\n    }\n  }\n}\n\nexport const appRoute = createStepDefinition<Data>({\n  type: 'app-route',\n\n  deserialize(obj, pkg) {\n    const { path, element } = obj;\n    if (!path || typeof path !== 'string') {\n      throw new Error(\"Invalid install step, 'path' must be a string\");\n    }\n    if (!element || typeof element !== 'string') {\n      throw new Error(\"Invalid install step, 'element' must be a string\");\n    }\n    return new AppRouteStep({ path, element, packageName: pkg.name });\n  },\n\n  create(data: Data) {\n    return new AppRouteStep(data);\n  },\n});\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport fs from 'fs-extra';\nimport chalk from 'chalk';\nimport sortBy from 'lodash/sortBy';\nimport groupBy from 'lodash/groupBy';\nimport { paths } from '../../../lib/paths';\nimport { run } from '../../../lib/run';\nimport { Step, createStepDefinition } from '../types';\n\ntype Data = {\n  dependencies: Array<{\n    target: string;\n    type: 'dependencies';\n    name: string;\n    query: string;\n  }>;\n};\n\nclass DependenciesStep implements Step {\n  constructor(private readonly data: Data) {}\n\n  async run() {\n    const { dependencies } = this.data;\n    // yarn --cwd packages/app add\n    const byTarget = groupBy(dependencies, 'target');\n\n    // Go through each target package and install the dependencies.\n    for (const [target, deps] of Object.entries(byTarget)) {\n      const pkgPath = paths.resolveTargetRoot(target, 'package.json');\n      const pkgJson = await fs.readJson(pkgPath);\n\n      // Populate each type of dependency object, dependencies, devDependencies, etc.\n      const depTypes = new Set<string>();\n      for (const dep of deps) {\n        depTypes.add(dep.type);\n        pkgJson[dep.type][dep.name] = dep.query;\n      }\n\n      // Be nice and sort the dependencies alphabetically\n      for (const depType of depTypes) {\n        pkgJson[depType] = Object.fromEntries(\n          sortBy(Object.entries(pkgJson[depType]), ([key]) => key),\n        );\n      }\n      await fs.writeJson(pkgPath, pkgJson, { spaces: 2 });\n    }\n\n    console.log();\n    console.log(\n      `Running ${chalk.blue('yarn install')} to install new versions`,\n    );\n    console.log();\n    await run('yarn', ['install']);\n  }\n}\n\nexport const dependencies = createStepDefinition<Data>({\n  type: 'dependencies',\n\n  deserialize() {\n    throw new Error('The dependency step may not be defined in JSON');\n  },\n\n  create(data: Data) {\n    return new DependenciesStep(data);\n  },\n});\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Step, createStepDefinition } from '../types';\n\ntype Data = {\n  message: string;\n};\n\nclass MessageStep implements Step {\n  constructor(private readonly data: Data) {}\n\n  async run() {\n    console.log(this.data.message);\n  }\n}\n\nexport const message = createStepDefinition<Data>({\n  type: 'message',\n\n  deserialize(obj) {\n    const { message: msg } = obj;\n\n    if (!msg || (typeof msg !== 'string' && !Array.isArray(msg))) {\n      throw new Error(\n        \"Invalid install step, 'message' must be a string or array\",\n      );\n    }\n    return new MessageStep({ message: [msg].flat().join('') });\n  },\n\n  create(data: Data) {\n    return new MessageStep(data);\n  },\n});\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Step,\n  PackageWithInstallRecipe,\n  PeerPluginDependencies,\n} from './types';\nimport { fetchPackageInfo } from '../../lib/versioning';\nimport { NotFoundError } from '../../lib/errors';\nimport * as stepDefinitionMap from './steps';\nimport { OptionValues } from 'commander';\nimport fs from 'fs-extra';\n\nconst stepDefinitions = Object.values(stepDefinitionMap);\n\nasync function fetchPluginPackage(\n  id: string,\n): Promise<PackageWithInstallRecipe> {\n  const searchNames = [`@backstage/plugin-${id}`, `backstage-plugin-${id}`, id];\n\n  for (const name of searchNames) {\n    try {\n      const packageInfo = (await fetchPackageInfo(\n        name,\n      )) as PackageWithInstallRecipe;\n      return packageInfo;\n    } catch (error) {\n      if (error.name !== 'NotFoundError') {\n        throw error;\n      }\n    }\n  }\n\n  throw new NotFoundError(\n    `No matching package found for '${id}', tried ${searchNames.join(', ')}`,\n  );\n}\n\ntype Steps = Array<{\n  type: string;\n  step: Step;\n}>;\n\nclass PluginInstaller {\n  static async resolveSteps(\n    pkg: PackageWithInstallRecipe,\n    versionToInstall?: string,\n  ) {\n    const steps: Steps = [];\n\n    // collectDependencies\n    // TODO: Deps mean the plugin package itself, and any other backstage plugins/packages it depends on, in its installation recipe.\n    const dependencies = [];\n    dependencies.push({\n      target: 'packages/app',\n      type: 'dependencies' as const,\n      name: pkg.name,\n      query: versionToInstall || `^${pkg.version}`,\n    });\n    steps.push({\n      type: 'dependencies',\n      step: stepDefinitionMap.dependencies.create({ dependencies }),\n    });\n\n    for (const step of pkg.experimentalInstallationRecipe?.steps ?? []) {\n      const { type } = step;\n\n      const definition = stepDefinitions.find(d => d.type === type);\n      if (definition) {\n        steps.push({\n          type,\n          step: definition.deserialize(step, pkg),\n        });\n      } else {\n        throw new Error(`Unsupported step type: ${type}`);\n      }\n    }\n\n    return steps;\n  }\n\n  constructor(private readonly steps: Steps) {}\n\n  async run() {\n    for (const { type, step } of this.steps) {\n      // TODO(Rugvip): Add spinners, nicer message about the step.\n      console.log(`Running step ${type}`);\n      await step.run();\n    }\n  }\n}\n\nasync function installPluginAndPeerPlugins(pkg: PackageWithInstallRecipe) {\n  const pluginDeps: PeerPluginDependencies = new Map();\n  pluginDeps.set(pkg.name, { pkg });\n  await loadPeerPluginDeps(pkg, pluginDeps);\n\n  console.log(`Installing ${pkg.name} AND any peer plugin dependencies.`);\n  for (const [_pluginDepName, pluginDep] of pluginDeps.entries()) {\n    const { pkg: pluginDepPkg, versionToInstall } = pluginDep;\n    console.log(\n      `Installing plugin: ${pluginDepPkg.name}: ${\n        versionToInstall || pluginDepPkg.version\n      }`,\n    );\n    const steps = await PluginInstaller.resolveSteps(\n      pluginDepPkg,\n      versionToInstall,\n    );\n    const installer = new PluginInstaller(steps);\n    await installer.run();\n  }\n}\n\nasync function loadPackageJson(\n  plugin: string,\n): Promise<PackageWithInstallRecipe> {\n  if (plugin.endsWith('package.json')) {\n    // Install from local package if pluginId is a package.json file - needs to be absolute path\n    return await fs.readJson(plugin);\n  }\n  return await fetchPluginPackage(plugin);\n}\n\nasync function loadPeerPluginDeps(\n  pkg: PackageWithInstallRecipe,\n  pluginMap: PeerPluginDependencies,\n) {\n  for (const [pluginId, pluginVersion] of Object.entries(\n    pkg.experimentalInstallationRecipe?.peerPluginDependencies ?? {},\n  )) {\n    const depPkg = await loadPackageJson(pluginId);\n    if (!pluginMap.get(depPkg.name)) {\n      pluginMap.set(depPkg.name, {\n        pkg: depPkg,\n        versionToInstall: pluginVersion,\n      });\n      await loadPeerPluginDeps(depPkg, pluginMap);\n    }\n  }\n}\n\nexport default async (pluginId?: string, cmd?: OptionValues) => {\n  const from = pluginId || cmd?.from;\n  // TODO(himanshu): If no plugin id is provided, it should list all plugins available. Maybe in some other command?\n  if (!from) {\n    throw new Error(\n      'Missing both <plugin-id> or a package.json file path in the --from flag.',\n    );\n  }\n  const pkg = await loadPackageJson(from);\n  await installPluginAndPeerPlugins(pkg);\n};\n"],"names":["paths","fs","groupBy","sortBy","chalk","run","fetchPackageInfo","NotFoundError","dependencies","stepDefinitionMap.dependencies"],"mappings":"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"}