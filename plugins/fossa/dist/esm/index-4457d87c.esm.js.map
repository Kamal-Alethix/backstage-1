{"version":3,"file":"index-4457d87c.esm.js","sources":["../../src/components/FossaCard/FossaCard.tsx"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEntity } from '@backstage/plugin-catalog-react';\nimport { Grid, Tooltip } from '@material-ui/core';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { DateTime } from 'luxon';\nimport React, { PropsWithChildren } from 'react';\nimport useAsync from 'react-use/lib/useAsync';\nimport { fossaApiRef } from '../../api';\nimport {\n  FOSSA_PROJECT_NAME_ANNOTATION,\n  getProjectName,\n} from '../getProjectName';\n\nimport {\n  EmptyState,\n  InfoCard,\n  InfoCardVariants,\n  MissingAnnotationEmptyState,\n  Progress,\n  ResponseErrorPanel,\n} from '@backstage/core-components';\n\nimport { useApi } from '@backstage/core-plugin-api';\n\nconst useStyles = makeStyles(theme => ({\n  numberError: {\n    fontSize: '5rem',\n    textAlign: 'center',\n    fontWeight: theme.typography.fontWeightMedium,\n    margin: theme.spacing(2, 0),\n    color: theme.palette.error.main,\n  },\n  numberSuccess: {\n    fontSize: '5rem',\n    textAlign: 'center',\n    fontWeight: theme.typography.fontWeightMedium,\n    margin: theme.spacing(2, 0),\n    color: theme.palette.success.main,\n  },\n  description: {\n    fontSize: '1rem',\n    textAlign: 'center',\n    fontWeight: theme.typography.fontWeightMedium,\n    color: theme.palette.text.secondary,\n  },\n  disabled: {\n    backgroundColor: theme.palette.background.default,\n  },\n  lastAnalyzed: {\n    color: theme.palette.text.secondary,\n    textAlign: 'center',\n  },\n  branch: {\n    textDecoration: 'underline dotted',\n  },\n}));\n\nconst Card = ({\n  children,\n  disabled,\n  projectUrl,\n  variant = 'gridItem',\n}: PropsWithChildren<{\n  disabled?: boolean;\n  projectUrl?: string;\n  variant?: InfoCardVariants;\n}>) => {\n  const classes = useStyles();\n\n  return (\n    <InfoCard\n      title=\"License Findings\"\n      deepLink={\n        projectUrl\n          ? {\n              title: 'View more',\n              link: projectUrl,\n            }\n          : undefined\n      }\n      variant={variant}\n      className={disabled ? classes.disabled : undefined}\n    >\n      {children}\n    </InfoCard>\n  );\n};\nexport const FossaCard = ({ variant }: { variant?: InfoCardVariants }) => {\n  const { entity } = useEntity();\n  const fossaApi = useApi(fossaApiRef);\n\n  const projectTitle = getProjectName(entity);\n  const { value, loading, error } = useAsync(\n    async () =>\n      projectTitle ? fossaApi.getFindingSummary(projectTitle) : undefined,\n    [fossaApi, projectTitle],\n  );\n\n  const classes = useStyles();\n\n  if (error) {\n    return (\n      <Card disabled variant={variant}>\n        <ResponseErrorPanel error={error} />\n      </Card>\n    );\n  }\n\n  if (loading) {\n    return (\n      <Card disabled variant={variant}>\n        <Progress />\n      </Card>\n    );\n  }\n\n  if (!projectTitle) {\n    return (\n      <Card disabled variant={variant}>\n        <MissingAnnotationEmptyState\n          annotation={FOSSA_PROJECT_NAME_ANNOTATION}\n        />\n      </Card>\n    );\n  }\n\n  if (!value) {\n    return (\n      <Card disabled variant={variant}>\n        <EmptyState\n          missing=\"info\"\n          title=\"No information to display\"\n          description={`There is no Fossa project with title '${projectTitle}'.`}\n        />\n      </Card>\n    );\n  }\n\n  return (\n    <Card projectUrl={value.projectUrl} variant={variant}>\n      <Grid\n        item\n        container\n        direction=\"column\"\n        justifyContent=\"space-between\"\n        alignItems=\"center\"\n        style={{ height: '100%' }}\n        spacing={0}\n      >\n        <Grid item>\n          <p\n            className={\n              value.issueCount > 0 || value.dependencyCount === 0\n                ? classes.numberError\n                : classes.numberSuccess\n            }\n          >\n            {value.issueCount}\n          </p>\n          {value.dependencyCount > 0 && (\n            <p className={classes.description}>Number of issues</p>\n          )}\n          {value.dependencyCount === 0 && (\n            <p className={classes.description}>\n              No Dependencies.\n              <br />\n              Please check your FOSSA project settings.\n            </p>\n          )}\n        </Grid>\n\n        <Grid item className={classes.lastAnalyzed}>\n          Last analyzed on{' '}\n          {DateTime.fromISO(value.timestamp).toLocaleString(\n            DateTime.DATETIME_MED,\n          )}\n        </Grid>\n        <Grid item className={classes.lastAnalyzed}>\n          Based on {value.dependencyCount} Dependencies on branch{' '}\n          <Tooltip title=\"The default branch can be changed by a FOSSA admin.\">\n            <span className={classes.branch}>{value.projectDefaultBranch}</span>\n          </Tooltip>\n          .\n        </Grid>\n      </Grid>\n    </Card>\n  );\n};\n"],"names":["React"],"mappings":"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"}