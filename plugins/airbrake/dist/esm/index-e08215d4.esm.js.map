{"version":3,"file":"index-e08215d4.esm.js","sources":["../../src/components/useProjectId.ts","../../src/components/EntityAirbrakeWidget/EntityAirbrakeWidget.tsx"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity } from '@backstage/catalog-model';\n\nexport const AIRBRAKE_PROJECT_ID_ANNOTATION = 'airbrake.io/project-id';\n\nexport const useProjectId = (entity: Entity) => {\n  return entity?.metadata.annotations?.[AIRBRAKE_PROJECT_ID_ANNOTATION] ?? '';\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Entity } from '@backstage/catalog-model';\nimport React from 'react';\nimport { Grid, Typography } from '@material-ui/core';\nimport {\n  EmptyState,\n  ErrorPanel,\n  InfoCard,\n  MissingAnnotationEmptyState,\n  Progress,\n} from '@backstage/core-components';\nimport hash from 'object-hash';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { BackstageTheme } from '@backstage/theme';\nimport { useApi } from '@backstage/core-plugin-api';\nimport { airbrakeApiRef } from '../../api';\nimport useAsync from 'react-use/lib/useAsync';\nimport { AIRBRAKE_PROJECT_ID_ANNOTATION, useProjectId } from '../useProjectId';\n\nconst useStyles = makeStyles<BackstageTheme>(() => ({\n  multilineText: {\n    whiteSpace: 'pre-wrap',\n  },\n}));\n\nexport const EntityAirbrakeWidget = ({ entity }: { entity: Entity }) => {\n  const classes = useStyles();\n\n  const projectId = useProjectId(entity);\n  const airbrakeApi = useApi(airbrakeApiRef);\n\n  const { loading, value, error } = useAsync(() => {\n    if (!projectId) {\n      return Promise.resolve(undefined);\n    }\n\n    return airbrakeApi.fetchGroups(projectId);\n  }, [airbrakeApi, projectId]);\n\n  if (!projectId) {\n    return (\n      <MissingAnnotationEmptyState\n        annotation={AIRBRAKE_PROJECT_ID_ANNOTATION}\n      />\n    );\n  } else if (loading) {\n    return <Progress />;\n  } else if (value) {\n    return (\n      <Grid container spacing={3} direction=\"column\">\n        {value.groups?.map(group => (\n          <Grid item key={group.id}>\n            {group.errors?.map(groupError => (\n              <InfoCard title={groupError.type} key={hash(groupError)}>\n                <Typography variant=\"body1\" className={classes.multilineText}>\n                  {groupError.message}\n                </Typography>\n              </InfoCard>\n            ))}\n          </Grid>\n        ))}\n      </Grid>\n    );\n  }\n\n  return (\n    <>\n      {error && <ErrorPanel error={error} />}\n      <EmptyState\n        missing=\"info\"\n        title=\"No information to display\"\n        description={`There is no Airbrake project with id '${projectId}' or there was an issue communicating with Airbrake.`}\n      />\n    </>\n  );\n};\n"],"names":[],"mappings":"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"}