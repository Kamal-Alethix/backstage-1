{"version":3,"file":"GroupsExplorerContent-30bb46c1.esm.js","sources":["../../src/components/GroupsExplorerContent/GroupsDiagram.tsx","../../src/components/GroupsExplorerContent/GroupsExplorerContent.tsx"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  GroupEntity,\n  parseEntityRef,\n  RELATION_CHILD_OF,\n  stringifyEntityRef,\n} from '@backstage/catalog-model';\nimport {\n  DependencyGraph,\n  DependencyGraphTypes,\n  Link,\n  Progress,\n  ResponseErrorPanel,\n} from '@backstage/core-components';\nimport { configApiRef, useApi, useRouteRef } from '@backstage/core-plugin-api';\nimport {\n  catalogApiRef,\n  entityRouteRef,\n  humanizeEntityRef,\n  getEntityRelations,\n} from '@backstage/plugin-catalog-react';\nimport { BackstageTheme } from '@backstage/theme';\nimport { makeStyles, Typography, useTheme } from '@material-ui/core';\nimport ZoomOutMap from '@material-ui/icons/ZoomOutMap';\nimport classNames from 'classnames';\nimport React from 'react';\nimport useAsync from 'react-use/lib/useAsync';\n\nconst useStyles = makeStyles((theme: BackstageTheme) => ({\n  graph: {\n    flex: 1,\n    minHeight: 0,\n  },\n  organizationNode: {\n    fill: theme.palette.secondary.light,\n    stroke: theme.palette.secondary.light,\n  },\n  groupNode: {\n    fill: theme.palette.primary.light,\n    stroke: theme.palette.primary.light,\n  },\n  centeredContent: {\n    padding: theme.spacing(1),\n    height: '100%',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    color: 'black',\n  },\n  textOrganization: {\n    color: theme.palette.secondary.contrastText,\n  },\n  textGroup: {\n    color: theme.palette.primary.contrastText,\n  },\n  textWrapper: {\n    display: '-webkit-box',\n    WebkitBoxOrient: 'vertical',\n    WebkitLineClamp: 2,\n    overflow: 'hidden',\n    textOverflow: 'ellipsis',\n    textAlign: 'center',\n    fontWeight: 'bold',\n    fontSize: '20px',\n  },\n}));\n\nfunction RenderNode(props: DependencyGraphTypes.RenderNodeProps<any>) {\n  const nodeWidth = 180;\n  const nodeHeight = 60;\n  const theme = useTheme();\n  const classes = useStyles();\n  const catalogEntityRoute = useRouteRef(entityRouteRef);\n\n  if (props.node.id === 'root') {\n    return (\n      <g>\n        <rect\n          width={nodeWidth}\n          height={nodeHeight}\n          rx={theme.shape.borderRadius}\n          className={classes.organizationNode}\n        />\n        <title>{props.node.name}</title>\n        <foreignObject width={nodeWidth} height={nodeHeight}>\n          <div className={classes.centeredContent}>\n            <div\n              className={classNames(\n                classes.textWrapper,\n                classes.textOrganization,\n              )}\n            >\n              {props.node.name}\n            </div>\n          </div>\n        </foreignObject>\n      </g>\n    );\n  }\n\n  const ref = parseEntityRef(props.node.id);\n\n  return (\n    <g>\n      <rect\n        width={nodeWidth}\n        height={nodeHeight}\n        rx={theme.shape.borderRadius}\n        className={classes.groupNode}\n      />\n      <title>{props.node.name}</title>\n\n      <Link\n        to={catalogEntityRoute({\n          kind: ref.kind,\n          namespace: ref.namespace,\n          name: ref.name,\n        })}\n      >\n        <foreignObject width={nodeWidth} height={nodeHeight}>\n          <div className={classes.centeredContent}>\n            <div className={classNames(classes.textWrapper, classes.textGroup)}>\n              {props.node.name}\n            </div>\n          </div>\n        </foreignObject>\n      </Link>\n    </g>\n  );\n}\n\n/**\n * Dynamically generates a diagram of groups registered in the catalog.\n */\nexport function GroupsDiagram() {\n  const nodes = new Array<{\n    id: string;\n    kind: string;\n    name: string;\n  }>();\n  const edges = new Array<{ from: string; to: string; label: string }>();\n\n  const classes = useStyles();\n  const configApi = useApi(configApiRef);\n  const catalogApi = useApi(catalogApiRef);\n  const organizationName =\n    configApi.getOptionalString('organization.name') ?? 'Backstage';\n  const {\n    loading,\n    error,\n    value: catalogResponse,\n  } = useAsync(() => {\n    return catalogApi.getEntities({\n      filter: {\n        kind: ['Group'],\n      },\n    });\n  }, [catalogApi]);\n\n  if (loading) {\n    return <Progress />;\n  } else if (error) {\n    return <ResponseErrorPanel error={error} />;\n  }\n\n  // the root of this diagram is the organization\n  nodes.push({\n    id: 'root',\n    kind: 'Organization',\n    name: organizationName,\n  });\n\n  for (const catalogItem of catalogResponse?.items || []) {\n    const currentItemId = stringifyEntityRef(catalogItem);\n\n    nodes.push({\n      id: stringifyEntityRef(catalogItem),\n      kind: catalogItem.kind,\n      name:\n        (catalogItem as GroupEntity).spec?.profile?.displayName ||\n        humanizeEntityRef(catalogItem, { defaultKind: 'Group' }),\n    });\n\n    // Edge to parent\n    const catalogItemRelations_childOf = getEntityRelations(\n      catalogItem,\n      RELATION_CHILD_OF,\n    );\n\n    // if no parent is found, link the node to the root\n    if (catalogItemRelations_childOf.length === 0) {\n      edges.push({\n        from: currentItemId,\n        to: 'root',\n        label: '',\n      });\n    }\n\n    catalogItemRelations_childOf.forEach(relation => {\n      edges.push({\n        from: currentItemId,\n        to: stringifyEntityRef(relation),\n        label: '',\n      });\n    });\n  }\n\n  return (\n    <>\n      <DependencyGraph\n        nodes={nodes}\n        edges={edges}\n        nodeMargin={10}\n        direction={DependencyGraphTypes.Direction.RIGHT_LEFT}\n        renderNode={RenderNode}\n        className={classes.graph}\n      />\n      <Typography\n        variant=\"caption\"\n        style={{ display: 'block', textAlign: 'right' }}\n      >\n        <ZoomOutMap style={{ verticalAlign: 'bottom' }} /> Use pinch &amp; zoom\n        to move around the diagram.\n      </Typography>\n    </>\n  );\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport { GroupsDiagram } from './GroupsDiagram';\nimport {\n  Content,\n  ContentHeader,\n  SupportButton,\n} from '@backstage/core-components';\nimport { makeStyles } from '@material-ui/core/styles';\n\nconst useStyles = makeStyles({\n  root: {\n    height: '100%',\n    maxHeight: '100%',\n    minHeight: 0,\n  },\n});\n\ntype GroupsExplorerContentProps = {\n  title?: string;\n};\n\nexport const GroupsExplorerContent = ({\n  title,\n}: GroupsExplorerContentProps) => {\n  const classes = useStyles();\n\n  return (\n    <Content noPadding stretch className={classes.root}>\n      <ContentHeader title={title ?? 'Groups'}>\n        <SupportButton>Explore your groups.</SupportButton>\n      </ContentHeader>\n\n      <GroupsDiagram />\n    </Content>\n  );\n};\n"],"names":["useStyles","makeStyles"],"mappings":"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"}