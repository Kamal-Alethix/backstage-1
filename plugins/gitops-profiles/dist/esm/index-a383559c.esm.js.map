{"version":3,"file":"index-a383559c.esm.js","sources":["../../src/components/ClusterTable/ClusterTable.tsx","../../src/components/ClusterList/ClusterList.tsx"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react';\nimport { ClusterStatus } from '../../api';\nimport { transformStatus } from '../ProfileCatalog/ProfileCatalog';\nimport { Link, Table, TableColumn } from '@backstage/core-components';\n\nconst columns: TableColumn[] = [\n  {\n    title: 'Cluster Name',\n    field: 'name',\n    highlight: true,\n    render: (componentData: any) => (\n      <Link to={`/gitops-cluster/${encodeURIComponent(componentData.name)}`}>\n        {componentData.name}\n      </Link>\n    ),\n  },\n  {\n    title: 'Status',\n    field: 'status',\n    render: (componentData: any) => (\n      <>\n        {transformStatus({\n          status: componentData.status,\n          conclusion: componentData.conclusion,\n          message: componentData.status,\n        })}\n      </>\n    ),\n  },\n  {\n    title: 'Conclusion',\n    field: 'Conclusion',\n    render: (componentData: any) => (\n      <>\n        {transformStatus({\n          status: componentData.status,\n          conclusion: componentData.conclusion,\n          message: componentData.conclusion,\n        })}\n      </>\n    ),\n  },\n];\n\ntype ClusterTableProps = {\n  components: ClusterStatus[];\n};\nconst ClusterTable = ({ components }: ClusterTableProps) => {\n  return (\n    <Table columns={columns} options={{ paging: false }} data={components} />\n  );\n};\nexport default ClusterTable;\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useState } from 'react';\n\nimport ClusterTable from '../ClusterTable/ClusterTable';\nimport { Button } from '@material-ui/core';\nimport useAsync from 'react-use/lib/useAsync';\nimport { gitOpsApiRef } from '../../api';\nimport { Alert } from '@material-ui/lab';\n\nimport {\n  Content,\n  ContentHeader,\n  Header,\n  SupportButton,\n  Page,\n  Progress,\n  HeaderLabel,\n} from '@backstage/core-components';\nimport { useApi, githubAuthApiRef } from '@backstage/core-plugin-api';\n\nconst ClusterList = () => {\n  const api = useApi(gitOpsApiRef);\n  const githubAuth = useApi(githubAuthApiRef);\n  const [githubUsername, setGithubUsername] = useState(String);\n\n  const { loading, error, value } = useAsync(async () => {\n    const accessToken = await githubAuth.getAccessToken(['repo', 'user']);\n    if (!githubUsername) {\n      const userInfo = await api.fetchUserInfo({ accessToken });\n      setGithubUsername(userInfo.login);\n    }\n    return api.listClusters({\n      gitHubToken: accessToken,\n      gitHubUser: githubUsername,\n    });\n  });\n  let content: JSX.Element;\n  if (loading) {\n    content = (\n      <Content>\n        <Progress />\n      </Content>\n    );\n  } else if (error) {\n    content = (\n      <Content>\n        <div>\n          <Alert severity=\"error\">\n            Error encountered while fetching list of GitOps-managed cluster.{' '}\n            {error.toString()}\n          </Alert>\n          <Alert severity=\"info\">\n            Please make sure that you start GitOps-API backend on localhost port\n            3008 before using this plugin.\n          </Alert>\n        </div>\n      </Content>\n    );\n  } else {\n    content = (\n      <Content>\n        <ContentHeader title=\"Clusters\">\n          <Button\n            variant=\"contained\"\n            color=\"primary\"\n            href=\"/gitops-cluster-create\"\n          >\n            Create GitOps-managed Cluster\n          </Button>\n          <SupportButton>All clusters</SupportButton>\n        </ContentHeader>\n        <ClusterTable components={value!.result} />\n      </Content>\n    );\n  }\n\n  return (\n    <Page themeId=\"home\">\n      <Header title=\"GitOps-managed Clusters\">\n        <HeaderLabel label=\"Welcome\" value={githubUsername} />\n      </Header>\n      {content}\n    </Page>\n  );\n};\n\nexport default ClusterList;\n"],"names":[],"mappings":"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"}