{"version":3,"file":"index.esm.js","sources":["../src/api/client.ts","../src/api/types.ts","../src/routes.ts","../src/plugin.ts"],"sourcesContent":["/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { OAuthApi, createApiRef, FetchApi } from '@backstage/core-plugin-api';\n\nimport { GCalendarEvent, GCalendarList } from './types';\nimport { ResponseError } from '@backstage/errors';\n\ntype Options = {\n  authApi: OAuthApi;\n  fetchApi: FetchApi;\n};\n\nexport const gcalendarApiRef = createApiRef<GCalendarApiClient>({\n  id: 'plugin.gcalendar.service',\n});\n\nexport class GCalendarApiClient {\n  private readonly authApi: OAuthApi;\n  private readonly fetchApi: FetchApi;\n\n  constructor(options: Options) {\n    this.authApi = options.authApi;\n    this.fetchApi = options.fetchApi;\n  }\n\n  private async get<T>(\n    path: string,\n    params: { [key in string]: any },\n  ): Promise<T> {\n    const query = new URLSearchParams(params);\n    const url = new URL(\n      `${path}?${query.toString()}`,\n      'https://www.googleapis.com',\n    );\n    const token = await this.authApi.getAccessToken();\n    const response = await this.fetchApi.fetch(url.toString(), {\n      headers: token ? { Authorization: `Bearer ${token}` } : {},\n    });\n\n    if (!response.ok) {\n      throw await ResponseError.fromResponse(response);\n    }\n\n    return response.json() as Promise<T>;\n  }\n\n  public async getCalendars(params?: any) {\n    return this.get<GCalendarList>(\n      '/calendar/v3/users/me/calendarList',\n      params,\n    );\n  }\n\n  public async getEvents(calendarId: string, params?: any) {\n    return this.get<{ items: GCalendarEvent[] }>(\n      `/calendar/v3/calendars/${encodeURIComponent(calendarId)}/events`,\n      params,\n    );\n  }\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/// <reference types=\"@maxim_mazurok/gapi.client.calendar\" />\n\nexport type GCalendarList = gapi.client.calendar.CalendarList;\n\nexport type GCalendar = gapi.client.calendar.CalendarListEntry;\n\nexport type EventAttendee = gapi.client.calendar.EventAttendee;\n\nexport type GCalendarEvent = gapi.client.calendar.Event &\n  Pick<GCalendar, 'backgroundColor' | 'primary'> &\n  Pick<EventAttendee, 'responseStatus'> & {\n    calendarId?: string;\n  };\n\nexport enum ResponseStatus {\n  needsAction = 'needsAction',\n  accepted = 'accepted',\n  declined = 'declined',\n  maybe = 'tentative',\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { createRouteRef } from '@backstage/core-plugin-api';\n\nexport const rootRouteRef = createRouteRef({\n  id: 'gcalendar',\n});\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {\n  createApiFactory,\n  createComponentExtension,\n  createPlugin,\n  fetchApiRef,\n  googleAuthApiRef,\n} from '@backstage/core-plugin-api';\n\nimport { GCalendarApiClient, gcalendarApiRef } from './api';\nimport { rootRouteRef } from './routes';\n\nexport const gcalendarPlugin = createPlugin({\n  id: 'gcalendar',\n  routes: {\n    root: rootRouteRef,\n  },\n  apis: [\n    createApiFactory({\n      api: gcalendarApiRef,\n      deps: { authApi: googleAuthApiRef, fetchApi: fetchApiRef },\n      factory(deps) {\n        return new GCalendarApiClient(deps);\n      },\n    }),\n  ],\n});\n\nexport const HomePageCalendar = gcalendarPlugin.provide(\n  createComponentExtension({\n    name: 'HomePageCalendar',\n    component: {\n      lazy: () =>\n        import('./components/CalendarCard').then(m => m.HomePageCalendar),\n    },\n  }),\n);\n"],"names":[],"mappings":"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"}