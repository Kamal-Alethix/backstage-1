{"version":3,"file":"index-d686cb1a.esm.js","sources":["../../src/api/BadgesClient.ts","../../src/api/types.ts","../../src/plugin.ts"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { generatePath } from 'react-router';\nimport { ResponseError } from '@backstage/errors';\nimport { Entity, DEFAULT_NAMESPACE } from '@backstage/catalog-model';\nimport { BadgesApi, BadgeSpec } from './types';\nimport { DiscoveryApi, IdentityApi } from '@backstage/core-plugin-api';\n\nexport class BadgesClient implements BadgesApi {\n  private readonly discoveryApi: DiscoveryApi;\n  private readonly identityApi: IdentityApi;\n\n  constructor(options: {\n    discoveryApi: DiscoveryApi;\n    identityApi: IdentityApi;\n  }) {\n    this.discoveryApi = options.discoveryApi;\n    this.identityApi = options.identityApi;\n  }\n\n  public async getEntityBadgeSpecs(entity: Entity): Promise<BadgeSpec[]> {\n    const entityBadgeSpecsUrl = await this.getEntityBadgeSpecsUrl(entity);\n    const { token } = await this.identityApi.getCredentials();\n    const response = await fetch(entityBadgeSpecsUrl, {\n      headers: token\n        ? {\n            Authorization: `Bearer ${token}`,\n          }\n        : undefined,\n    });\n\n    if (!response.ok) {\n      throw await ResponseError.fromResponse(response);\n    }\n\n    return await response.json();\n  }\n\n  private async getEntityBadgeSpecsUrl(entity: Entity): Promise<string> {\n    const routeParams = this.getEntityRouteParams(entity);\n    const path = generatePath(`:namespace/:kind/:name`, routeParams);\n    return `${await this.discoveryApi.getBaseUrl(\n      'badges',\n    )}/entity/${path}/badge-specs`;\n  }\n\n  private getEntityRouteParams(entity: Entity) {\n    return {\n      kind: entity.kind.toLocaleLowerCase('en-US'),\n      namespace:\n        entity.metadata.namespace?.toLocaleLowerCase('en-US') ??\n        DEFAULT_NAMESPACE,\n      name: entity.metadata.name,\n    };\n  }\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity } from '@backstage/catalog-model';\nimport { createApiRef } from '@backstage/core-plugin-api';\n\nexport const badgesApiRef = createApiRef<BadgesApi>({\n  id: 'plugin.badges.client',\n});\n\nexport type BadgeStyle =\n  | 'plastic'\n  | 'flat'\n  | 'flat-square'\n  | 'for-the-badge'\n  | 'social';\n\ninterface Badge {\n  color?: string;\n  description?: string;\n  kind?: 'entity';\n  label: string;\n  labelColor?: string;\n  link?: string;\n  message: string;\n  style?: BadgeStyle;\n}\n\nexport interface BadgeSpec {\n  /** Badge id */\n  id: string;\n\n  /** Badge data */\n  badge: Badge;\n\n  /** The URL to the badge image */\n  url: string;\n\n  /** The markdown code to use the badge */\n  markdown: string;\n}\n\nexport interface BadgesApi {\n  getEntityBadgeSpecs(entity: Entity): Promise<BadgeSpec[]>;\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { badgesApiRef, BadgesClient } from './api';\nimport {\n  createApiFactory,\n  createComponentExtension,\n  createPlugin,\n  discoveryApiRef,\n  identityApiRef,\n} from '@backstage/core-plugin-api';\n\nexport const badgesPlugin = createPlugin({\n  id: 'badges',\n  apis: [\n    createApiFactory({\n      api: badgesApiRef,\n      deps: { discoveryApi: discoveryApiRef, identityApi: identityApiRef },\n      factory: ({ discoveryApi, identityApi }) =>\n        new BadgesClient({ discoveryApi, identityApi }),\n    }),\n  ],\n});\n\nexport const EntityBadgesDialog = badgesPlugin.provide(\n  createComponentExtension({\n    name: 'EntityBadgesDialog',\n    component: {\n      lazy: () =>\n        import('./components/EntityBadgesDialog').then(\n          m => m.EntityBadgesDialog,\n        ),\n    },\n  }),\n);\n"],"names":[],"mappings":"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"}