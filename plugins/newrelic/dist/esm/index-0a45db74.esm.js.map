{"version":3,"file":"index-0a45db74.esm.js","sources":["../../src/api/index.ts","../../src/plugin.ts"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createApiRef, DiscoveryApi } from '@backstage/core-plugin-api';\n\nexport type NewRelicApplication = {\n  id: number;\n  application_summary: NewRelicApplicationSummary;\n  name: string;\n  language: string;\n  health_status: string;\n  reporting: boolean;\n  settings: NewRelicApplicationSettings;\n  links?: NewRelicApplicationLinks;\n};\n\nexport type NewRelicApplicationSummary = {\n  apdex_score: number;\n  error_rate: number;\n  host_count: number;\n  instance_count: number;\n  response_time: number;\n  throughput: number;\n};\n\nexport type NewRelicApplicationSettings = {\n  app_apdex_threshold: number;\n  end_user_apdex_threshold: number;\n  enable_real_user_monitoring: boolean;\n  use_server_side_config: boolean;\n};\n\nexport type NewRelicApplicationLinks = {\n  application_instances: Array<any>;\n  servers: Array<any>;\n  application_hosts: Array<any>;\n};\n\nexport type NewRelicApplications = {\n  applications: NewRelicApplication[];\n};\n\nexport const newRelicApiRef = createApiRef<NewRelicApi>({\n  id: 'plugin.newrelic.service',\n});\n\nconst DEFAULT_PROXY_PATH_BASE = '/newrelic';\n\ntype Options = {\n  discoveryApi: DiscoveryApi;\n  /**\n   * Path to use for requests via the proxy, defaults to /newrelic\n   */\n  proxyPathBase?: string;\n};\n\nexport interface NewRelicApi {\n  getApplications(): Promise<NewRelicApplications>;\n}\n\nexport class NewRelicClient implements NewRelicApi {\n  private readonly discoveryApi: DiscoveryApi;\n  private readonly proxyPathBase: string;\n\n  constructor(options: Options) {\n    this.discoveryApi = options.discoveryApi;\n    this.proxyPathBase = options.proxyPathBase ?? DEFAULT_PROXY_PATH_BASE;\n  }\n\n  async getApplications(): Promise<NewRelicApplications> {\n    const url = await this.getApiUrl('apm', 'applications.json');\n    const response = await fetch(url);\n    let responseJson;\n\n    try {\n      responseJson = await response.json();\n    } catch (e) {\n      responseJson = { applications: [] };\n    }\n\n    if (response.status !== 200) {\n      throw new Error(\n        `Error communicating with New Relic: ${\n          responseJson?.error?.title || response.statusText\n        }`,\n      );\n    }\n\n    return responseJson;\n  }\n\n  private async getApiUrl(product: string, path: string) {\n    const proxyUrl = await this.discoveryApi.getBaseUrl('proxy');\n    return `${proxyUrl}${this.proxyPathBase}/${product}/api/${path}`;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { NewRelicClient, newRelicApiRef } from './api';\nimport {\n  createApiFactory,\n  createPlugin,\n  createRouteRef,\n  discoveryApiRef,\n  createRoutableExtension,\n} from '@backstage/core-plugin-api';\n\nexport const rootRouteRef = createRouteRef({\n  id: 'newrelic',\n});\n\nexport const newRelicPlugin = createPlugin({\n  id: 'newrelic',\n  apis: [\n    createApiFactory({\n      api: newRelicApiRef,\n      deps: { discoveryApi: discoveryApiRef },\n      factory: ({ discoveryApi }) => new NewRelicClient({ discoveryApi }),\n    }),\n  ],\n  routes: {\n    root: rootRouteRef,\n  },\n});\n\nexport const NewRelicPage = newRelicPlugin.provide(\n  createRoutableExtension({\n    name: 'NewRelicPage',\n    component: () =>\n      import('./components/NewRelicComponent').then(m => m.default),\n    mountPoint: rootRouteRef,\n  }),\n);\n"],"names":[],"mappings":";;AACY,MAAC,cAAc,GAAG,YAAY,CAAC;AAC3C,EAAE,EAAE,EAAE,yBAAyB;AAC/B,CAAC,EAAE;AACH,MAAM,uBAAuB,GAAG,WAAW,CAAC;AACrC,MAAM,cAAc,CAAC;AAC5B,EAAE,WAAW,CAAC,OAAO,EAAE;AACvB,IAAI,IAAI,EAAE,CAAC;AACX,IAAI,IAAI,CAAC,YAAY,GAAG,OAAO,CAAC,YAAY,CAAC;AAC7C,IAAI,IAAI,CAAC,aAAa,GAAG,CAAC,EAAE,GAAG,OAAO,CAAC,aAAa,KAAK,IAAI,GAAG,EAAE,GAAG,uBAAuB,CAAC;AAC7F,GAAG;AACH,EAAE,MAAM,eAAe,GAAG;AAC1B,IAAI,IAAI,EAAE,CAAC;AACX,IAAI,MAAM,GAAG,GAAG,MAAM,IAAI,CAAC,SAAS,CAAC,KAAK,EAAE,mBAAmB,CAAC,CAAC;AACjE,IAAI,MAAM,QAAQ,GAAG,MAAM,KAAK,CAAC,GAAG,CAAC,CAAC;AACtC,IAAI,IAAI,YAAY,CAAC;AACrB,IAAI,IAAI;AACR,MAAM,YAAY,GAAG,MAAM,QAAQ,CAAC,IAAI,EAAE,CAAC;AAC3C,KAAK,CAAC,OAAO,CAAC,EAAE;AAChB,MAAM,YAAY,GAAG,EAAE,YAAY,EAAE,EAAE,EAAE,CAAC;AAC1C,KAAK;AACL,IAAI,IAAI,QAAQ,CAAC,MAAM,KAAK,GAAG,EAAE;AACjC,MAAM,MAAM,IAAI,KAAK,CAAC,CAAC,oCAAoC,EAAE,CAAC,CAAC,EAAE,GAAG,YAAY,IAAI,IAAI,GAAG,KAAK,CAAC,GAAG,YAAY,CAAC,KAAK,KAAK,IAAI,GAAG,KAAK,CAAC,GAAG,EAAE,CAAC,KAAK,KAAK,QAAQ,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;AAC/K,KAAK;AACL,IAAI,OAAO,YAAY,CAAC;AACxB,GAAG;AACH,EAAE,MAAM,SAAS,CAAC,OAAO,EAAE,IAAI,EAAE;AACjC,IAAI,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,YAAY,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;AACjE,IAAI,OAAO,CAAC,EAAE,QAAQ,CAAC,EAAE,IAAI,CAAC,aAAa,CAAC,CAAC,EAAE,OAAO,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC,CAAC;AACrE,GAAG;AACH;;ACtBO,MAAM,YAAY,GAAG,cAAc,CAAC;AAC3C,EAAE,EAAE,EAAE,UAAU;AAChB,CAAC,CAAC,CAAC;AACS,MAAC,cAAc,GAAG,YAAY,CAAC;AAC3C,EAAE,EAAE,EAAE,UAAU;AAChB,EAAE,IAAI,EAAE;AACR,IAAI,gBAAgB,CAAC;AACrB,MAAM,GAAG,EAAE,cAAc;AACzB,MAAM,IAAI,EAAE,EAAE,YAAY,EAAE,eAAe,EAAE;AAC7C,MAAM,OAAO,EAAE,CAAC,EAAE,YAAY,EAAE,KAAK,IAAI,cAAc,CAAC,EAAE,YAAY,EAAE,CAAC;AACzE,KAAK,CAAC;AACN,GAAG;AACH,EAAE,MAAM,EAAE;AACV,IAAI,IAAI,EAAE,YAAY;AACtB,GAAG;AACH,CAAC,EAAE;AACS,MAAC,YAAY,GAAG,cAAc,CAAC,OAAO,CAAC,uBAAuB,CAAC;AAC3E,EAAE,IAAI,EAAE,cAAc;AACtB,EAAE,SAAS,EAAE,MAAM,OAAO,yBAAgC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,OAAO,CAAC;AAClF,EAAE,UAAU,EAAE,YAAY;AAC1B,CAAC,CAAC;;;;"}