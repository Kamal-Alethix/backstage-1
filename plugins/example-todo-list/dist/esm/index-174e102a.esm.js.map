{"version":3,"file":"index-174e102a.esm.js","sources":["../../src/components/TodoList/TodoList.tsx","../../src/components/TodoListPage/TodoListPage.tsx"],"sourcesContent":["/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react';\nimport { Table, TableColumn, Progress } from '@backstage/core-components';\nimport Alert from '@material-ui/lab/Alert';\nimport useAsync from 'react-use/lib/useAsync';\nimport {\n  discoveryApiRef,\n  fetchApiRef,\n  useApi,\n} from '@backstage/core-plugin-api';\nimport { Button } from '@material-ui/core';\n\nexport type Todo = {\n  title: string;\n  id: string;\n  author?: string;\n  timestamp: number;\n};\n\ntype TodosTableProps = {\n  todos: Todo[];\n  onEdit(todo: Todo): any;\n};\n\nexport const TodoList = ({ onEdit }: { onEdit(todo: Todo): any }) => {\n  const discoveryApi = useApi(discoveryApiRef);\n  const { fetch } = useApi(fetchApiRef);\n\n  const { value, loading, error } = useAsync(async (): Promise<Todo[]> => {\n    const response = await fetch(\n      `${await discoveryApi.getBaseUrl('todolist')}/todos`,\n    );\n    return response.json();\n  }, []);\n\n  if (loading) {\n    return <Progress />;\n  } else if (error) {\n    return <Alert severity=\"error\">{error.message}</Alert>;\n  }\n\n  return <TodosTable todos={value || []} onEdit={onEdit} />;\n};\n\nexport function TodosTable({ todos, onEdit }: TodosTableProps) {\n  const columns: TableColumn<Todo>[] = [\n    { title: 'Title', field: 'title' },\n    { title: 'Author', field: 'author' },\n    {\n      title: 'Last edit',\n      field: 'timestamp',\n      render: e => new Date(e.timestamp).toLocaleString(),\n    },\n    {\n      title: 'Action',\n      render: todo => {\n        return (\n          <Button variant=\"contained\" onClick={() => onEdit(todo)}>\n            Edit\n          </Button>\n        );\n      },\n    },\n  ];\n\n  return (\n    <Table\n      title=\"Todos\"\n      options={{ search: false, paging: false }}\n      columns={columns}\n      data={todos}\n    />\n  );\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useReducer, useRef, useState } from 'react';\nimport {\n  Typography,\n  Grid,\n  TextField,\n  Button,\n  Dialog,\n  Box,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n} from '@material-ui/core';\nimport {\n  Header,\n  Page,\n  Content,\n  ContentHeader,\n  HeaderLabel,\n  SupportButton,\n} from '@backstage/core-components';\nimport { Todo, TodoList } from '../TodoList';\nimport {\n  alertApiRef,\n  discoveryApiRef,\n  fetchApiRef,\n  useApi,\n} from '@backstage/core-plugin-api';\n\nexport const TodoListPage = () => {\n  const discoveryApi = useApi(discoveryApiRef);\n  const { fetch } = useApi(fetchApiRef);\n  const alertApi = useApi(alertApiRef);\n  const title = useRef('');\n  const [key, refetchTodos] = useReducer(i => i + 1, 0);\n  const [editElement, setEdit] = useState<Todo | undefined>();\n\n  const handleAdd = async () => {\n    try {\n      const response = await fetch(\n        `${await discoveryApi.getBaseUrl('todolist')}/todos`,\n        {\n          method: 'POST',\n          body: JSON.stringify({ title: title.current }),\n          headers: {\n            'Content-Type': 'application/json',\n          },\n        },\n      );\n      if (!response.ok) {\n        const { error } = await response.json();\n        alertApi.post({\n          message: error.message,\n          severity: 'error',\n        });\n        return;\n      }\n      refetchTodos();\n    } catch (e: any) {\n      alertApi.post({ message: e.message, severity: 'error' });\n    }\n  };\n\n  const handleEdit = async (todo: Todo) => {\n    setEdit(undefined);\n    try {\n      const response = await fetch(\n        `${await discoveryApi.getBaseUrl('todolist')}/todos`,\n        {\n          method: 'PUT',\n          body: JSON.stringify({ title: todo.title, id: todo.id }),\n          headers: {\n            'Content-Type': 'application/json',\n          },\n        },\n      );\n      if (!response.ok) {\n        const { error } = await response.json();\n        alertApi.post({\n          message: error.message,\n          severity: 'error',\n        });\n        return;\n      }\n      refetchTodos();\n    } catch (e: any) {\n      alertApi.post({ message: e.message, severity: 'error' });\n    }\n  };\n\n  return (\n    <Page themeId=\"tool\">\n      <Header\n        title=\"Welcome to todo-list!\"\n        subtitle=\"Just a CRU todo list plugin\"\n      >\n        <HeaderLabel label=\"Owner\" value=\"Team X\" />\n        <HeaderLabel label=\"Lifecycle\" value=\"Alpha\" />\n      </Header>\n      <Content>\n        <ContentHeader title=\"Todo List\">\n          <SupportButton>A description of your plugin goes here.</SupportButton>\n        </ContentHeader>\n        <Grid container spacing={3} direction=\"column\">\n          <Grid item>\n            <Typography variant=\"body1\">Add todo</Typography>\n            <Box\n              component=\"span\"\n              alignItems=\"flex-end\"\n              display=\"flex\"\n              flexDirection=\"row\"\n            >\n              <TextField\n                placeholder=\"Write something here...\"\n                onChange={e => (title.current = e.target.value)}\n              />\n              <Button variant=\"contained\" onClick={handleAdd}>\n                Add\n              </Button>\n            </Box>\n          </Grid>\n          <Grid item>\n            <TodoList key={key} onEdit={setEdit} />\n          </Grid>\n        </Grid>\n      </Content>\n      {!!editElement && (\n        <EditModal\n          todo={editElement}\n          onSubmit={handleEdit}\n          onCancel={() => setEdit(undefined)}\n        />\n      )}\n    </Page>\n  );\n};\n\nfunction EditModal({\n  todo,\n  onCancel,\n  onSubmit,\n}: {\n  todo?: Todo;\n  onSubmit(todo: Todo): any;\n  onCancel(): any;\n}) {\n  const title = useRef('');\n  return (\n    <Dialog open>\n      <DialogTitle id=\"form-dialog-title\">Edit item</DialogTitle>\n      <DialogContent>\n        <TextField\n          placeholder=\"Write something here...\"\n          defaultValue={todo?.title || ''}\n          onChange={e => (title.current = e.target.value)}\n          margin=\"dense\"\n          fullWidth\n        />\n      </DialogContent>\n      <DialogActions>\n        <Button color=\"primary\" onClick={onCancel}>\n          Cancel\n        </Button>\n        <Button\n          onClick={() => onSubmit({ ...todo!, title: title.current })}\n          color=\"primary\"\n        >\n          Save\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n}\n"],"names":[],"mappings":"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"}