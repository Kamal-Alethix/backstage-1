{"version":3,"file":"index.esm.js","sources":["../src/api/TodoClient.ts","../src/api/types.ts","../src/routes.ts","../src/plugin.ts"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { stringifyEntityRef } from '@backstage/catalog-model';\nimport { ResponseError } from '@backstage/errors';\nimport { TodoApi, TodoListOptions, TodoListResult } from './types';\nimport { DiscoveryApi, IdentityApi } from '@backstage/core-plugin-api';\n\n/**\n * Options for creating a todo client.\n *\n * @public\n */\nexport interface TodoClientOptions {\n  discoveryApi: DiscoveryApi;\n  identityApi: IdentityApi;\n}\n\n/**\n * An implementation of the TodoApi that talks to the todo plugin backend.\n *\n * @public\n */\nexport class TodoClient implements TodoApi {\n  private readonly discoveryApi: DiscoveryApi;\n  private readonly identityApi: IdentityApi;\n\n  constructor(options: TodoClientOptions) {\n    this.discoveryApi = options.discoveryApi;\n    this.identityApi = options.identityApi;\n  }\n\n  async listTodos(options: TodoListOptions): Promise<TodoListResult> {\n    const { entity, offset, limit, orderBy, filters } = options;\n    const baseUrl = await this.discoveryApi.getBaseUrl('todo');\n    const { token } = await this.identityApi.getCredentials();\n\n    const query = new URLSearchParams();\n    if (entity) {\n      query.set('entity', stringifyEntityRef(entity));\n    }\n    if (typeof offset === 'number') {\n      query.set('offset', String(offset));\n    }\n    if (typeof limit === 'number') {\n      query.set('limit', String(limit));\n    }\n    if (orderBy) {\n      query.set('orderBy', `${orderBy.field}=${orderBy.direction}`);\n    }\n    if (filters) {\n      for (const filter of filters) {\n        query.append('filter', `${filter.field}=${filter.value}`);\n      }\n    }\n\n    const res = await fetch(`${baseUrl}/v1/todos?${query}`, {\n      headers: token\n        ? {\n            Authorization: `Bearer ${token}`,\n          }\n        : undefined,\n    });\n\n    if (!res.ok) {\n      throw await ResponseError.fromResponse(res);\n    }\n\n    const data: TodoListResult = await res.json();\n    return data;\n  }\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity } from '@backstage/catalog-model';\nimport { createApiRef } from '@backstage/core-plugin-api';\n\n/**\n * TodoItem represents a single TODO comment in source code.\n *\n * @public\n */\nexport type TodoItem = {\n  /** The contents of the TODO comment */\n  text: string;\n\n  /** The tag used, e.g. TODO, FIXME */\n  tag: string;\n\n  /** References author, if any */\n  author?: string;\n\n  /** URL used to view the file */\n  viewUrl?: string;\n\n  /** The line number of the file that the TODO occurs at */\n  lineNumber?: number;\n\n  /** The path of the file containing the TODO within the repo */\n  repoFilePath?: string;\n};\n\n/**\n * Fields that can be used to filter or order todo items.\n *\n * @public\n */\nexport type TodoListFields =\n  | 'text'\n  | 'tag'\n  | 'author'\n  | 'viewUrl'\n  | 'repoFilePath';\n\n/**\n * Options used to list todo items.\n *\n * @public\n */\nexport type TodoListOptions = {\n  entity?: Entity;\n  offset?: number;\n  limit?: number;\n  orderBy?: {\n    field: TodoListFields;\n    direction: 'asc' | 'desc';\n  };\n  filters?: {\n    field: TodoListFields;\n    /** Value to filter by, with '*' used as wildcard */\n    value: string;\n  }[];\n};\n\n/**\n * The result of listing todos.\n *\n * @public\n */\nexport type TodoListResult = {\n  items: TodoItem[];\n  totalCount: number;\n  offset: number;\n  limit: number;\n};\n\n/**\n * The API used by the todo-plugin to list todos.\n *\n * @public\n */\nexport interface TodoApi {\n  /**\n   * Lists todo items.\n   *\n   * @public\n   */\n  listTodos(options: TodoListOptions): Promise<TodoListResult>;\n}\n\n/**\n * ApiRef for the TodoApi.\n *\n * @public\n */\nexport const todoApiRef = createApiRef<TodoApi>({\n  id: 'plugin.todo.api',\n});\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { createRouteRef } from '@backstage/core-plugin-api';\n\nexport const rootRouteRef = createRouteRef({\n  id: 'todo',\n});\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { todoApiRef, TodoClient } from './api';\nimport {\n  createApiFactory,\n  createPlugin,\n  createRoutableExtension,\n  discoveryApiRef,\n  identityApiRef,\n} from '@backstage/core-plugin-api';\nimport { rootRouteRef } from './routes';\n\n/**\n * The Todo plugin instance.\n *\n * @public\n */\nexport const todoPlugin = createPlugin({\n  id: 'todo',\n  apis: [\n    createApiFactory({\n      api: todoApiRef,\n      deps: {\n        identityApi: identityApiRef,\n        discoveryApi: discoveryApiRef,\n      },\n      factory({ identityApi, discoveryApi }) {\n        return new TodoClient({ identityApi, discoveryApi });\n      },\n    }),\n  ],\n  routes: {\n    entityContent: rootRouteRef,\n  },\n});\n\n/**\n * An extension for displaying the list of todos on an entity page.\n *\n * @public\n */\nexport const EntityTodoContent = todoPlugin.provide(\n  createRoutableExtension({\n    name: 'EntityTodoContent',\n    component: () => import('./components/TodoList').then(m => m.TodoList),\n    mountPoint: rootRouteRef,\n  }),\n);\n"],"names":[],"mappings":"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"}