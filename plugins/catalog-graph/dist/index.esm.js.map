{"version":3,"file":"index.esm.js","sources":["../src/components/EntityRelationsGraph/CustomLabel.tsx","../src/components/EntityRelationsGraph/EntityKindIcon.tsx","../src/components/EntityRelationsGraph/CustomNode.tsx","../src/components/EntityRelationsGraph/relations.ts","../src/components/EntityRelationsGraph/types.ts","../src/components/EntityRelationsGraph/useEntityStore.ts","../src/components/EntityRelationsGraph/useEntityRelationGraph.ts","../src/components/EntityRelationsGraph/useEntityRelationNodesAndEdges.ts","../src/components/EntityRelationsGraph/EntityRelationsGraph.tsx","../src/routes.ts","../src/plugin.ts","../src/extensions.tsx"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { DependencyGraphTypes } from '@backstage/core-components';\nimport { BackstageTheme } from '@backstage/theme';\nimport makeStyles from '@material-ui/core/styles/makeStyles';\nimport React from 'react';\nimport { EntityEdgeData } from './types';\nimport classNames from 'classnames';\n\nconst useStyles = makeStyles((theme: BackstageTheme) => ({\n  text: {\n    fill: theme.palette.textContrast,\n  },\n  secondary: {\n    fill: theme.palette.textSubtle,\n  },\n}));\n\nexport function CustomLabel({\n  edge: { relations },\n}: DependencyGraphTypes.RenderLabelProps<EntityEdgeData>) {\n  const classes = useStyles();\n  return (\n    <text className={classes.text} textAnchor=\"middle\">\n      {relations.map((r, i) => (\n        <tspan key={r} className={classNames(i > 0 && classes.secondary)}>\n          {i > 0 && <tspan> / </tspan>}\n          {r}\n        </tspan>\n      ))}\n    </text>\n  );\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { useApp } from '@backstage/core-plugin-api';\nimport WorkIcon from '@material-ui/icons/Work';\nimport React from 'react';\n\nexport function EntityKindIcon({\n  kind,\n  ...props\n}: {\n  kind: string;\n  x?: number;\n  y?: number;\n  width?: number;\n  height?: number;\n  className?: string;\n}) {\n  const app = useApp();\n  const Icon =\n    app.getSystemIcon(`kind:${kind.toLocaleLowerCase('en-US')}`) ?? WorkIcon;\n  return <Icon {...props} />;\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { DependencyGraphTypes } from '@backstage/core-components';\nimport { humanizeEntityRef } from '@backstage/plugin-catalog-react';\nimport { BackstageTheme } from '@backstage/theme';\nimport { makeStyles } from '@material-ui/core/styles';\nimport classNames from 'classnames';\nimport React, { useLayoutEffect, useRef, useState } from 'react';\nimport { EntityKindIcon } from './EntityKindIcon';\nimport { EntityNodeData } from './types';\n\nconst useStyles = makeStyles((theme: BackstageTheme) => ({\n  node: {\n    fill: theme.palette.grey[300],\n    stroke: theme.palette.grey[300],\n\n    '&.primary': {\n      fill: theme.palette.primary.light,\n      stroke: theme.palette.primary.light,\n    },\n    '&.secondary': {\n      fill: theme.palette.secondary.light,\n      stroke: theme.palette.secondary.light,\n    },\n  },\n  text: {\n    fill: theme.palette.getContrastText(theme.palette.grey[300]),\n\n    '&.primary': {\n      fill: theme.palette.primary.contrastText,\n    },\n    '&.secondary': {\n      fill: theme.palette.secondary.contrastText,\n    },\n    '&.focused': {\n      fontWeight: 'bold',\n    },\n  },\n  clickable: {\n    cursor: 'pointer',\n  },\n}));\n\nexport function CustomNode({\n  node: {\n    id,\n    kind,\n    namespace,\n    name,\n    color = 'default',\n    focused,\n    title,\n    onClick,\n  },\n}: DependencyGraphTypes.RenderNodeProps<EntityNodeData>) {\n  const classes = useStyles();\n  const [width, setWidth] = useState(0);\n  const [height, setHeight] = useState(0);\n  const idRef = useRef<SVGTextElement | null>(null);\n\n  useLayoutEffect(() => {\n    // set the width to the length of the ID\n    if (idRef.current) {\n      let { height: renderedHeight, width: renderedWidth } =\n        idRef.current.getBBox();\n      renderedHeight = Math.round(renderedHeight);\n      renderedWidth = Math.round(renderedWidth);\n\n      if (renderedHeight !== height || renderedWidth !== width) {\n        setWidth(renderedWidth);\n        setHeight(renderedHeight);\n      }\n    }\n  }, [width, height]);\n\n  const padding = 10;\n  const iconSize = height;\n  const paddedIconWidth = kind ? iconSize + padding : 0;\n  const paddedWidth = paddedIconWidth + width + padding * 2;\n  const paddedHeight = height + padding * 2;\n\n  const displayTitle =\n    title ??\n    (kind && name && namespace\n      ? humanizeEntityRef({ kind, name, namespace })\n      : id);\n\n  return (\n    <g onClick={onClick} className={classNames(onClick && classes.clickable)}>\n      <rect\n        className={classNames(\n          classes.node,\n          color === 'primary' && 'primary',\n          color === 'secondary' && 'secondary',\n        )}\n        width={paddedWidth}\n        height={paddedHeight}\n        rx={10}\n      />\n      {kind && (\n        <EntityKindIcon\n          kind={kind}\n          y={padding}\n          x={padding}\n          width={iconSize}\n          height={iconSize}\n          className={classNames(\n            classes.text,\n            focused && 'focused',\n            color === 'primary' && 'primary',\n            color === 'secondary' && 'secondary',\n          )}\n        />\n      )}\n      <text\n        ref={idRef}\n        className={classNames(\n          classes.text,\n          focused && 'focused',\n          color === 'primary' && 'primary',\n          color === 'secondary' && 'secondary',\n        )}\n        y={paddedHeight / 2}\n        x={paddedIconWidth + (width + padding * 2) / 2}\n        textAnchor=\"middle\"\n        alignmentBaseline=\"middle\"\n      >\n        {displayTitle}\n      </text>\n    </g>\n  );\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {\n  RELATION_API_CONSUMED_BY,\n  RELATION_API_PROVIDED_BY,\n  RELATION_CHILD_OF,\n  RELATION_CONSUMES_API,\n  RELATION_DEPENDENCY_OF,\n  RELATION_DEPENDS_ON,\n  RELATION_HAS_MEMBER,\n  RELATION_HAS_PART,\n  RELATION_MEMBER_OF,\n  RELATION_OWNED_BY,\n  RELATION_OWNER_OF,\n  RELATION_PARENT_OF,\n  RELATION_PART_OF,\n  RELATION_PROVIDES_API,\n} from '@backstage/catalog-model';\n\n/**\n * A pair of two relations that describe the opposite of each other. The first\n * relation is considered as the primary relation.\n *\n * @public\n */\nexport type RelationPairs = [string, string][];\n\n// TODO: This file only contains the pairs for the built-in relations.\n//  How to implement this when custom relations are used? Right now you can pass\n//  the relations everywhere.\n//  Another option is to move this into @backstage/catalog-model\n\n/**\n * A list of pairs of entity relations, used to define which relations are\n * merged together and which the primary relation is.\n *\n * @public\n */\nexport const ALL_RELATION_PAIRS: RelationPairs = [\n  [RELATION_OWNER_OF, RELATION_OWNED_BY],\n  [RELATION_CONSUMES_API, RELATION_API_CONSUMED_BY],\n  [RELATION_API_PROVIDED_BY, RELATION_PROVIDES_API],\n  [RELATION_HAS_PART, RELATION_PART_OF],\n  [RELATION_PARENT_OF, RELATION_CHILD_OF],\n  [RELATION_HAS_MEMBER, RELATION_MEMBER_OF],\n  [RELATION_DEPENDS_ON, RELATION_DEPENDENCY_OF],\n];\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DependencyGraphTypes } from '@backstage/core-components';\nimport { MouseEventHandler } from 'react';\n\n/**\n * Additional Data for entities.\n *\n * @public\n */\nexport type EntityEdgeData = {\n  /**\n   * Up to two relations that are connecting an entity.\n   */\n  relations: string[];\n  /**\n   * Whether the entity is visible or not.\n   */\n  // Not used, but has to be non empty to draw a label at all!\n  label: 'visible';\n};\n\n/**\n * Edge between two entities.\n *\n * @public\n */\nexport type EntityEdge = DependencyGraphTypes.DependencyEdge<EntityEdgeData>;\n\n/**\n * Additional data for Entity Node\n *\n * @public\n */\nexport type EntityNodeData = {\n  /**\n   * Name of the entity.\n   */\n  name: string;\n  /**\n   * Optional kind of the entity.\n   */\n  kind?: string;\n  /**\n   * Optional title of the entity.\n   */\n  title?: string;\n  /**\n   * Namespace of the entity.\n   */\n  namespace: string;\n  /**\n   * Whether the entity is focused, optional, defaults to false. Focused\n   * entities are highlighted in the graph.\n   */\n  focused?: boolean;\n  /**\n   * Optional color of the entity, defaults to 'default'.\n   */\n  color?: 'primary' | 'secondary' | 'default';\n  /**\n   * Optional click handler.\n   */\n  onClick?: MouseEventHandler<unknown>;\n};\n\n/**\n * Node representing an entity.\n *\n * @public\n */\nexport type EntityNode = DependencyGraphTypes.DependencyNode<EntityNodeData>;\n\n/**\n * Render direction of the graph.\n *\n * @public\n */\nexport enum Direction {\n  /**\n   * Top to bottom.\n   */\n  TOP_BOTTOM = 'TB',\n  /**\n   * Bottom to top.\n   */\n  BOTTOM_TOP = 'BT',\n  /**\n   * Left to right.\n   */\n  LEFT_RIGHT = 'LR',\n  /**\n   * Right to left.\n   */\n  RIGHT_LEFT = 'RL',\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Entity } from '@backstage/catalog-model';\nimport { useApi } from '@backstage/core-plugin-api';\nimport { catalogApiRef } from '@backstage/plugin-catalog-react';\nimport limiterFactory from 'p-limit';\nimport { Dispatch, useCallback, useRef, useState } from 'react';\nimport useAsyncFn from 'react-use/lib/useAsyncFn';\n\n// TODO: This is a good use case for a graphql API, once it is available in the\n// future.\n\nconst limiter = limiterFactory(10);\n\n/**\n * Ensures that a set of requested entities is loaded.\n */\nexport function useEntityStore(): {\n  entities: { [ref: string]: Entity };\n  loading: boolean;\n  error?: Error;\n  requestEntities: Dispatch<string[]>;\n} {\n  const catalogClient = useApi(catalogApiRef);\n  const state = useRef({\n    requestedEntities: new Set<string>(),\n    outstandingEntities: new Map<string, Promise<Entity | undefined>>(),\n    cachedEntities: new Map<string, Entity>(),\n  });\n  const [entities, setEntities] = useState<{\n    [ref: string]: Entity;\n  }>({});\n\n  const updateEntities = useCallback(() => {\n    const { cachedEntities, requestedEntities } = state.current;\n    const filteredEntities: { [ref: string]: Entity } = {};\n    requestedEntities.forEach(entityRef => {\n      const entity = cachedEntities.get(entityRef);\n\n      if (entity) {\n        filteredEntities[entityRef] = entity;\n      }\n    });\n    setEntities(filteredEntities);\n  }, [state, setEntities]);\n\n  const [asyncState, fetch] = useAsyncFn(async () => {\n    const { requestedEntities, outstandingEntities, cachedEntities } =\n      state.current;\n\n    await Promise.all(\n      Array.from(requestedEntities).map(entityRef =>\n        limiter(async () => {\n          if (cachedEntities.has(entityRef)) {\n            return;\n          }\n\n          if (outstandingEntities.has(entityRef)) {\n            await outstandingEntities.get(entityRef);\n            return;\n          }\n\n          const promise = catalogClient.getEntityByRef(entityRef);\n\n          outstandingEntities.set(entityRef, promise);\n\n          try {\n            const entity = await promise;\n\n            if (entity) {\n              cachedEntities.set(entityRef, entity);\n              updateEntities();\n            }\n          } finally {\n            outstandingEntities.delete(entityRef);\n          }\n        }),\n      ),\n    );\n  }, [state, updateEntities]);\n  const { loading, error } = asyncState;\n\n  const requestEntities = useCallback(\n    (entityRefs: string[]) => {\n      const n = new Set(entityRefs);\n      const { requestedEntities } = state.current;\n\n      if (\n        n.size !== requestedEntities.size ||\n        Array.from(n).some(e => !requestedEntities.has(e))\n      ) {\n        state.current.requestedEntities = n;\n        fetch();\n        updateEntities();\n      }\n    },\n    [state, fetch, updateEntities],\n  );\n\n  return {\n    entities,\n    loading,\n    error,\n    requestEntities,\n  };\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Entity } from '@backstage/catalog-model';\nimport { useEffect } from 'react';\nimport { useEntityStore } from './useEntityStore';\n\n/**\n * Discover the graph of entities connected by relations, starting from a set of\n * root entities. Filters are used to select which relations to includes.\n * Returns all discovered entities once they are loaded.\n */\nexport function useEntityRelationGraph({\n  rootEntityRefs,\n  filter: { maxDepth = Number.POSITIVE_INFINITY, relations, kinds } = {},\n}: {\n  rootEntityRefs: string[];\n  filter?: {\n    maxDepth?: number;\n    relations?: string[];\n    kinds?: string[];\n  };\n}): {\n  entities?: { [ref: string]: Entity };\n  loading: boolean;\n  error?: Error;\n} {\n  const { entities, loading, error, requestEntities } = useEntityStore();\n\n  useEffect(() => {\n    const expectedEntities = new Set([...rootEntityRefs]);\n    const processedEntityRefs = new Set<string>();\n\n    let nextDepthRefQueue = [...rootEntityRefs];\n    let depth = 0;\n\n    while (\n      nextDepthRefQueue.length > 0 &&\n      (!isFinite(maxDepth) || depth < maxDepth)\n    ) {\n      const entityRefQueue = nextDepthRefQueue;\n      nextDepthRefQueue = [];\n\n      while (entityRefQueue.length > 0) {\n        const entityRef = entityRefQueue.shift()!;\n        const entity = entities[entityRef];\n\n        processedEntityRefs.add(entityRef);\n\n        if (entity && entity.relations) {\n          for (const rel of entity.relations) {\n            if (\n              (!relations || relations.includes(rel.type)) &&\n              (!kinds ||\n                kinds.some(kind =>\n                  rel.targetRef.startsWith(\n                    `${kind.toLocaleLowerCase('en-US')}:`,\n                  ),\n                ))\n            ) {\n              if (!processedEntityRefs.has(rel.targetRef)) {\n                nextDepthRefQueue.push(rel.targetRef);\n                expectedEntities.add(rel.targetRef);\n              }\n            }\n          }\n        }\n      }\n\n      ++depth;\n    }\n\n    requestEntities([...expectedEntities]);\n  }, [entities, rootEntityRefs, maxDepth, relations, kinds, requestEntities]);\n\n  return {\n    entities,\n    loading,\n    error,\n  };\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { DEFAULT_NAMESPACE } from '@backstage/catalog-model';\nimport { MouseEvent, useState } from 'react';\nimport useDebounce from 'react-use/lib/useDebounce';\nimport { RelationPairs, ALL_RELATION_PAIRS } from './relations';\nimport { EntityEdge, EntityNode } from './types';\nimport { useEntityRelationGraph } from './useEntityRelationGraph';\n\n/**\n * Generate nodes and edges to render the entity graph.\n */\nexport function useEntityRelationNodesAndEdges({\n  rootEntityRefs,\n  maxDepth = Number.POSITIVE_INFINITY,\n  unidirectional = true,\n  mergeRelations = true,\n  kinds,\n  relations,\n  onNodeClick,\n  relationPairs = ALL_RELATION_PAIRS,\n}: {\n  rootEntityRefs: string[];\n  maxDepth?: number;\n  unidirectional?: boolean;\n  mergeRelations?: boolean;\n  kinds?: string[];\n  relations?: string[];\n  onNodeClick?: (value: EntityNode, event: MouseEvent<unknown>) => void;\n  relationPairs?: RelationPairs;\n}): {\n  loading: boolean;\n  nodes?: EntityNode[];\n  edges?: EntityEdge[];\n  error?: Error;\n} {\n  const [nodesAndEdges, setNodesAndEdges] = useState<{\n    nodes?: EntityNode[];\n    edges?: EntityEdge[];\n  }>({});\n  const { entities, loading, error } = useEntityRelationGraph({\n    rootEntityRefs,\n    filter: {\n      maxDepth,\n      kinds,\n      relations,\n    },\n  });\n\n  useDebounce(\n    () => {\n      if (!entities || Object.keys(entities).length === 0) {\n        setNodesAndEdges({});\n        return;\n      }\n\n      const nodes = Object.entries(entities).map(([entityRef, entity]) => {\n        const focused = rootEntityRefs.includes(entityRef);\n        const node: EntityNode = {\n          id: entityRef,\n          title: entity.metadata?.title ?? undefined,\n          kind: entity.kind,\n          name: entity.metadata.name,\n          namespace: entity.metadata.namespace ?? DEFAULT_NAMESPACE,\n          focused,\n          color: focused ? 'secondary' : 'primary',\n        };\n\n        if (onNodeClick) {\n          node.onClick = event => onNodeClick(node, event);\n        }\n\n        return node;\n      });\n\n      const edges: EntityEdge[] = [];\n      const visitedNodes = new Set<string>();\n      const nodeQueue = [...rootEntityRefs];\n\n      while (nodeQueue.length > 0) {\n        const entityRef = nodeQueue.pop()!;\n        const entity = entities[entityRef];\n        visitedNodes.add(entityRef);\n\n        if (entity) {\n          entity?.relations?.forEach(rel => {\n            // Check if the related entity should be displayed, if not, ignore\n            // the relation too\n            if (!entities[rel.targetRef]) {\n              return;\n            }\n\n            if (relations && !relations.includes(rel.type)) {\n              return;\n            }\n\n            if (\n              kinds &&\n              !kinds.some(kind =>\n                rel.targetRef.startsWith(`${kind.toLocaleLowerCase('en-US')}:`),\n              )\n            ) {\n              return;\n            }\n\n            if (!unidirectional || !visitedNodes.has(rel.targetRef)) {\n              if (mergeRelations) {\n                const pair = relationPairs.find(\n                  ([l, r]) => l === rel.type || r === rel.type,\n                ) ?? [rel.type];\n                const [left] = pair;\n\n                edges.push({\n                  from: left === rel.type ? entityRef : rel.targetRef,\n                  to: left === rel.type ? rel.targetRef : entityRef,\n                  relations: pair,\n                  label: 'visible',\n                });\n              } else {\n                edges.push({\n                  from: entityRef,\n                  to: rel.targetRef,\n                  relations: [rel.type],\n                  label: 'visible',\n                });\n              }\n            }\n\n            if (!visitedNodes.has(rel.targetRef)) {\n              nodeQueue.push(rel.targetRef);\n              visitedNodes.add(rel.targetRef);\n            }\n          });\n        }\n      }\n\n      setNodesAndEdges({ nodes, edges });\n    },\n    100,\n    [\n      entities,\n      rootEntityRefs,\n      kinds,\n      relations,\n      unidirectional,\n      mergeRelations,\n      onNodeClick,\n      relationPairs,\n    ],\n  );\n\n  return {\n    loading,\n    error,\n    ...nodesAndEdges,\n  };\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  CompoundEntityRef,\n  stringifyEntityRef,\n} from '@backstage/catalog-model';\nimport {\n  DependencyGraph,\n  DependencyGraphTypes,\n} from '@backstage/core-components';\nimport { errorApiRef, useApi } from '@backstage/core-plugin-api';\nimport { CircularProgress, makeStyles, useTheme } from '@material-ui/core';\nimport classNames from 'classnames';\nimport React, { MouseEvent, useEffect, useMemo } from 'react';\nimport { CustomLabel } from './CustomLabel';\nimport { CustomNode } from './CustomNode';\nimport { ALL_RELATION_PAIRS, RelationPairs } from './relations';\nimport { Direction, EntityEdge, EntityNode } from './types';\nimport { useEntityRelationNodesAndEdges } from './useEntityRelationNodesAndEdges';\n\nconst useStyles = makeStyles(theme => ({\n  progress: {\n    position: 'absolute',\n    left: '50%',\n    top: '50%',\n    marginLeft: '-20px',\n    marginTop: '-20px',\n  },\n  container: {\n    position: 'relative',\n    width: '100%',\n    display: 'flex',\n    flexDirection: 'column',\n  },\n  graph: {\n    width: '100%',\n    flex: 1,\n    // Right now there is no good way to style edges between nodes, we have to\n    // fallback to these hacks:\n    '& path[marker-end]': {\n      transition: 'filter 0.1s ease-in-out',\n    },\n    '& path[marker-end]:hover': {\n      filter: `drop-shadow(2px 2px 4px ${theme.palette.primary.dark});`,\n    },\n    '& g[data-testid=label]': {\n      transition: 'transform 0s',\n    },\n  },\n}));\n\n/**\n * Core building block for custom entity relations diagrams.\n *\n * @public\n */\nexport const EntityRelationsGraph = (props: {\n  rootEntityNames: CompoundEntityRef | CompoundEntityRef[];\n  maxDepth?: number;\n  unidirectional?: boolean;\n  mergeRelations?: boolean;\n  kinds?: string[];\n  relations?: string[];\n  direction?: Direction;\n  onNodeClick?: (value: EntityNode, event: MouseEvent<unknown>) => void;\n  relationPairs?: RelationPairs;\n  className?: string;\n  zoom?: 'enabled' | 'disabled' | 'enable-on-click';\n  renderNode?: DependencyGraphTypes.RenderNodeFunction<EntityNode>;\n  renderLabel?: DependencyGraphTypes.RenderLabelFunction<EntityEdge>;\n}) => {\n  const {\n    rootEntityNames,\n    maxDepth = Number.POSITIVE_INFINITY,\n    unidirectional = true,\n    mergeRelations = true,\n    kinds,\n    relations,\n    direction = Direction.LEFT_RIGHT,\n    onNodeClick,\n    relationPairs = ALL_RELATION_PAIRS,\n    className,\n    zoom = 'enabled',\n    renderNode,\n    renderLabel,\n  } = props;\n\n  const theme = useTheme();\n  const classes = useStyles();\n  const rootEntityRefs = useMemo(\n    () =>\n      (Array.isArray(rootEntityNames)\n        ? rootEntityNames\n        : [rootEntityNames]\n      ).map(e => stringifyEntityRef(e)),\n    [rootEntityNames],\n  );\n  const errorApi = useApi(errorApiRef);\n  const { loading, error, nodes, edges } = useEntityRelationNodesAndEdges({\n    rootEntityRefs,\n    maxDepth,\n    unidirectional,\n    mergeRelations,\n    kinds,\n    relations,\n    onNodeClick,\n    relationPairs,\n  });\n\n  useEffect(() => {\n    if (error) {\n      errorApi.post(error);\n    }\n  }, [errorApi, error]);\n\n  return (\n    <div className={classNames(classes.container, className)}>\n      {loading && <CircularProgress className={classes.progress} />}\n      {nodes && edges && (\n        <DependencyGraph\n          nodes={nodes}\n          edges={edges}\n          renderNode={renderNode || CustomNode}\n          renderLabel={renderLabel || CustomLabel}\n          direction={direction}\n          className={classes.graph}\n          paddingX={theme.spacing(4)}\n          paddingY={theme.spacing(4)}\n          labelPosition={DependencyGraphTypes.LabelPosition.RIGHT}\n          labelOffset={theme.spacing(1)}\n          zoom={zoom}\n        />\n      )}\n    </div>\n  );\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {\n  createExternalRouteRef,\n  createRouteRef,\n} from '@backstage/core-plugin-api';\n\n/**\n * Route pointing to the standalone catalog graph page.\n *\n * @public\n */\nexport const catalogGraphRouteRef = createRouteRef({\n  id: 'catalog-graph',\n});\n\n/**\n * Route pointing to the entity page.\n * Used to navigate from the graph to an entity.\n *\n * @public\n * @deprecated This route is no longer used and can be removed\n */\nexport const catalogEntityRouteRef = createExternalRouteRef({\n  id: 'catalog-entity',\n  params: ['namespace', 'kind', 'name'],\n  optional: true,\n});\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { createPlugin } from '@backstage/core-plugin-api';\nimport { catalogEntityRouteRef, catalogGraphRouteRef } from './routes';\n\n/**\n * Catalog Graph Plugin instance.\n * @public\n */\nexport const catalogGraphPlugin = createPlugin({\n  id: 'catalog-graph',\n  routes: {\n    catalogGraph: catalogGraphRouteRef,\n  },\n  externalRoutes: {\n    catalogEntity: catalogEntityRouteRef,\n  },\n});\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {\n  createComponentExtension,\n  createRoutableExtension,\n} from '@backstage/core-plugin-api';\nimport { catalogGraphPlugin } from './plugin';\nimport { catalogGraphRouteRef } from './routes';\n\n/**\n * A card that displays the directly related entities to the current entity.\n *\n * @public\n */\nexport const EntityCatalogGraphCard = catalogGraphPlugin.provide(\n  createComponentExtension({\n    name: 'EntityCatalogGraphCard',\n    component: {\n      lazy: () =>\n        import('./components/CatalogGraphCard').then(m => m.CatalogGraphCard),\n    },\n  }),\n);\n\n/**\n * A standalone page that can be added to your application providing a viewer\n * for your entities and their relations.\n *\n * @public\n */\nexport const CatalogGraphPage = catalogGraphPlugin.provide(\n  createRoutableExtension({\n    name: 'CatalogGraphPage',\n    component: () =>\n      import('./components/CatalogGraphPage').then(m => m.CatalogGraphPage),\n    mountPoint: catalogGraphRouteRef,\n  }),\n);\n"],"names":["useStyles","makeStyles"],"mappings":";;;;;;;;;;;;;;AAGA,MAAMA,WAAS,GAAG,UAAU,CAAC,CAAC,KAAK,MAAM;AACzC,EAAE,IAAI,EAAE;AACR,IAAI,IAAI,EAAE,KAAK,CAAC,OAAO,CAAC,YAAY;AACpC,GAAG;AACH,EAAE,SAAS,EAAE;AACb,IAAI,IAAI,EAAE,KAAK,CAAC,OAAO,CAAC,UAAU;AAClC,GAAG;AACH,CAAC,CAAC,CAAC,CAAC;AACG,SAAS,WAAW,CAAC;AAC5B,EAAE,IAAI,EAAE,EAAE,SAAS,EAAE;AACrB,CAAC,EAAE;AACH,EAAE,MAAM,OAAO,GAAGA,WAAS,EAAE,CAAC;AAC9B,EAAE,uBAAuB,KAAK,CAAC,aAAa,CAAC,MAAM,EAAE;AACrD,IAAI,SAAS,EAAE,OAAO,CAAC,IAAI;AAC3B,IAAI,UAAU,EAAE,QAAQ;AACxB,GAAG,EAAE,SAAS,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,qBAAqB,KAAK,CAAC,aAAa,CAAC,OAAO,EAAE;AAC1E,IAAI,GAAG,EAAE,CAAC;AACV,IAAI,SAAS,EAAE,UAAU,CAAC,CAAC,GAAG,CAAC,IAAI,OAAO,CAAC,SAAS,CAAC;AACrD,GAAG,EAAE,CAAC,GAAG,CAAC,oBAAoB,KAAK,CAAC,aAAa,CAAC,OAAO,EAAE,IAAI,EAAE,KAAK,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;AAC9E;;ACnBO,SAAS,cAAc,CAAC;AAC/B,EAAE,IAAI;AACN,EAAE,GAAG,KAAK;AACV,CAAC,EAAE;AACH,EAAE,IAAI,EAAE,CAAC;AACT,EAAE,MAAM,GAAG,GAAG,MAAM,EAAE,CAAC;AACvB,EAAE,MAAM,IAAI,GAAG,CAAC,EAAE,GAAG,GAAG,CAAC,aAAa,CAAC,CAAC,KAAK,EAAE,IAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,KAAK,IAAI,GAAG,EAAE,GAAG,QAAQ,CAAC;AAC3G,EAAE,uBAAuB,KAAK,CAAC,aAAa,CAAC,IAAI,EAAE;AACnD,IAAI,GAAG,KAAK;AACZ,GAAG,CAAC,CAAC;AACL;;ACRA,MAAMA,WAAS,GAAGC,YAAU,CAAC,CAAC,KAAK,MAAM;AACzC,EAAE,IAAI,EAAE;AACR,IAAI,IAAI,EAAE,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC;AACjC,IAAI,MAAM,EAAE,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC;AACnC,IAAI,WAAW,EAAE;AACjB,MAAM,IAAI,EAAE,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,KAAK;AACvC,MAAM,MAAM,EAAE,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,KAAK;AACzC,KAAK;AACL,IAAI,aAAa,EAAE;AACnB,MAAM,IAAI,EAAE,KAAK,CAAC,OAAO,CAAC,SAAS,CAAC,KAAK;AACzC,MAAM,MAAM,EAAE,KAAK,CAAC,OAAO,CAAC,SAAS,CAAC,KAAK;AAC3C,KAAK;AACL,GAAG;AACH,EAAE,IAAI,EAAE;AACR,IAAI,IAAI,EAAE,KAAK,CAAC,OAAO,CAAC,eAAe,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AAChE,IAAI,WAAW,EAAE;AACjB,MAAM,IAAI,EAAE,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,YAAY;AAC9C,KAAK;AACL,IAAI,aAAa,EAAE;AACnB,MAAM,IAAI,EAAE,KAAK,CAAC,OAAO,CAAC,SAAS,CAAC,YAAY;AAChD,KAAK;AACL,IAAI,WAAW,EAAE;AACjB,MAAM,UAAU,EAAE,MAAM;AACxB,KAAK;AACL,GAAG;AACH,EAAE,SAAS,EAAE;AACb,IAAI,MAAM,EAAE,SAAS;AACrB,GAAG;AACH,CAAC,CAAC,CAAC,CAAC;AACG,SAAS,UAAU,CAAC;AAC3B,EAAE,IAAI,EAAE;AACR,IAAI,EAAE;AACN,IAAI,IAAI;AACR,IAAI,SAAS;AACb,IAAI,IAAI;AACR,IAAI,KAAK,GAAG,SAAS;AACrB,IAAI,OAAO;AACX,IAAI,KAAK;AACT,IAAI,OAAO;AACX,GAAG;AACH,CAAC,EAAE;AACH,EAAE,MAAM,OAAO,GAAGD,WAAS,EAAE,CAAC;AAC9B,EAAE,MAAM,CAAC,KAAK,EAAE,QAAQ,CAAC,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC;AACxC,EAAE,MAAM,CAAC,MAAM,EAAE,SAAS,CAAC,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC;AAC1C,EAAE,MAAM,KAAK,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC;AAC7B,EAAE,eAAe,CAAC,MAAM;AACxB,IAAI,IAAI,KAAK,CAAC,OAAO,EAAE;AACvB,MAAM,IAAI,EAAE,MAAM,EAAE,cAAc,EAAE,KAAK,EAAE,aAAa,EAAE,GAAG,KAAK,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;AACrF,MAAM,cAAc,GAAG,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC,CAAC;AAClD,MAAM,aAAa,GAAG,IAAI,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC;AAChD,MAAM,IAAI,cAAc,KAAK,MAAM,IAAI,aAAa,KAAK,KAAK,EAAE;AAChE,QAAQ,QAAQ,CAAC,aAAa,CAAC,CAAC;AAChC,QAAQ,SAAS,CAAC,cAAc,CAAC,CAAC;AAClC,OAAO;AACP,KAAK;AACL,GAAG,EAAE,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC,CAAC;AACtB,EAAE,MAAM,OAAO,GAAG,EAAE,CAAC;AACrB,EAAE,MAAM,QAAQ,GAAG,MAAM,CAAC;AAC1B,EAAE,MAAM,eAAe,GAAG,IAAI,GAAG,QAAQ,GAAG,OAAO,GAAG,CAAC,CAAC;AACxD,EAAE,MAAM,WAAW,GAAG,eAAe,GAAG,KAAK,GAAG,OAAO,GAAG,CAAC,CAAC;AAC5D,EAAE,MAAM,YAAY,GAAG,MAAM,GAAG,OAAO,GAAG,CAAC,CAAC;AAC5C,EAAE,MAAM,YAAY,GAAG,KAAK,IAAI,IAAI,GAAG,KAAK,GAAG,IAAI,IAAI,IAAI,IAAI,SAAS,GAAG,iBAAiB,CAAC,EAAE,IAAI,EAAE,IAAI,EAAE,SAAS,EAAE,CAAC,GAAG,EAAE,CAAC;AAC7H,EAAE,uBAAuB,KAAK,CAAC,aAAa,CAAC,GAAG,EAAE;AAClD,IAAI,OAAO;AACX,IAAI,SAAS,EAAE,UAAU,CAAC,OAAO,IAAI,OAAO,CAAC,SAAS,CAAC;AACvD,GAAG,kBAAkB,KAAK,CAAC,aAAa,CAAC,MAAM,EAAE;AACjD,IAAI,SAAS,EAAE,UAAU,CAAC,OAAO,CAAC,IAAI,EAAE,KAAK,KAAK,SAAS,IAAI,SAAS,EAAE,KAAK,KAAK,WAAW,IAAI,WAAW,CAAC;AAC/G,IAAI,KAAK,EAAE,WAAW;AACtB,IAAI,MAAM,EAAE,YAAY;AACxB,IAAI,EAAE,EAAE,EAAE;AACV,GAAG,CAAC,EAAE,IAAI,oBAAoB,KAAK,CAAC,aAAa,CAAC,cAAc,EAAE;AAClE,IAAI,IAAI;AACR,IAAI,CAAC,EAAE,OAAO;AACd,IAAI,CAAC,EAAE,OAAO;AACd,IAAI,KAAK,EAAE,QAAQ;AACnB,IAAI,MAAM,EAAE,QAAQ;AACpB,IAAI,SAAS,EAAE,UAAU,CAAC,OAAO,CAAC,IAAI,EAAE,OAAO,IAAI,SAAS,EAAE,KAAK,KAAK,SAAS,IAAI,SAAS,EAAE,KAAK,KAAK,WAAW,IAAI,WAAW,CAAC;AACrI,GAAG,CAAC,kBAAkB,KAAK,CAAC,aAAa,CAAC,MAAM,EAAE;AAClD,IAAI,GAAG,EAAE,KAAK;AACd,IAAI,SAAS,EAAE,UAAU,CAAC,OAAO,CAAC,IAAI,EAAE,OAAO,IAAI,SAAS,EAAE,KAAK,KAAK,SAAS,IAAI,SAAS,EAAE,KAAK,KAAK,WAAW,IAAI,WAAW,CAAC;AACrI,IAAI,CAAC,EAAE,YAAY,GAAG,CAAC;AACvB,IAAI,CAAC,EAAE,eAAe,GAAG,CAAC,KAAK,GAAG,OAAO,GAAG,CAAC,IAAI,CAAC;AAClD,IAAI,UAAU,EAAE,QAAQ;AACxB,IAAI,iBAAiB,EAAE,QAAQ;AAC/B,GAAG,EAAE,YAAY,CAAC,CAAC,CAAC;AACpB;;AC1EY,MAAC,kBAAkB,GAAG;AAClC,EAAE,CAAC,iBAAiB,EAAE,iBAAiB,CAAC;AACxC,EAAE,CAAC,qBAAqB,EAAE,wBAAwB,CAAC;AACnD,EAAE,CAAC,wBAAwB,EAAE,qBAAqB,CAAC;AACnD,EAAE,CAAC,iBAAiB,EAAE,gBAAgB,CAAC;AACvC,EAAE,CAAC,kBAAkB,EAAE,iBAAiB,CAAC;AACzC,EAAE,CAAC,mBAAmB,EAAE,kBAAkB,CAAC;AAC3C,EAAE,CAAC,mBAAmB,EAAE,sBAAsB,CAAC;AAC/C;;ACxBU,IAAC,SAAS,mBAAmB,CAAC,CAAC,UAAU,KAAK;AACxD,EAAE,UAAU,CAAC,YAAY,CAAC,GAAG,IAAI,CAAC;AAClC,EAAE,UAAU,CAAC,YAAY,CAAC,GAAG,IAAI,CAAC;AAClC,EAAE,UAAU,CAAC,YAAY,CAAC,GAAG,IAAI,CAAC;AAClC,EAAE,UAAU,CAAC,YAAY,CAAC,GAAG,IAAI,CAAC;AAClC,EAAE,OAAO,UAAU,CAAC;AACpB,CAAC,EAAE,SAAS,IAAI,EAAE;;ACDlB,MAAM,OAAO,GAAG,cAAc,CAAC,EAAE,CAAC,CAAC;AAC5B,SAAS,cAAc,GAAG;AACjC,EAAE,MAAM,aAAa,GAAG,MAAM,CAAC,aAAa,CAAC,CAAC;AAC9C,EAAE,MAAM,KAAK,GAAG,MAAM,CAAC;AACvB,IAAI,iBAAiB,kBAAkB,IAAI,GAAG,EAAE;AAChD,IAAI,mBAAmB,kBAAkB,IAAI,GAAG,EAAE;AAClD,IAAI,cAAc,kBAAkB,IAAI,GAAG,EAAE;AAC7C,GAAG,CAAC,CAAC;AACL,EAAE,MAAM,CAAC,QAAQ,EAAE,WAAW,CAAC,GAAG,QAAQ,CAAC,EAAE,CAAC,CAAC;AAC/C,EAAE,MAAM,cAAc,GAAG,WAAW,CAAC,MAAM;AAC3C,IAAI,MAAM,EAAE,cAAc,EAAE,iBAAiB,EAAE,GAAG,KAAK,CAAC,OAAO,CAAC;AAChE,IAAI,MAAM,gBAAgB,GAAG,EAAE,CAAC;AAChC,IAAI,iBAAiB,CAAC,OAAO,CAAC,CAAC,SAAS,KAAK;AAC7C,MAAM,MAAM,MAAM,GAAG,cAAc,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;AACnD,MAAM,IAAI,MAAM,EAAE;AAClB,QAAQ,gBAAgB,CAAC,SAAS,CAAC,GAAG,MAAM,CAAC;AAC7C,OAAO;AACP,KAAK,CAAC,CAAC;AACP,IAAI,WAAW,CAAC,gBAAgB,CAAC,CAAC;AAClC,GAAG,EAAE,CAAC,KAAK,EAAE,WAAW,CAAC,CAAC,CAAC;AAC3B,EAAE,MAAM,CAAC,UAAU,EAAE,KAAK,CAAC,GAAG,UAAU,CAAC,YAAY;AACrD,IAAI,MAAM,EAAE,iBAAiB,EAAE,mBAAmB,EAAE,cAAc,EAAE,GAAG,KAAK,CAAC,OAAO,CAAC;AACrF,IAAI,MAAM,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC,GAAG,CAAC,CAAC,SAAS,KAAK,OAAO,CAAC,YAAY;AAC3F,MAAM,IAAI,cAAc,CAAC,GAAG,CAAC,SAAS,CAAC,EAAE;AACzC,QAAQ,OAAO;AACf,OAAO;AACP,MAAM,IAAI,mBAAmB,CAAC,GAAG,CAAC,SAAS,CAAC,EAAE;AAC9C,QAAQ,MAAM,mBAAmB,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;AACjD,QAAQ,OAAO;AACf,OAAO;AACP,MAAM,MAAM,OAAO,GAAG,aAAa,CAAC,cAAc,CAAC,SAAS,CAAC,CAAC;AAC9D,MAAM,mBAAmB,CAAC,GAAG,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC;AAClD,MAAM,IAAI;AACV,QAAQ,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC;AACrC,QAAQ,IAAI,MAAM,EAAE;AACpB,UAAU,cAAc,CAAC,GAAG,CAAC,SAAS,EAAE,MAAM,CAAC,CAAC;AAChD,UAAU,cAAc,EAAE,CAAC;AAC3B,SAAS;AACT,OAAO,SAAS;AAChB,QAAQ,mBAAmB,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;AAC9C,OAAO;AACP,KAAK,CAAC,CAAC,CAAC,CAAC;AACT,GAAG,EAAE,CAAC,KAAK,EAAE,cAAc,CAAC,CAAC,CAAC;AAC9B,EAAE,MAAM,EAAE,OAAO,EAAE,KAAK,EAAE,GAAG,UAAU,CAAC;AACxC,EAAE,MAAM,eAAe,GAAG,WAAW,CAAC,CAAC,UAAU,KAAK;AACtD,IAAI,MAAM,CAAC,GAAG,IAAI,GAAG,CAAC,UAAU,CAAC,CAAC;AAClC,IAAI,MAAM,EAAE,iBAAiB,EAAE,GAAG,KAAK,CAAC,OAAO,CAAC;AAChD,IAAI,IAAI,CAAC,CAAC,IAAI,KAAK,iBAAiB,CAAC,IAAI,IAAI,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,iBAAiB,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE;AACnG,MAAM,KAAK,CAAC,OAAO,CAAC,iBAAiB,GAAG,CAAC,CAAC;AAC1C,MAAM,KAAK,EAAE,CAAC;AACd,MAAM,cAAc,EAAE,CAAC;AACvB,KAAK;AACL,GAAG,EAAE,CAAC,KAAK,EAAE,KAAK,EAAE,cAAc,CAAC,CAAC,CAAC;AACrC,EAAE,OAAO;AACT,IAAI,QAAQ;AACZ,IAAI,OAAO;AACX,IAAI,KAAK;AACT,IAAI,eAAe;AACnB,GAAG,CAAC;AACJ;;AC9DO,SAAS,sBAAsB,CAAC;AACvC,EAAE,cAAc;AAChB,EAAE,MAAM,EAAE,EAAE,QAAQ,GAAG,MAAM,CAAC,iBAAiB,EAAE,SAAS,EAAE,KAAK,EAAE,GAAG,EAAE;AACxE,CAAC,EAAE;AACH,EAAE,MAAM,EAAE,QAAQ,EAAE,OAAO,EAAE,KAAK,EAAE,eAAe,EAAE,GAAG,cAAc,EAAE,CAAC;AACzE,EAAE,SAAS,CAAC,MAAM;AAClB,IAAI,MAAM,gBAAgB,mBAAmB,IAAI,GAAG,CAAC,CAAC,GAAG,cAAc,CAAC,CAAC,CAAC;AAC1E,IAAI,MAAM,mBAAmB,mBAAmB,IAAI,GAAG,EAAE,CAAC;AAC1D,IAAI,IAAI,iBAAiB,GAAG,CAAC,GAAG,cAAc,CAAC,CAAC;AAChD,IAAI,IAAI,KAAK,GAAG,CAAC,CAAC;AAClB,IAAI,OAAO,iBAAiB,CAAC,MAAM,GAAG,CAAC,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC,IAAI,KAAK,GAAG,QAAQ,CAAC,EAAE;AACtF,MAAM,MAAM,cAAc,GAAG,iBAAiB,CAAC;AAC/C,MAAM,iBAAiB,GAAG,EAAE,CAAC;AAC7B,MAAM,OAAO,cAAc,CAAC,MAAM,GAAG,CAAC,EAAE;AACxC,QAAQ,MAAM,SAAS,GAAG,cAAc,CAAC,KAAK,EAAE,CAAC;AACjD,QAAQ,MAAM,MAAM,GAAG,QAAQ,CAAC,SAAS,CAAC,CAAC;AAC3C,QAAQ,mBAAmB,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;AAC3C,QAAQ,IAAI,MAAM,IAAI,MAAM,CAAC,SAAS,EAAE;AACxC,UAAU,KAAK,MAAM,GAAG,IAAI,MAAM,CAAC,SAAS,EAAE;AAC9C,YAAY,IAAI,CAAC,CAAC,SAAS,IAAI,SAAS,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,IAAI,KAAK,CAAC,IAAI,CAAC,CAAC,IAAI,KAAK,GAAG,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC,EAAE,IAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;AACnK,cAAc,IAAI,CAAC,mBAAmB,CAAC,GAAG,CAAC,GAAG,CAAC,SAAS,CAAC,EAAE;AAC3D,gBAAgB,iBAAiB,CAAC,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;AACtD,gBAAgB,gBAAgB,CAAC,GAAG,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;AACpD,eAAe;AACf,aAAa;AACb,WAAW;AACX,SAAS;AACT,OAAO;AACP,MAAM,EAAE,KAAK,CAAC;AACd,KAAK;AACL,IAAI,eAAe,CAAC,CAAC,GAAG,gBAAgB,CAAC,CAAC,CAAC;AAC3C,GAAG,EAAE,CAAC,QAAQ,EAAE,cAAc,EAAE,QAAQ,EAAE,SAAS,EAAE,KAAK,EAAE,eAAe,CAAC,CAAC,CAAC;AAC9E,EAAE,OAAO;AACT,IAAI,QAAQ;AACZ,IAAI,OAAO;AACX,IAAI,KAAK;AACT,GAAG,CAAC;AACJ;;AClCO,SAAS,8BAA8B,CAAC;AAC/C,EAAE,cAAc;AAChB,EAAE,QAAQ,GAAG,MAAM,CAAC,iBAAiB;AACrC,EAAE,cAAc,GAAG,IAAI;AACvB,EAAE,cAAc,GAAG,IAAI;AACvB,EAAE,KAAK;AACP,EAAE,SAAS;AACX,EAAE,WAAW;AACb,EAAE,aAAa,GAAG,kBAAkB;AACpC,CAAC,EAAE;AACH,EAAE,MAAM,CAAC,aAAa,EAAE,gBAAgB,CAAC,GAAG,QAAQ,CAAC,EAAE,CAAC,CAAC;AACzD,EAAE,MAAM,EAAE,QAAQ,EAAE,OAAO,EAAE,KAAK,EAAE,GAAG,sBAAsB,CAAC;AAC9D,IAAI,cAAc;AAClB,IAAI,MAAM,EAAE;AACZ,MAAM,QAAQ;AACd,MAAM,KAAK;AACX,MAAM,SAAS;AACf,KAAK;AACL,GAAG,CAAC,CAAC;AACL,EAAE,WAAW,CAAC,MAAM;AACpB,IAAI,IAAI,EAAE,CAAC;AACX,IAAI,IAAI,CAAC,QAAQ,IAAI,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,MAAM,KAAK,CAAC,EAAE;AACzD,MAAM,gBAAgB,CAAC,EAAE,CAAC,CAAC;AAC3B,MAAM,OAAO;AACb,KAAK;AACL,IAAI,MAAM,KAAK,GAAG,MAAM,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,SAAS,EAAE,MAAM,CAAC,KAAK;AACxE,MAAM,IAAI,GAAG,EAAE,EAAE,EAAE,EAAE,CAAC;AACtB,MAAM,MAAM,OAAO,GAAG,cAAc,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC;AACzD,MAAM,MAAM,IAAI,GAAG;AACnB,QAAQ,EAAE,EAAE,SAAS;AACrB,QAAQ,KAAK,EAAE,CAAC,EAAE,GAAG,CAAC,GAAG,GAAG,MAAM,CAAC,QAAQ,KAAK,IAAI,GAAG,KAAK,CAAC,GAAG,GAAG,CAAC,KAAK,KAAK,IAAI,GAAG,EAAE,GAAG,KAAK,CAAC;AAChG,QAAQ,IAAI,EAAE,MAAM,CAAC,IAAI;AACzB,QAAQ,IAAI,EAAE,MAAM,CAAC,QAAQ,CAAC,IAAI;AAClC,QAAQ,SAAS,EAAE,CAAC,EAAE,GAAG,MAAM,CAAC,QAAQ,CAAC,SAAS,KAAK,IAAI,GAAG,EAAE,GAAG,iBAAiB;AACpF,QAAQ,OAAO;AACf,QAAQ,KAAK,EAAE,OAAO,GAAG,WAAW,GAAG,SAAS;AAChD,OAAO,CAAC;AACR,MAAM,IAAI,WAAW,EAAE;AACvB,QAAQ,IAAI,CAAC,OAAO,GAAG,CAAC,KAAK,KAAK,WAAW,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;AAC3D,OAAO;AACP,MAAM,OAAO,IAAI,CAAC;AAClB,KAAK,CAAC,CAAC;AACP,IAAI,MAAM,KAAK,GAAG,EAAE,CAAC;AACrB,IAAI,MAAM,YAAY,mBAAmB,IAAI,GAAG,EAAE,CAAC;AACnD,IAAI,MAAM,SAAS,GAAG,CAAC,GAAG,cAAc,CAAC,CAAC;AAC1C,IAAI,OAAO,SAAS,CAAC,MAAM,GAAG,CAAC,EAAE;AACjC,MAAM,MAAM,SAAS,GAAG,SAAS,CAAC,GAAG,EAAE,CAAC;AACxC,MAAM,MAAM,MAAM,GAAG,QAAQ,CAAC,SAAS,CAAC,CAAC;AACzC,MAAM,YAAY,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;AAClC,MAAM,IAAI,MAAM,EAAE;AAClB,QAAQ,CAAC,EAAE,GAAG,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,GAAG,MAAM,CAAC,SAAS,KAAK,IAAI,GAAG,KAAK,CAAC,GAAG,EAAE,CAAC,OAAO,CAAC,CAAC,GAAG,KAAK;AACjG,UAAU,IAAI,GAAG,CAAC;AAClB,UAAU,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,SAAS,CAAC,EAAE;AACxC,YAAY,OAAO;AACnB,WAAW;AACX,UAAU,IAAI,SAAS,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE;AAC1D,YAAY,OAAO;AACnB,WAAW;AACX,UAAU,IAAI,KAAK,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,IAAI,KAAK,GAAG,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC,EAAE,IAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;AAC/G,YAAY,OAAO;AACnB,WAAW;AACX,UAAU,IAAI,CAAC,cAAc,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,GAAG,CAAC,SAAS,CAAC,EAAE;AACnE,YAAY,IAAI,cAAc,EAAE;AAChC,cAAc,MAAM,IAAI,GAAG,CAAC,GAAG,GAAG,aAAa,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,KAAK,CAAC,KAAK,GAAG,CAAC,IAAI,IAAI,CAAC,KAAK,GAAG,CAAC,IAAI,CAAC,KAAK,IAAI,GAAG,GAAG,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;AAC/H,cAAc,MAAM,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC;AAClC,cAAc,KAAK,CAAC,IAAI,CAAC;AACzB,gBAAgB,IAAI,EAAE,IAAI,KAAK,GAAG,CAAC,IAAI,GAAG,SAAS,GAAG,GAAG,CAAC,SAAS;AACnE,gBAAgB,EAAE,EAAE,IAAI,KAAK,GAAG,CAAC,IAAI,GAAG,GAAG,CAAC,SAAS,GAAG,SAAS;AACjE,gBAAgB,SAAS,EAAE,IAAI;AAC/B,gBAAgB,KAAK,EAAE,SAAS;AAChC,eAAe,CAAC,CAAC;AACjB,aAAa,MAAM;AACnB,cAAc,KAAK,CAAC,IAAI,CAAC;AACzB,gBAAgB,IAAI,EAAE,SAAS;AAC/B,gBAAgB,EAAE,EAAE,GAAG,CAAC,SAAS;AACjC,gBAAgB,SAAS,EAAE,CAAC,GAAG,CAAC,IAAI,CAAC;AACrC,gBAAgB,KAAK,EAAE,SAAS;AAChC,eAAe,CAAC,CAAC;AACjB,aAAa;AACb,WAAW;AACX,UAAU,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,GAAG,CAAC,SAAS,CAAC,EAAE;AAChD,YAAY,SAAS,CAAC,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;AAC1C,YAAY,YAAY,CAAC,GAAG,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;AAC5C,WAAW;AACX,SAAS,CAAC,CAAC;AACX,OAAO;AACP,KAAK;AACL,IAAI,gBAAgB,CAAC,EAAE,KAAK,EAAE,KAAK,EAAE,CAAC,CAAC;AACvC,GAAG,EAAE,GAAG,EAAE;AACV,IAAI,QAAQ;AACZ,IAAI,cAAc;AAClB,IAAI,KAAK;AACT,IAAI,SAAS;AACb,IAAI,cAAc;AAClB,IAAI,cAAc;AAClB,IAAI,WAAW;AACf,IAAI,aAAa;AACjB,GAAG,CAAC,CAAC;AACL,EAAE,OAAO;AACT,IAAI,OAAO;AACX,IAAI,KAAK;AACT,IAAI,GAAG,aAAa;AACpB,GAAG,CAAC;AACJ;;AC5FA,MAAM,SAAS,GAAGC,YAAU,CAAC,CAAC,KAAK,MAAM;AACzC,EAAE,QAAQ,EAAE;AACZ,IAAI,QAAQ,EAAE,UAAU;AACxB,IAAI,IAAI,EAAE,KAAK;AACf,IAAI,GAAG,EAAE,KAAK;AACd,IAAI,UAAU,EAAE,OAAO;AACvB,IAAI,SAAS,EAAE,OAAO;AACtB,GAAG;AACH,EAAE,SAAS,EAAE;AACb,IAAI,QAAQ,EAAE,UAAU;AACxB,IAAI,KAAK,EAAE,MAAM;AACjB,IAAI,OAAO,EAAE,MAAM;AACnB,IAAI,aAAa,EAAE,QAAQ;AAC3B,GAAG;AACH,EAAE,KAAK,EAAE;AACT,IAAI,KAAK,EAAE,MAAM;AACjB,IAAI,IAAI,EAAE,CAAC;AACX,IAAI,oBAAoB,EAAE;AAC1B,MAAM,UAAU,EAAE,yBAAyB;AAC3C,KAAK;AACL,IAAI,0BAA0B,EAAE;AAChC,MAAM,MAAM,EAAE,CAAC,wBAAwB,EAAE,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,CAAC;AACvE,KAAK;AACL,IAAI,wBAAwB,EAAE;AAC9B,MAAM,UAAU,EAAE,cAAc;AAChC,KAAK;AACL,GAAG;AACH,CAAC,CAAC,CAAC,CAAC;AACQ,MAAC,oBAAoB,GAAG,CAAC,KAAK,KAAK;AAC/C,EAAE,MAAM;AACR,IAAI,eAAe;AACnB,IAAI,QAAQ,GAAG,MAAM,CAAC,iBAAiB;AACvC,IAAI,cAAc,GAAG,IAAI;AACzB,IAAI,cAAc,GAAG,IAAI;AACzB,IAAI,KAAK;AACT,IAAI,SAAS;AACb,IAAI,SAAS,GAAG,SAAS,CAAC,UAAU;AACpC,IAAI,WAAW;AACf,IAAI,aAAa,GAAG,kBAAkB;AACtC,IAAI,SAAS;AACb,IAAI,IAAI,GAAG,SAAS;AACpB,IAAI,UAAU;AACd,IAAI,WAAW;AACf,GAAG,GAAG,KAAK,CAAC;AACZ,EAAE,MAAM,KAAK,GAAG,QAAQ,EAAE,CAAC;AAC3B,EAAE,MAAM,OAAO,GAAG,SAAS,EAAE,CAAC;AAC9B,EAAE,MAAM,cAAc,GAAG,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,eAAe,CAAC,GAAG,eAAe,GAAG,CAAC,eAAe,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC,KAAK,kBAAkB,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,eAAe,CAAC,CAAC,CAAC;AACpK,EAAE,MAAM,QAAQ,GAAG,MAAM,CAAC,WAAW,CAAC,CAAC;AACvC,EAAE,MAAM,EAAE,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,GAAG,8BAA8B,CAAC;AAC1E,IAAI,cAAc;AAClB,IAAI,QAAQ;AACZ,IAAI,cAAc;AAClB,IAAI,cAAc;AAClB,IAAI,KAAK;AACT,IAAI,SAAS;AACb,IAAI,WAAW;AACf,IAAI,aAAa;AACjB,GAAG,CAAC,CAAC;AACL,EAAE,SAAS,CAAC,MAAM;AAClB,IAAI,IAAI,KAAK,EAAE;AACf,MAAM,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;AAC3B,KAAK;AACL,GAAG,EAAE,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAC,CAAC;AACxB,EAAE,uBAAuB,KAAK,CAAC,aAAa,CAAC,KAAK,EAAE;AACpD,IAAI,SAAS,EAAE,UAAU,CAAC,OAAO,CAAC,SAAS,EAAE,SAAS,CAAC;AACvD,GAAG,EAAE,OAAO,oBAAoB,KAAK,CAAC,aAAa,CAAC,gBAAgB,EAAE;AACtE,IAAI,SAAS,EAAE,OAAO,CAAC,QAAQ;AAC/B,GAAG,CAAC,EAAE,KAAK,IAAI,KAAK,oBAAoB,KAAK,CAAC,aAAa,CAAC,eAAe,EAAE;AAC7E,IAAI,KAAK;AACT,IAAI,KAAK;AACT,IAAI,UAAU,EAAE,UAAU,IAAI,UAAU;AACxC,IAAI,WAAW,EAAE,WAAW,IAAI,WAAW;AAC3C,IAAI,SAAS;AACb,IAAI,SAAS,EAAE,OAAO,CAAC,KAAK;AAC5B,IAAI,QAAQ,EAAE,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC;AAC9B,IAAI,QAAQ,EAAE,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC;AAC9B,IAAI,aAAa,EAAE,oBAAoB,CAAC,aAAa,CAAC,KAAK;AAC3D,IAAI,WAAW,EAAE,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC;AACjC,IAAI,IAAI;AACR,GAAG,CAAC,CAAC,CAAC;AACN;;AC5FY,MAAC,oBAAoB,GAAG,cAAc,CAAC;AACnD,EAAE,EAAE,EAAE,eAAe;AACrB,CAAC,EAAE;AACI,MAAM,qBAAqB,GAAG,sBAAsB,CAAC;AAC5D,EAAE,EAAE,EAAE,gBAAgB;AACtB,EAAE,MAAM,EAAE,CAAC,WAAW,EAAE,MAAM,EAAE,MAAM,CAAC;AACvC,EAAE,QAAQ,EAAE,IAAI;AAChB,CAAC,CAAC;;ACTU,MAAC,kBAAkB,GAAG,YAAY,CAAC;AAC/C,EAAE,EAAE,EAAE,eAAe;AACrB,EAAE,MAAM,EAAE;AACV,IAAI,YAAY,EAAE,oBAAoB;AACtC,GAAG;AACH,EAAE,cAAc,EAAE;AAClB,IAAI,aAAa,EAAE,qBAAqB;AACxC,GAAG;AACH,CAAC;;ACJW,MAAC,sBAAsB,GAAG,kBAAkB,CAAC,OAAO,CAAC,wBAAwB,CAAC;AAC1F,EAAE,IAAI,EAAE,wBAAwB;AAChC,EAAE,SAAS,EAAE;AACb,IAAI,IAAI,EAAE,MAAM,OAAO,6BAA+B,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,gBAAgB,CAAC;AACvF,GAAG;AACH,CAAC,CAAC,EAAE;AACQ,MAAC,gBAAgB,GAAG,kBAAkB,CAAC,OAAO,CAAC,uBAAuB,CAAC;AACnF,EAAE,IAAI,EAAE,kBAAkB;AAC1B,EAAE,SAAS,EAAE,MAAM,OAAO,6BAA+B,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,gBAAgB,CAAC;AAC1F,EAAE,UAAU,EAAE,oBAAoB;AAClC,CAAC,CAAC;;;;"}