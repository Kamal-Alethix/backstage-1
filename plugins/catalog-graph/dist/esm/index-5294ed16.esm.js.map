{"version":3,"file":"index-5294ed16.esm.js","sources":["../../src/components/CatalogGraphCard/CatalogGraphCard.tsx"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  getCompoundEntityRef,\n  parseEntityRef,\n  stringifyEntityRef,\n} from '@backstage/catalog-model';\nimport { InfoCard, InfoCardVariants } from '@backstage/core-components';\nimport { useAnalytics, useRouteRef } from '@backstage/core-plugin-api';\nimport {\n  humanizeEntityRef,\n  useEntity,\n  entityRouteRef,\n} from '@backstage/plugin-catalog-react';\nimport { makeStyles, Theme } from '@material-ui/core';\nimport qs from 'qs';\nimport React, { MouseEvent, useCallback } from 'react';\nimport { useNavigate } from 'react-router';\nimport { catalogGraphRouteRef } from '../../routes';\nimport {\n  ALL_RELATION_PAIRS,\n  Direction,\n  EntityNode,\n  EntityRelationsGraph,\n  RelationPairs,\n} from '../EntityRelationsGraph';\n\nconst useStyles = makeStyles<Theme, { height: number | undefined }>({\n  card: ({ height }) => ({\n    display: 'flex',\n    flexDirection: 'column',\n    maxHeight: height,\n    minHeight: height,\n  }),\n  graph: {\n    flex: 1,\n    minHeight: 0,\n  },\n});\n\nexport const CatalogGraphCard = (props: {\n  variant?: InfoCardVariants;\n  relationPairs?: RelationPairs;\n  maxDepth?: number;\n  unidirectional?: boolean;\n  mergeRelations?: boolean;\n  kinds?: string[];\n  relations?: string[];\n  direction?: Direction;\n  height?: number;\n  title?: string;\n  zoom?: 'enabled' | 'disabled' | 'enable-on-click';\n}) => {\n  const {\n    variant = 'gridItem',\n    relationPairs = ALL_RELATION_PAIRS,\n    maxDepth = 1,\n    unidirectional = true,\n    mergeRelations = true,\n    kinds,\n    relations,\n    direction = Direction.LEFT_RIGHT,\n    height,\n    title = 'Relations',\n    zoom = 'enable-on-click',\n  } = props;\n\n  const { entity } = useEntity();\n  const entityName = getCompoundEntityRef(entity);\n  const catalogEntityRoute = useRouteRef(entityRouteRef);\n  const catalogGraphRoute = useRouteRef(catalogGraphRouteRef);\n  const navigate = useNavigate();\n  const classes = useStyles({ height });\n  const analytics = useAnalytics();\n\n  const onNodeClick = useCallback(\n    (node: EntityNode, _: MouseEvent<unknown>) => {\n      const nodeEntityName = parseEntityRef(node.id);\n      const path = catalogEntityRoute({\n        kind: nodeEntityName.kind.toLocaleLowerCase('en-US'),\n        namespace: nodeEntityName.namespace.toLocaleLowerCase('en-US'),\n        name: nodeEntityName.name,\n      });\n      analytics.captureEvent(\n        'click',\n        node.title ?? humanizeEntityRef(nodeEntityName),\n        { attributes: { to: path } },\n      );\n      navigate(path);\n    },\n    [catalogEntityRoute, navigate, analytics],\n  );\n\n  const catalogGraphParams = qs.stringify(\n    { rootEntityRefs: [stringifyEntityRef(entity)] },\n    { arrayFormat: 'brackets', addQueryPrefix: true },\n  );\n  const catalogGraphUrl = `${catalogGraphRoute()}${catalogGraphParams}`;\n\n  return (\n    <InfoCard\n      title={title}\n      cardClassName={classes.card}\n      variant={variant}\n      noPadding\n      deepLink={{\n        title: 'View graph',\n        link: catalogGraphUrl,\n      }}\n    >\n      <EntityRelationsGraph\n        rootEntityNames={entityName}\n        maxDepth={maxDepth}\n        unidirectional={unidirectional}\n        mergeRelations={mergeRelations}\n        kinds={kinds}\n        relations={relations}\n        direction={direction}\n        onNodeClick={onNodeClick}\n        className={classes.graph}\n        relationPairs={relationPairs}\n        zoom={zoom}\n      />\n    </InfoCard>\n  );\n};\n"],"names":[],"mappings":"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"}