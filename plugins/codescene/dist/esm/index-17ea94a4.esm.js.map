{"version":3,"file":"index-17ea94a4.esm.js","sources":["../../src/components/ProjectsComponent/ProjectsComponent.tsx","../../src/components/CodeScenePageComponent/CodeScenePageComponent.tsx"],"sourcesContent":["/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react';\nimport {\n  Content,\n  ContentHeader,\n  Progress,\n  ItemCardHeader,\n} from '@backstage/core-components';\nimport { useRouteRef, useApi } from '@backstage/core-plugin-api';\nimport Alert from '@material-ui/lab/Alert';\nimport useAsync from 'react-use/lib/useAsync';\nimport { Link as RouterLink } from 'react-router-dom';\nimport { rootRouteRef } from '../../routes';\nimport { codesceneApiRef } from '../../api/api';\nimport { Project, Analysis } from '../../api/types';\nimport {\n  Grid,\n  Card,\n  CardActionArea,\n  Input,\n  makeStyles,\n  CardContent,\n  Chip,\n  CardActions,\n} from '@material-ui/core';\n\nconst useStyles = makeStyles(() => ({\n  overflowXScroll: {\n    overflowX: 'scroll',\n  },\n}));\n\nfunction matchFilter(filter?: string): (entry: Project) => boolean {\n  const terms = filter\n    ?.toLocaleLowerCase('en-US')\n    .split(/\\s/)\n    .map(e => e.trim())\n    .filter(Boolean);\n\n  if (!terms?.length) {\n    return () => true;\n  }\n\n  return entry => {\n    const text = `${entry.name} ${entry.description || ''}`.toLocaleLowerCase(\n      'en-US',\n    );\n    return terms.every(term => text.includes(term));\n  };\n}\n\nfunction topLanguages(analysis: Analysis, coerceAtMost: number): string[] {\n  return analysis.file_summary\n    .sort((a, b) => b.code - a.code)\n    .map(fileSummary => fileSummary.language)\n    .slice(0, coerceAtMost);\n}\n\ntype ProjectAndAnalysis = {\n  project: Project;\n  analysis?: Analysis;\n};\n\nexport const ProjectsComponent = () => {\n  const routeRef = useRouteRef(rootRouteRef);\n  const codesceneApi = useApi(codesceneApiRef);\n\n  const classes = useStyles();\n  const [searchText, setSearchText] = React.useState('');\n  const {\n    value: projectsWithAnalyses,\n    loading,\n    error,\n  } = useAsync(async (): Promise<Record<number, ProjectAndAnalysis>> => {\n    const projects = (await codesceneApi.fetchProjects()).projects;\n\n    const promises = projects.map(project =>\n      codesceneApi.fetchLatestAnalysis(project.id),\n    );\n    // analyses associates project IDs with their latests analysis\n    const analyses: Record<number, Analysis> = await Promise.allSettled(\n      promises,\n    ).then(results => {\n      return results\n        .filter(result => result.status === 'fulfilled')\n        .map(result => result as PromiseFulfilledResult<Analysis>)\n        .map(result => result.value)\n        .reduce(\n          (acc, analysis) => ({ ...acc, [analysis.project_id]: analysis }),\n          {},\n        );\n    });\n    return projects.reduce(\n      (acc, project) => ({\n        ...acc,\n        [project.id]: {\n          project: project,\n          analysis: analyses[project.id],\n        },\n      }),\n      {},\n    );\n  }, []);\n\n  if (loading) {\n    return <Progress />;\n  } else if (error) {\n    return <Alert severity=\"error\">{error.message}</Alert>;\n  } else if (\n    !projectsWithAnalyses ||\n    Object.keys(projectsWithAnalyses).length === 0\n  ) {\n    return <Alert severity=\"error\">No projects found!</Alert>;\n  }\n\n  const projects = Object.values(projectsWithAnalyses)\n    .map(p => p.project)\n    .sort((a, b) => a.name.localeCompare(b.name));\n\n  const cards = projects.filter(matchFilter(searchText)).map(project => {\n    const analysis = projectsWithAnalyses[project.id].analysis;\n    const subtitle = analysis\n      ? `Last analysis: ${analysis.readable_analysis_time} · Score: ${analysis.high_level_metrics.current_score} · Active authors: ${analysis.high_level_metrics.active_developers}`\n      : undefined;\n    const chips = analysis\n      ? topLanguages(analysis, 3).map(lang => (\n          <Chip label={lang} key={lang} size=\"small\" />\n        ))\n      : undefined;\n    return (\n      <Grid key={project.id} item xs={3}>\n        <Card>\n          <CardActionArea\n            style={{\n              height: '100%',\n              overflow: 'hidden',\n              width: '100%',\n            }}\n            component={RouterLink}\n            to={`${routeRef()}/${project.id}`}\n          >\n            <ItemCardHeader title={project.name} />\n            <CardContent>{subtitle}</CardContent>\n            <CardActions disableSpacing>{chips}</CardActions>\n          </CardActionArea>\n        </Card>\n      </Grid>\n    );\n  });\n\n  return (\n    <Content className={classes.overflowXScroll}>\n      <ContentHeader title=\"Projects\">\n        <Input\n          id=\"projects-filter\"\n          type=\"search\"\n          placeholder=\"Filter\"\n          onChange={e => setSearchText(e.target.value)}\n        />\n      </ContentHeader>\n      <Grid container>{cards}</Grid>\n    </Content>\n  );\n};\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react';\nimport { Grid } from '@material-ui/core';\nimport {\n  Header,\n  Page,\n  Content,\n  SupportButton,\n} from '@backstage/core-components';\nimport { ProjectsComponent } from '../ProjectsComponent';\n\nexport const CodeScenePageComponent = () => (\n  <Page themeId=\"tool\">\n    <Header\n      title=\"CodeScene\"\n      subtitle=\"See hidden risks and social patterns in your code. Prioritize and reduce\n        technical debt.\"\n    >\n      <SupportButton />\n    </Header>\n    <Content>\n      <Grid container spacing={3} direction=\"column\">\n        <Grid item>\n          <ProjectsComponent />\n        </Grid>\n      </Grid>\n    </Content>\n  </Page>\n);\n"],"names":["React","RouterLink"],"mappings":"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"}