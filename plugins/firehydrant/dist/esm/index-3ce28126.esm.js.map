{"version":3,"file":"index-3ce28126.esm.js","sources":["../../src/api/index.ts","../../src/routes.ts","../../src/plugin.ts"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {\n  ServiceAnalyticsResponse,\n  ServiceDetailsResponse,\n  ServiceIncidentsResponse,\n} from './types';\nimport { Incident, Service } from '../components/types';\nimport { createApiRef, DiscoveryApi } from '@backstage/core-plugin-api';\n\nexport interface FireHydrantAPI {\n  getServiceAnalytics(options: {\n    serviceId: string;\n    startDate: string;\n    endDate: string;\n  }): Promise<ServiceAnalyticsResponse>;\n\n  getServiceDetails(options: {\n    serviceName: string;\n  }): Promise<ServiceDetailsResponse>;\n\n  getServiceIncidents(options: {\n    serviceId: string;\n  }): Promise<ServiceIncidentsResponse>;\n}\n\nexport const fireHydrantApiRef = createApiRef<FireHydrantAPI>({\n  id: 'plugin.firehydrant.service',\n});\n\nexport type Options = {\n  discoveryApi: DiscoveryApi;\n  proxyPath?: string;\n};\n\nconst DEFAULT_PROXY_PATH = '/firehydrant/api';\n\nexport class FireHydrantAPIClient implements FireHydrantAPI {\n  private readonly discoveryApi: DiscoveryApi;\n  private readonly proxyPath: string;\n\n  constructor(options: Options) {\n    this.discoveryApi = options.discoveryApi;\n    this.proxyPath = options.proxyPath ?? DEFAULT_PROXY_PATH;\n  }\n\n  async getServiceAnalytics(options: {\n    serviceId: string;\n    startDate: string;\n    endDate: string;\n  }): Promise<ServiceAnalyticsResponse> {\n    const proxyUrl = await this.getApiUrl();\n    const response = await fetch(\n      `${proxyUrl}/metrics/services/${options.serviceId}?start_date=${options.startDate}&end_date=${options.endDate}`,\n    );\n    if (!response.ok) {\n      throw new Error(\n        `There was a problem fetching FireHydrant analytics data: ${response.statusText}`,\n      );\n    }\n    const json = await response.json();\n    return json;\n  }\n\n  async getServiceDetails(options: {\n    serviceName: string;\n  }): Promise<ServiceDetailsResponse> {\n    const proxyUrl = await this.getApiUrl();\n    const response = await fetch(\n      `${proxyUrl}/services?query=${options.serviceName}`,\n    );\n\n    if (!response.ok) {\n      throw new Error(\n        `There was a problem fetching FireHydrant data: ${response.statusText}`,\n      );\n    }\n\n    const json = await response.json();\n\n    const servicesData: ServiceDetailsResponse = {\n      service: {} as Service,\n      incidents: [] as Incident[],\n    };\n\n    if (json.data?.length === 0) {\n      return servicesData;\n    }\n\n    servicesData.service = json.data[0];\n\n    const incidentsJson = await this.getServiceIncidents({\n      serviceId: json.data[0].id,\n    });\n\n    servicesData.incidents = incidentsJson;\n\n    return servicesData;\n  }\n\n  async getServiceIncidents(options: {\n    serviceId: string;\n  }): Promise<ServiceIncidentsResponse> {\n    const proxyUrl = await this.getApiUrl();\n    const response = await fetch(\n      `${proxyUrl}/incidents?services=${options.serviceId}&active=true`,\n    );\n    if (!response.ok) {\n      throw new Error(\n        `There was a problem fetching FireHydrant incidents data: ${response.statusText}`,\n      );\n    }\n\n    const json = await response.json();\n    return json.data;\n  }\n\n  private async getApiUrl() {\n    const proxyUrl = await this.discoveryApi.getBaseUrl('proxy');\n    return proxyUrl + this.proxyPath;\n  }\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { createRouteRef } from '@backstage/core-plugin-api';\n\nexport const rootRouteRef = createRouteRef({\n  id: 'firehydrant',\n});\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { fireHydrantApiRef, FireHydrantAPIClient } from './api';\nimport {\n  createApiFactory,\n  createPlugin,\n  discoveryApiRef,\n  createComponentExtension,\n} from '@backstage/core-plugin-api';\n\nimport { rootRouteRef } from './routes';\n\nexport const firehydrantPlugin = createPlugin({\n  id: 'firehydrant',\n  apis: [\n    createApiFactory({\n      api: fireHydrantApiRef,\n      deps: { discoveryApi: discoveryApiRef },\n      factory: ({ discoveryApi }) => new FireHydrantAPIClient({ discoveryApi }),\n    }),\n  ],\n  routes: {\n    root: rootRouteRef,\n  },\n});\n\nexport const FirehydrantCard = firehydrantPlugin.provide(\n  createComponentExtension({\n    name: 'FirehydrantCard',\n    component: {\n      lazy: () =>\n        import('./components/ServiceDetailsCard').then(\n          m => m.ServiceDetailsCard,\n        ),\n    },\n  }),\n);\n"],"names":[],"mappings":"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"}