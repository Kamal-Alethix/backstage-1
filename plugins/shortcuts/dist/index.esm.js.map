{"version":3,"file":"index.esm.js","sources":["../src/api/LocalStoredShortcuts.ts","../src/api/ShortcutApi.ts","../src/plugin.ts"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { pageTheme } from '@backstage/theme';\nimport ObservableImpl from 'zen-observable';\nimport { v4 as uuid } from 'uuid';\nimport { ShortcutApi } from './ShortcutApi';\nimport { Shortcut } from '../types';\nimport { StorageApi } from '@backstage/core-plugin-api';\n\n/**\n * Implementation of the ShortcutApi that uses the StorageApi to store shortcuts.\n */\nexport class LocalStoredShortcuts implements ShortcutApi {\n  constructor(private readonly storageApi: StorageApi) {}\n\n  shortcut$() {\n    return this.observable;\n  }\n\n  async add(shortcut: Omit<Shortcut, 'id'>) {\n    const shortcuts = this.get();\n    shortcuts.push({ ...shortcut, id: uuid() });\n\n    await this.storageApi.set('items', shortcuts);\n    this.notify();\n  }\n\n  async remove(id: string) {\n    const shortcuts = this.get().filter(s => s.id !== id);\n\n    await this.storageApi.set('items', shortcuts);\n    this.notify();\n  }\n\n  async update(shortcut: Shortcut) {\n    const shortcuts = this.get().filter(s => s.id !== shortcut.id);\n    shortcuts.push(shortcut);\n\n    await this.storageApi.set('items', shortcuts);\n    this.notify();\n  }\n\n  getColor(url: string) {\n    const type = url.split('/')[1];\n    const theme =\n      this.THEME_MAP[type] ??\n      (Object.keys(pageTheme).includes(type) ? type : 'tool');\n\n    return pageTheme[theme].colors[0];\n  }\n\n  private subscribers = new Set<\n    ZenObservable.SubscriptionObserver<Shortcut[]>\n  >();\n\n  private readonly observable = new ObservableImpl<Shortcut[]>(subscriber => {\n    subscriber.next(this.get());\n    this.subscribers.add(subscriber);\n\n    return () => {\n      this.subscribers.delete(subscriber);\n    };\n  });\n\n  private readonly THEME_MAP: Record<string, keyof typeof pageTheme> = {\n    catalog: 'home',\n    docs: 'documentation',\n  };\n\n  private get() {\n    return Array.from(\n      this.storageApi.snapshot<Shortcut[]>('items').value ?? [],\n    ).sort((a, b) => (a.title >= b.title ? 1 : -1));\n  }\n\n  private notify() {\n    for (const subscription of this.subscribers) {\n      subscription.next(this.get());\n    }\n  }\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Shortcut } from '../types';\nimport { createApiRef } from '@backstage/core-plugin-api';\nimport { Observable } from '@backstage/types';\n\nexport const shortcutsApiRef = createApiRef<ShortcutApi>({\n  id: 'plugin.shortcuts.api',\n});\n\nexport interface ShortcutApi {\n  /**\n   * Returns an Observable that will subscribe to changes.\n   */\n  shortcut$(): Observable<Shortcut[]>;\n\n  /**\n   * Generates a unique id for the shortcut and then saves it.\n   */\n  add(shortcut: Omit<Shortcut, 'id'>): Promise<void>;\n\n  /**\n   * Removes the shortcut.\n   */\n  remove(id: string): Promise<void>;\n\n  /**\n   * Finds an existing shortcut that matches the ID of the\n   * supplied shortcut and updates its values.\n   */\n  update(shortcut: Shortcut): Promise<void>;\n\n  /**\n   * Each shortcut should get a color for its icon based on the url.\n   *\n   * Preferably using some abstraction between the url and the actual\n   * color value.\n   */\n  getColor(url: string): string;\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { LocalStoredShortcuts, shortcutsApiRef } from './api';\nimport {\n  createApiFactory,\n  createComponentExtension,\n  createPlugin,\n  storageApiRef,\n} from '@backstage/core-plugin-api';\n\nexport const shortcutsPlugin = createPlugin({\n  id: 'shortcuts',\n  apis: [\n    createApiFactory({\n      api: shortcutsApiRef,\n      deps: { storageApi: storageApiRef },\n      factory: ({ storageApi }) =>\n        new LocalStoredShortcuts(storageApi.forBucket('shortcuts')),\n    }),\n  ],\n});\n\nexport const Shortcuts = shortcutsPlugin.provide(\n  createComponentExtension({\n    name: 'Shortcuts',\n    component: { lazy: () => import('./Shortcuts').then(m => m.Shortcuts) },\n  }),\n);\n"],"names":["uuid"],"mappings":"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"}