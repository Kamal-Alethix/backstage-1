{"version":3,"file":"index-8dbceb1f.esm.js","sources":["../../src/hooks/usePullRequests.ts","../../src/components/PullRequestStatusButtonGroup/PullRequestStatusButtonGroup.tsx","../../src/components/PullRequestTable/PullRequestTable.tsx","../../src/components/EntityPageAzurePullRequests/EntityPageAzurePullRequests.tsx"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  PullRequest,\n  PullRequestOptions,\n  PullRequestStatus,\n} from '@backstage/plugin-azure-devops-common';\n\nimport { AZURE_DEVOPS_DEFAULT_TOP } from '../constants';\nimport { Entity } from '@backstage/catalog-model';\nimport { azureDevOpsApiRef } from '../api';\nimport { useApi } from '@backstage/core-plugin-api';\nimport useAsync from 'react-use/lib/useAsync';\nimport { useProjectRepoFromEntity } from './useProjectRepoFromEntity';\n\nexport function usePullRequests(\n  entity: Entity,\n  defaultLimit?: number,\n  requestedStatus?: PullRequestStatus,\n): {\n  items?: PullRequest[];\n  loading: boolean;\n  error?: Error;\n} {\n  const top = defaultLimit ?? AZURE_DEVOPS_DEFAULT_TOP;\n  const status = requestedStatus ?? PullRequestStatus.Active;\n  const options: PullRequestOptions = {\n    top,\n    status,\n  };\n\n  const api = useApi(azureDevOpsApiRef);\n  const { project, repo } = useProjectRepoFromEntity(entity);\n\n  const { value, loading, error } = useAsync(() => {\n    return api.getPullRequests(project, repo, options);\n  }, [api, project, repo, top, status]);\n\n  return {\n    items: value?.items,\n    loading,\n    error,\n  };\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Button, ButtonGroup } from '@material-ui/core';\n\nimport { PullRequestStatus } from '@backstage/plugin-azure-devops-common';\nimport React from 'react';\n\nexport const PullRequestStatusButtonGroup = ({\n  status,\n  setStatus,\n}: {\n  status: PullRequestStatus;\n  setStatus: (pullRequestStatus: PullRequestStatus) => void;\n}) => {\n  return (\n    <ButtonGroup aria-label=\"outlined button group\">\n      <Button\n        color={status === PullRequestStatus.Active ? 'primary' : 'default'}\n        onClick={() => {\n          setStatus(PullRequestStatus.Active);\n        }}\n      >\n        Active\n      </Button>\n      <Button\n        color={status === PullRequestStatus.Completed ? 'primary' : 'default'}\n        onClick={() => {\n          setStatus(PullRequestStatus.Completed);\n        }}\n      >\n        Completed\n      </Button>\n      <Button\n        color={status === PullRequestStatus.Abandoned ? 'primary' : 'default'}\n        onClick={() => {\n          setStatus(PullRequestStatus.Abandoned);\n        }}\n      >\n        Abandoned\n      </Button>\n    </ButtonGroup>\n  );\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Box, Chip } from '@material-ui/core';\nimport {\n  Link,\n  ResponseErrorPanel,\n  Table,\n  TableColumn,\n} from '@backstage/core-components';\nimport {\n  PullRequest,\n  PullRequestStatus,\n} from '@backstage/plugin-azure-devops-common';\nimport React, { useState } from 'react';\n\nimport { AzurePullRequestsIcon } from '../AzurePullRequestsIcon';\nimport { DateTime } from 'luxon';\nimport { PullRequestStatusButtonGroup } from '../PullRequestStatusButtonGroup';\nimport { useEntity } from '@backstage/plugin-catalog-react';\nimport { usePullRequests } from '../../hooks/usePullRequests';\n\nconst columns: TableColumn[] = [\n  {\n    title: 'ID',\n    field: 'pullRequestId',\n    highlight: false,\n    width: 'auto',\n  },\n  {\n    title: 'Title',\n    field: 'title',\n    width: 'auto',\n    render: (row: Partial<PullRequest>) => (\n      <Box display=\"flex\" alignItems=\"center\">\n        <Link to={row.link ?? ''}>{row.title}</Link>\n        {row.isDraft && (\n          <Box paddingLeft={1}>\n            <Chip\n              label=\"Draft\"\n              variant=\"outlined\"\n              color=\"secondary\"\n              size=\"small\"\n            />\n          </Box>\n        )}\n      </Box>\n    ),\n  },\n  {\n    title: 'Source',\n    field: 'sourceRefName',\n    width: 'auto',\n  },\n  {\n    title: 'Target',\n    field: 'targetRefName',\n    width: 'auto',\n  },\n  {\n    title: 'Created By',\n    field: 'createdBy',\n    width: 'auto',\n  },\n  {\n    title: 'Created',\n    field: 'creationDate',\n    width: 'auto',\n    render: (row: Partial<PullRequest>) =>\n      (row.creationDate\n        ? DateTime.fromISO(row.creationDate)\n        : DateTime.now()\n      ).toRelative(),\n  },\n];\n\ntype PullRequestTableProps = {\n  defaultLimit?: number;\n};\n\nexport const PullRequestTable = ({ defaultLimit }: PullRequestTableProps) => {\n  const [pullRequestStatusState, setPullRequestStatusState] =\n    useState<PullRequestStatus>(PullRequestStatus.Active);\n  const { entity } = useEntity();\n\n  const { items, loading, error } = usePullRequests(\n    entity,\n    defaultLimit,\n    pullRequestStatusState,\n  );\n\n  if (error) {\n    return <ResponseErrorPanel error={error} />;\n  }\n\n  return (\n    <Table\n      isLoading={loading}\n      columns={columns}\n      options={{\n        search: true,\n        paging: true,\n        pageSize: 5,\n        showEmptyDataSourceMessage: !loading,\n      }}\n      title={\n        <Box display=\"flex\" alignItems=\"center\">\n          <AzurePullRequestsIcon style={{ fontSize: 30 }} />\n          <Box mr={1} />\n          Azure Repos - Pull Requests ({items ? items.length : 0})\n          <Box position=\"absolute\" right={320} top={20}>\n            <PullRequestStatusButtonGroup\n              status={pullRequestStatusState}\n              setStatus={setPullRequestStatusState}\n            />\n          </Box>\n        </Box>\n      }\n      data={items ?? []}\n    />\n  );\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { PullRequestTable } from '../PullRequestTable/PullRequestTable';\nimport React from 'react';\n\nexport const EntityPageAzurePullRequests = ({\n  defaultLimit,\n}: {\n  defaultLimit?: number;\n}) => {\n  return <PullRequestTable defaultLimit={defaultLimit} />;\n};\n"],"names":[],"mappings":"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"}