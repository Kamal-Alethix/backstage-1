{"version":3,"file":"GithubDeploymentsCard-489b944e.esm.js","sources":["../../src/components/GithubDeploymentsCard.tsx"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react';\nimport useAsyncRetry from 'react-use/lib/useAsyncRetry';\nimport { GithubDeployment, githubDeploymentsApiRef } from '../api';\nimport { useEntity } from '@backstage/plugin-catalog-react';\nimport {\n  GITHUB_PROJECT_SLUG_ANNOTATION,\n  isGithubDeploymentsAvailable,\n} from '../Router';\nimport { GithubDeploymentsTable } from './GithubDeploymentsTable/GithubDeploymentsTable';\nimport {\n  ANNOTATION_LOCATION,\n  ANNOTATION_SOURCE_LOCATION,\n} from '@backstage/catalog-model';\n\nimport {\n  MissingAnnotationEmptyState,\n  ResponseErrorPanel,\n  TableColumn,\n} from '@backstage/core-components';\nimport { useApi } from '@backstage/core-plugin-api';\n\nconst GithubDeploymentsComponent = ({\n  projectSlug,\n  last,\n  lastStatuses,\n  columns,\n  host,\n}: {\n  projectSlug: string;\n  last: number;\n  lastStatuses: number;\n  columns: TableColumn<GithubDeployment>[];\n  host: string | undefined;\n}) => {\n  const api = useApi(githubDeploymentsApiRef);\n  const [owner, repo] = projectSlug.split('/');\n\n  const {\n    loading,\n    value,\n    error,\n    retry: reload,\n  } = useAsyncRetry(\n    async () =>\n      await api.listDeployments({\n        host,\n        owner,\n        repo,\n        last,\n        lastStatuses,\n      }),\n  );\n\n  if (error) {\n    return <ResponseErrorPanel error={error} />;\n  }\n\n  return (\n    <GithubDeploymentsTable\n      deployments={value || []}\n      isLoading={loading}\n      reload={reload}\n      columns={columns}\n    />\n  );\n};\n\nexport const GithubDeploymentsCard = (props: {\n  last?: number;\n  lastStatuses?: number;\n  columns?: TableColumn<GithubDeployment>[];\n}) => {\n  const { last, lastStatuses, columns } = props;\n  const { entity } = useEntity();\n  const [host] = [\n    entity?.metadata.annotations?.[ANNOTATION_SOURCE_LOCATION],\n    entity?.metadata.annotations?.[ANNOTATION_LOCATION],\n  ].filter(Boolean);\n\n  return !isGithubDeploymentsAvailable(entity) ? (\n    <MissingAnnotationEmptyState annotation={GITHUB_PROJECT_SLUG_ANNOTATION} />\n  ) : (\n    <GithubDeploymentsComponent\n      projectSlug={\n        entity?.metadata.annotations?.[GITHUB_PROJECT_SLUG_ANNOTATION] || ''\n      }\n      last={last || 10}\n      lastStatuses={lastStatuses || 5}\n      host={host}\n      columns={columns || GithubDeploymentsTable.defaultDeploymentColumns}\n    />\n  );\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAkBA,MAAM,0BAA0B,GAAG,CAAC;AACpC,EAAE,WAAW;AACb,EAAE,IAAI;AACN,EAAE,YAAY;AACd,EAAE,OAAO;AACT,EAAE,IAAI;AACN,CAAC,KAAK;AACN,EAAE,MAAM,GAAG,GAAG,MAAM,CAAC,uBAAuB,CAAC,CAAC;AAC9C,EAAE,MAAM,CAAC,KAAK,EAAE,IAAI,CAAC,GAAG,WAAW,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;AAC/C,EAAE,MAAM;AACR,IAAI,OAAO;AACX,IAAI,KAAK;AACT,IAAI,KAAK;AACT,IAAI,KAAK,EAAE,MAAM;AACjB,GAAG,GAAG,aAAa,CAAC,YAAY,MAAM,GAAG,CAAC,eAAe,CAAC;AAC1D,IAAI,IAAI;AACR,IAAI,KAAK;AACT,IAAI,IAAI;AACR,IAAI,IAAI;AACR,IAAI,YAAY;AAChB,GAAG,CAAC,CAAC,CAAC;AACN,EAAE,IAAI,KAAK,EAAE;AACb,IAAI,uBAAuB,KAAK,CAAC,aAAa,CAAC,kBAAkB,EAAE;AACnE,MAAM,KAAK;AACX,KAAK,CAAC,CAAC;AACP,GAAG;AACH,EAAE,uBAAuB,KAAK,CAAC,aAAa,CAAC,sBAAsB,EAAE;AACrE,IAAI,WAAW,EAAE,KAAK,IAAI,EAAE;AAC5B,IAAI,SAAS,EAAE,OAAO;AACtB,IAAI,MAAM;AACV,IAAI,OAAO;AACX,GAAG,CAAC,CAAC;AACL,CAAC,CAAC;AACU,MAAC,qBAAqB,GAAG,CAAC,KAAK,KAAK;AAChD,EAAE,IAAI,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC;AACjB,EAAE,MAAM,EAAE,IAAI,EAAE,YAAY,EAAE,OAAO,EAAE,GAAG,KAAK,CAAC;AAChD,EAAE,MAAM,EAAE,MAAM,EAAE,GAAG,SAAS,EAAE,CAAC;AACjC,EAAE,MAAM,CAAC,IAAI,CAAC,GAAG;AACjB,IAAI,CAAC,EAAE,GAAG,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,GAAG,MAAM,CAAC,QAAQ,CAAC,WAAW,KAAK,IAAI,GAAG,KAAK,CAAC,GAAG,EAAE,CAAC,0BAA0B,CAAC;AAClH,IAAI,CAAC,EAAE,GAAG,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,GAAG,MAAM,CAAC,QAAQ,CAAC,WAAW,KAAK,IAAI,GAAG,KAAK,CAAC,GAAG,EAAE,CAAC,mBAAmB,CAAC;AAC3G,GAAG,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;AACpB,EAAE,OAAO,CAAC,4BAA4B,CAAC,MAAM,CAAC,mBAAmB,KAAK,CAAC,aAAa,CAAC,2BAA2B,EAAE;AAClH,IAAI,UAAU,EAAE,8BAA8B;AAC9C,GAAG,CAAC,mBAAmB,KAAK,CAAC,aAAa,CAAC,0BAA0B,EAAE;AACvE,IAAI,WAAW,EAAE,CAAC,CAAC,EAAE,GAAG,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,GAAG,MAAM,CAAC,QAAQ,CAAC,WAAW,KAAK,IAAI,GAAG,KAAK,CAAC,GAAG,EAAE,CAAC,8BAA8B,CAAC,KAAK,EAAE;AAC3I,IAAI,IAAI,EAAE,IAAI,IAAI,EAAE;AACpB,IAAI,YAAY,EAAE,YAAY,IAAI,CAAC;AACnC,IAAI,IAAI;AACR,IAAI,OAAO,EAAE,OAAO,IAAI,sBAAsB,CAAC,wBAAwB;AACvE,GAAG,CAAC,CAAC;AACL;;;;"}