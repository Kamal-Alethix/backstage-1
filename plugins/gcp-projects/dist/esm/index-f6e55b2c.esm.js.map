{"version":3,"file":"index-f6e55b2c.esm.js","sources":["../../src/api/GcpApi.ts","../../src/api/GcpClient.ts","../../src/routes.ts","../../src/plugin.ts"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Project, Operation } from './types';\nimport { createApiRef } from '@backstage/core-plugin-api';\n\nexport const gcpApiRef = createApiRef<GcpApi>({\n  id: 'plugin.gcpprojects.service',\n});\n\nexport type GcpApi = {\n  listProjects(): Promise<Project[]>;\n  getProject(projectId: string): Promise<Project>;\n  createProject(options: {\n    projectId: string;\n    projectName: string;\n  }): Promise<Operation>;\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { GcpApi } from './GcpApi';\nimport { Operation, Project } from './types';\nimport { OAuthApi } from '@backstage/core-plugin-api';\n\nconst BASE_URL =\n  'https://content-cloudresourcemanager.googleapis.com/v1/projects';\n\nexport class GcpClient implements GcpApi {\n  constructor(private readonly googleAuthApi: OAuthApi) {}\n\n  async listProjects(): Promise<Project[]> {\n    const response = await fetch(BASE_URL, {\n      headers: {\n        Accept: '*/*',\n        Authorization: `Bearer ${await this.getToken()}`,\n      },\n    });\n\n    if (!response.ok) {\n      throw new Error(\n        `List request failed to ${BASE_URL} with ${response.status} ${response.statusText}`,\n      );\n    }\n\n    const { projects } = await response.json();\n    return projects;\n  }\n\n  async getProject(projectId: string): Promise<Project> {\n    const url = `${BASE_URL}/${projectId}`;\n    const response = await fetch(url, {\n      headers: {\n        Authorization: `Bearer ${await this.getToken()}`,\n      },\n    });\n\n    if (!response.ok) {\n      throw new Error(\n        `Get request failed to ${url} with ${response.status} ${response.statusText}`,\n      );\n    }\n\n    return await response.json();\n  }\n\n  async createProject(options: {\n    projectId: string;\n    projectName: string;\n  }): Promise<Operation> {\n    const newProject: Project = {\n      name: options.projectName,\n      projectId: options.projectId,\n    };\n\n    const response = await fetch(BASE_URL, {\n      method: 'POST',\n      headers: {\n        Accept: '*/*',\n        Authorization: `Bearer ${await this.getToken()}`,\n      },\n      body: JSON.stringify(newProject),\n    });\n\n    if (!response.ok) {\n      throw new Error(\n        `Create request failed to ${BASE_URL} with ${response.status} ${response.statusText}`,\n      );\n    }\n\n    return await response.json();\n  }\n\n  async getToken(): Promise<string> {\n    // NOTE(freben): There's a .read-only variant of this scope that we could\n    // use for readonly operations, but that means we would ask the user for a\n    // second auth during creation and I decided to keep the wider scope for\n    // all ops for now\n    return this.googleAuthApi.getAccessToken(\n      'https://www.googleapis.com/auth/cloud-platform',\n    );\n  }\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createRouteRef } from '@backstage/core-plugin-api';\n\nexport const rootRouteRef = createRouteRef({\n  id: 'gcp-projects',\n});\nexport const projectRouteRef = createRouteRef({\n  id: 'gcp-projects:project',\n});\nexport const newProjectRouteRef = createRouteRef({\n  id: 'gcp-projects:new',\n});\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { gcpApiRef, GcpClient } from './api';\nimport { rootRouteRef } from './routes';\nimport {\n  createApiFactory,\n  createPlugin,\n  createRoutableExtension,\n  googleAuthApiRef,\n} from '@backstage/core-plugin-api';\n\nexport const gcpProjectsPlugin = createPlugin({\n  id: 'gcp-projects',\n  routes: {\n    root: rootRouteRef,\n  },\n  apis: [\n    createApiFactory({\n      api: gcpApiRef,\n      deps: { googleAuthApi: googleAuthApiRef },\n      factory({ googleAuthApi }) {\n        return new GcpClient(googleAuthApi);\n      },\n    }),\n  ],\n});\n\nexport const GcpProjectsPage = gcpProjectsPlugin.provide(\n  createRoutableExtension({\n    name: 'GcpProjectsPage',\n    component: () =>\n      import('./components/GcpProjectsPage').then(m => m.GcpProjectsPage),\n    mountPoint: rootRouteRef,\n  }),\n);\n"],"names":[],"mappings":"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"}